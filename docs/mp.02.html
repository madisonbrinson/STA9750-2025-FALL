<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>mp02 – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-1fe81d0376b2c50856e68e651e390326.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5657dfa6c17a855b02079790714f0f49.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="site_libs/datatables-binding-0.34.0/datatables.js"></script>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="site_libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>



</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Homepage</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mp01.html"> 
<span class="menu-text">Mini Project 01</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mp02.qmd"> 
<span class="menu-text">Mini Project 02</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">mp02</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-page">

    
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>))){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>library <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Mask base::library() to automatically install packages if needed</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Masking is important here so downlit picks up packages and links</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## to documentation</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>get_acs_all_years <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">geography=</span><span class="st">"cbsa"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{variable}_{geography}_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop 2020 - No survey (covid)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(geography, variable, <span class="at">year=</span>yy, <span class="at">survey=</span><span class="st">"acs1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year=</span>yy) <span class="sc">|&gt;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span>moe, <span class="sc">-</span>variable) <span class="sc">|&gt;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="sc">!!</span><span class="at">variable :=</span> estimate)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income (12 month)</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B19013_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">household_income =</span> B19013_001)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly rent</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B25064_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">monthly_rent =</span> B25064_001)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Total population</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01003_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">population =</span> B01003_001)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of households</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B11001_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">households =</span> B11001_001)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>      CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>      CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>      PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">year =</span> yy)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>      current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>      fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(...){</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>                   <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>      reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>      CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>      CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>      PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>      PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">year =</span> yy)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>      current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>      fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(...){</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>                   <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>      reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rvest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:readr':

    guess_encoding</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>get_bls_industry_codes <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="st">"bls_industry_codes.csv"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"classifications"</span>, <span class="st">"industry"</span>, <span class="st">"industry-titles.htm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_error</span>(<span class="at">is_error =</span> \(resp) <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_perform</span>()</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_check_status</span>(resp)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    naics_table <span class="ot">&lt;-</span> <span class="fu">resp_body_html</span>(resp) <span class="sc">|&gt;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_element</span>(<span class="st">"#naics_titles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(<span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>, Code), <span class="st">"NAICS"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">depth =</span> <span class="fu">if_else</span>(<span class="fu">nchar</span>(Code) <span class="sc">&lt;=</span> <span class="dv">5</span>, <span class="fu">nchar</span>(Code) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(depth))</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    naics_table <span class="ot">&lt;-</span> naics_table <span class="sc">|&gt;</span> </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level4_title=</span>title) <span class="sc">|&gt;</span> </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">level1_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">2</span>), </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">level2_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">3</span>), </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">level3_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level1_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level1_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level2_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level2_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level3_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level3_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"depth"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level4_code =</span> Code) <span class="sc">|&gt;</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(level1_title, level2_title, level3_title, level4_title, </span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>             level1_code,  level2_code,  level3_code,  level4_code)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(naics_table, fname)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>INDUSTRY_CODES <span class="ot">&lt;-</span> <span class="fu">get_bls_industry_codes</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>get_bls_qcew_annual_averages <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"bls_qcew_{start_year}_{end_year}.csv.gz"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop Covid year to match ACS</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="at">.progress=</span><span class="cn">TRUE</span>, <span class="fu">possibly</span>(<span class="cf">function</span>(yy){</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>      fname_inner <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="fu">glue</span>(<span class="st">"{yy}_qcew_annual_singlefile.zip"</span>))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname_inner)){</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"data"</span>, <span class="st">"files"</span>, yy, <span class="st">"csv"</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">glue</span>(<span class="st">"{yy}_annual_singlefile.zip"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_retry</span>(<span class="at">max_tries=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_perform</span>(fname_inner)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">file.info</span>(fname_inner)<span class="sc">$</span>size <span class="sc">&lt;</span> <span class="fl">755e5</span>){</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sQuote</span>(fname_inner), <span class="st">"appears corrupted. Please delete and retry this step."</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_csv</span>(fname_inner, </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">show_col_types=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">YEAR =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(area_fips, </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>               industry_code, </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>               annual_avg_emplvl, </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>               total_annual_wages, </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>               YEAR) <span class="sc">|&gt;</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="fu">nchar</span>(industry_code) <span class="sc">&lt;=</span> <span class="dv">5</span>, </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>               <span class="fu">str_starts</span>(area_fips, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="fu">str_detect</span>(industry_code, <span class="st">"-"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">FIPS =</span> area_fips, </span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">INDUSTRY =</span> <span class="fu">as.integer</span>(industry_code), </span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>               <span class="at">EMPLOYMENT =</span> <span class="fu">as.integer</span>(annual_avg_emplvl), </span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>               <span class="at">TOTAL_WAGES =</span> total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span>area_fips, </span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>industry_code, </span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>annual_avg_emplvl, </span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 10 is a special value: "all industries" , so omit</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(INDUSTRY <span class="sc">!=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">AVG_WAGE =</span> TOTAL_WAGES <span class="sc">/</span> EMPLOYMENT)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    })) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>  ALL_DATA <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  ALL_DATA_YEARS <span class="ot">&lt;-</span> <span class="fu">unique</span>(ALL_DATA<span class="sc">$</span>YEAR)</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>  YEARS_DIFF <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(YEARS, ALL_DATA_YEARS)</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(YEARS_DIFF) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Download failed for the following years: "</span>, YEARS_DIFF, </span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>         <span class="st">". Please delete intermediate files and try again."</span>)</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>  ALL_DATA</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> <span class="fu">get_bls_qcew_annual_averages</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>##Task 1</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#finding CSBA name in income data</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>CBSA_NAME <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(GEOID, NAME) <span class="sc">|&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(GEOID))</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)) <span class="sc">|&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(CBSA_NAME <span class="sc">|&gt;</span> <span class="fu">select</span>(CBSA, NAME), <span class="at">by =</span> <span class="st">"CBSA"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2010</span>, year <span class="sc">&lt;=</span> <span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME, CBSA) <span class="sc">|&gt;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_units =</span> <span class="fu">sum</span>(new_housing_units_permitted), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_units))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(mutate(PERMITS, CBSA = as.character(CBSA)), select(CBSA_NAME, : Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 15 of `x` matches multiple rows in `y`.
ℹ Row 2 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  result <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Location =</span> NAME,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">New permits</span><span class="st">`</span> <span class="ot">=</span> total_units) <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Location, CBSA, <span class="st">`</span><span class="at">New permits</span><span class="st">`</span>),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">autoWidth =</span> <span class="cn">TRUE</span>, <span class="at">dom =</span> <span class="st">"tpi"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-2dfd5eb027e9394a5e29" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2dfd5eb027e9394a5e29">{"x":{"filter":"none","vertical":false,"data":[["Houston-Pasadena-The Woodlands, TX Metro Area","Houston-Sugar Land-Baytown, TX Metro Area","Houston-The Woodlands-Sugar Land, TX Metro Area","Dallas-Fort Worth-Arlington, TX Metro Area","New York-Newark-Jersey City, NY-NJ Metro Area","New York-Newark-Jersey City, NY-NJ-PA Metro Area","New York-Northern New Jersey-Long Island, NY-NJ-PA Metro Area","Atlanta-Sandy Springs-Alpharetta, GA Metro Area","Atlanta-Sandy Springs-Marietta, GA Metro Area","Atlanta-Sandy Springs-Roswell, GA Metro Area","Washington-Arlington-Alexandria, DC-VA-MD-WV Metro Area","Phoenix-Mesa-Chandler, AZ Metro Area","Phoenix-Mesa-Glendale, AZ Metro Area","Phoenix-Mesa-Scottsdale, AZ Metro Area","Seattle-Tacoma-Bellevue, WA Metro Area","Austin-Round Rock, TX Metro Area","Austin-Round Rock-Georgetown, TX Metro Area","Austin-Round Rock-San Marcos, TX Metro Area","Los Angeles-Long Beach-Anaheim, CA Metro Area","Orlando-Kissimmee, FL Metro Area","Orlando-Kissimmee-Sanford, FL Metro Area","Charlotte-Concord-Gastonia, NC-SC Metro Area","Charlotte-Gastonia-Concord, NC-SC Metro Area","Charlotte-Gastonia-Rock Hill, NC-SC Metro Area","Miami-Fort Lauderdale-Pompano Beach, FL Metro Area","Miami-Fort Lauderdale-West Palm Beach, FL Metro Area","Denver-Aurora-Broomfield, CO Metro Area","Denver-Aurora-Centennial, CO Metro Area","Denver-Aurora-Lakewood, CO Metro Area","Nashville-Davidson--Murfreesboro--Franklin, TN Metro Area","Chicago-Joliet-Naperville, IL-IN-WI Metro Area","Chicago-Naperville-Elgin, IL-IN Metro Area","Chicago-Naperville-Elgin, IL-IN-WI Metro Area","Chicago-Naperville-Joliet, IL-IN-WI Metro Area","Tampa-St. Petersburg-Clearwater, FL Metro Area","Minneapolis-St. Paul-Bloomington, MN-WI Metro Area","Boston-Cambridge-Newton, MA-NH Metro Area","Boston-Cambridge-Quincy, MA-NH Metro Area","Portland-Vancouver-Beaverton, OR-WA Metro Area","Portland-Vancouver-Hillsboro, OR-WA Metro Area","San Francisco-Oakland-Berkeley, CA Metro Area","San Francisco-Oakland-Fremont, CA Metro Area","San Francisco-Oakland-Hayward, CA Metro Area","Raleigh, NC Metro Area","Raleigh-Cary, NC Metro Area","Philadelphia-Camden-Wilmington, PA-NJ-DE-MD Metro Area","Riverside-San Bernardino-Ontario, CA Metro Area","Las Vegas-Henderson-North Las Vegas, NV Metro Area","Las Vegas-Henderson-Paradise, NV Metro Area","Las Vegas-Paradise, NV Metro Area","San Antonio, TX Metro Area","San Antonio-New Braunfels, TX Metro Area","Jacksonville, FL Metro Area","San Diego-Carlsbad, CA Metro Area","San Diego-Carlsbad-San Marcos, CA Metro Area","San Diego-Chula Vista-Carlsbad, CA Metro Area","Indianapolis-Carmel, IN Metro Area","Indianapolis-Carmel-Anderson, IN Metro Area","Indianapolis-Carmel-Greenwood, IN Metro Area","Kansas City, MO-KS Metro Area","Columbus, OH Metro Area","Baltimore-Columbia-Towson, MD Metro Area","Baltimore-Towson, MD Metro Area","Los Angeles-Long Beach-Santa Ana, CA Metro Area","San Jose-Sunnyvale-Santa Clara, CA Metro Area","St. Louis, MO-IL Metro Area","Detroit-Warren-Dearborn, MI Metro Area","Detroit-Warren-Livonia, MI Metro Area","Salt Lake City, UT Metro Area","Salt Lake City-Murray, UT Metro Area","North Port-Bradenton-Sarasota, FL Metro Area","North Port-Sarasota-Bradenton, FL Metro Area","Oklahoma City, OK Metro Area","Virginia Beach-Chesapeake-Norfolk, VA-NC Metro Area","Virginia Beach-Norfolk-Newport News, VA-NC Metro Area","Charleston-North Charleston, SC Metro Area","Charleston-North Charleston-Summerville, SC Metro Area","Sacramento--Arden-Arcade--Roseville, CA Metro Area","Sacramento--Roseville--Arden-Arcade, CA Metro Area","Sacramento-Roseville-Folsom, CA Metro Area","Boise City, ID Metro Area","Boise City-Nampa, ID Metro Area","Richmond, VA Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC-NC Metro Area","Myrtle Beach-North Myrtle Beach-Conway, SC Metro Area","Cape Coral-Fort Myers, FL Metro Area","Cincinnati, OH-KY-IN Metro Area","Cincinnati-Middletown, OH-KY-IN Metro Area","Des Moines-West Des Moines, IA Metro Area","Provo-Orem, UT Metro Area","Provo-Orem-Lehi, UT Metro Area","Greenville-Anderson, SC Metro Area","Greenville-Anderson-Greer, SC Metro Area","Greenville-Anderson-Mauldin, SC Metro Area","Greenville-Mauldin-Easley, SC Metro Area","Louisville-Jefferson County, KY-IN Metro Area","Louisville/Jefferson County, KY-IN Metro Area","Pittsburgh, PA Metro Area","Omaha, NE-IA Metro Area","Omaha-Council Bluffs, NE-IA Metro Area","Columbia, SC Metro Area","McAllen-Edinburg-Mission, TX Metro Area","Durham-Chapel Hill, NC Metro Area","Colorado Springs, CO Metro Area","Tulsa, OK Metro Area","El Paso, TX Metro Area","Fayetteville-Springdale-Rogers, AR Metro Area","Fayetteville-Springdale-Rogers, AR-MO Metro Area","Memphis, TN-MS-AR Metro Area","Lakeland-Winter Haven, FL Metro Area","Baton Rouge, LA Metro Area","Madison, WI Metro Area","Tucson, AZ Metro Area","Naples-Immokalee-Marco Island, FL Metro Area","Naples-Marco Island, FL Metro Area","Knoxville, TN Metro Area","Birmingham, AL Metro Area","Birmingham-Hoover, AL Metro Area","Ogden, UT Metro Area","Ogden-Clearfield, UT Metro Area","Grand Rapids-Kentwood, MI Metro Area","Grand Rapids-Wyoming, MI Metro Area","Grand Rapids-Wyoming-Kentwood, MI Metro Area","New Orleans-Metairie, LA Metro Area","New Orleans-Metairie-Kenner, LA Metro Area","Little Rock-North Little Rock-Conway, AR Metro Area","Augusta-Richmond County, GA-SC Metro Area","Wilmington, NC Metro Area","Cleveland-Elyria, OH Metro Area","Cleveland-Elyria-Mentor, OH Metro Area","Huntsville, AL Metro Area","Reno, NV Metro Area","Reno-Sparks, NV Metro Area","Milwaukee-Waukesha, WI Metro Area","Milwaukee-Waukesha-West Allis, WI Metro Area","Greeley, CO Metro Area","Spokane, WA Metro Area","Spokane-Spokane Valley, WA Metro Area","Fresno, CA Metro Area","Killeen-Temple, TX Metro Area","Killeen-Temple-Fort Hood, TX Metro Area","Fort Collins, CO Metro Area","Fort Collins-Loveland, CO Metro Area","Greensboro-High Point, NC Metro Area","Winston-Salem, NC Metro Area","Fargo, ND-MN Metro Area","Albany-Schenectady-Troy, NY Metro Area","Deltona-Daytona Beach-Ormond Beach, FL Metro Area","Pensacola-Ferry Pass-Brent, FL Metro Area","Albuquerque, NM Metro Area","Asheville, NC Metro Area","Salisbury, MD Metro Area","Salisbury, MD-DE Metro Area","Bakersfield, CA Metro Area","Bakersfield-Delano, CA Metro Area","Lexington-Fayette, KY Metro Area","Sioux Falls, SD Metro Area","Sioux Falls, SD-MN Metro Area","Savannah, GA Metro Area","Palm Bay-Melbourne-Titusville, FL Metro Area","St. George, UT Metro Area","Chattanooga, TN-GA Metro Area","Portland-South Portland, ME Metro Area","Portland-South Portland-Biddeford, ME Metro Area","Lubbock, TX Metro Area","Stockton, CA Metro Area","Stockton-Lodi, CA Metro Area","College Station-Bryan, TX Metro Area","Clarksville, TN-KY Metro Area","Rochester, NY Metro Area","Fayetteville, NC Metro Area","Lincoln, NE Metro Area","Gulfport-Biloxi, MS Metro Area","Gulfport-Biloxi-Pascagoula, MS Metro Area","Port St. Lucie, FL Metro Area","Providence-New Bedford-Fall River, RI-MA Metro Area","Providence-Warwick, RI-MA Metro Area","Bridgeport-Stamford-Danbury, CT Metro Area","Bridgeport-Stamford-Norwalk, CT Metro Area","Corpus Christi, TX Metro Area","Springfield, MO Metro Area","Crestview-Fort Walton Beach-Destin, FL Metro Area","Wichita, KS Metro Area","Kennewick-Pasco-Richland, WA Metro Area","Kennewick-Richland, WA Metro Area","Harrisburg-Carlisle, PA Metro Area","Tallahassee, FL Metro Area","Buffalo-Cheektowaga, NY Metro Area","Buffalo-Cheektowaga-Niagara Falls, NY Metro Area","Buffalo-Niagara Falls, NY Metro Area","Lafayette, LA Metro Area","Jackson, MS Metro Area","Spartanburg, SC Metro Area","Boulder, CO Metro Area","Bend, OR Metro Area","Bend-Redmond, OR Metro Area","Daphne-Fairhope-Foley, AL Metro Area","Daphne-Fairhope-Foley, AL Micro Area","Hartford-East Hartford-Middletown, CT Metro Area","Hartford-West Hartford-East Hartford, CT Metro Area","Worcester, MA Metro Area","Worcester, MA-CT Metro Area","Jacksonville, NC Metro Area","Coeur d'Alene, ID Metro Area","Laredo, TX Metro Area","Urban Honolulu, HI Metro Area","Brownsville-Harlingen, TX Metro Area","Fort Wayne, IN Metro Area","Shreveport-Bossier City, LA Metro Area","Olympia, WA Metro Area","Olympia-Lacey-Tumwater, WA Metro Area","Olympia-Tumwater, WA Metro Area","Allentown-Bethlehem-Easton, PA-NJ Metro Area","Hilton Head Island-Beaufort, SC Micro Area","Hilton Head Island-Bluffton, SC Metro Area","Hilton Head Island-Bluffton-Beaufort, SC Metro Area","Hilton Head Island-Bluffton-Port Royal, SC Metro Area","Lancaster, PA Metro Area","Ocala, FL Metro Area","Lake Charles, LA Metro Area","Beaumont-Port Arthur, TX Metro Area","Visalia, CA Metro Area","Visalia-Porterville, CA Metro Area","The Villages, FL Metro Area","The Villages, FL Micro Area","Oxnard-Thousand Oaks-Ventura, CA Metro Area","Gainesville, FL Metro Area","Santa Rosa, CA Metro Area","Santa Rosa-Petaluma, CA Metro Area","Salem, OR Metro Area","Charlottesville, VA Metro Area","Iowa City, IA Metro Area","Syracuse, NY Metro Area","Columbia, MO Metro Area","Bismarck, ND Metro Area","Dover, DE Metro Area","Billings, MT Metro Area","Green Bay, WI Metro Area","Rochester, MN Metro Area","Columbus, GA-AL Metro Area","Auburn-Opelika, AL Metro Area","Tuscaloosa, AL Metro Area","Bellingham, WA Metro Area","Midland, TX Metro Area","Waco, TX Metro Area","Bowling Green, KY Metro Area","Hagerstown-Martinsburg, MD-WV Metro Area","Prescott, AZ Metro Area","Eugene, OR Metro Area","Eugene-Springfield, OR Metro Area","New Haven, CT Metro Area","New Haven-Milford, CT Metro Area","Champaign-Urbana, IL Metro Area","Punta Gorda, FL Metro Area","Mobile, AL Metro Area","Panama City, FL Metro Area","Panama City-Lynn Haven-Panama City Beach, FL Metro Area","Panama City-Panama City Beach, FL Metro Area","Dayton, OH Metro Area","Burlington, NC Metro Area","Montgomery, AL Metro Area","Logan, UT-ID Metro Area","Manchester-Nashua, NH Metro Area","Warner Robins, GA Metro Area","Toledo, OH Metro Area","Gainesville, GA Metro Area","York-Hanover, PA Metro Area","Akron, OH Metro Area","Cedar Rapids, IA Metro Area","Bremerton-Silverdale, WA Metro Area","Bremerton-Silverdale-Port Orchard, WA Metro Area","Amarillo, TX Metro Area","Anchorage, AK Metro Area","Las Cruces, NM Metro Area","Lansing-East Lansing, MI Metro Area","Odessa, TX Metro Area","Athens-Clarke County, GA Metro Area","Appleton, WI Metro Area","Vallejo, CA Metro Area","Vallejo-Fairfield, CA Metro Area","Sebastian-Vero Beach, FL Metro Area","Sebastian-Vero Beach-West Vero Corridor, FL Metro Area","Burlington-South Burlington, VT Metro Area","Greenville, NC Metro Area","Honolulu, HI Metro Area","Scranton--Wilkes-Barre, PA Metro Area","Scranton--Wilkes-Barre--Hazleton, PA Metro Area","Valdosta, GA Metro Area","Jonesboro, AR Metro Area","San Luis Obispo-Paso Robles, CA Metro Area","San Luis Obispo-Paso Robles-Arroyo Grande, CA Metro Area","Yuma, AZ Metro Area","Evansville, IN Metro Area","Evansville, IN-KY Metro Area","Rapid City, SD Metro Area","Lynchburg, VA Metro Area","Atlantic City-Hammonton, NJ Metro Area","Hickory-Lenoir-Morganton, NC Metro Area","Idaho Falls, ID Metro Area","Poughkeepsie-Newburgh-Middletown, NY Metro Area","Medford, OR Metro Area","Davenport-Moline-Rock Island, IA-IL Metro Area","St. Cloud, MN Metro Area","Johnson City, TN Metro Area","Winchester, VA-WV Metro Area","Chico, CA Metro Area","Lafayette-West Lafayette, IN Metro Area","Duluth, MN-WI Metro Area","Missoula, MT Metro Area","Ocean City, NJ Metro Area","Fort Smith, AR-OK Metro Area","Lake Havasu City-Kingman, AZ Metro Area","Barnstable Town, MA Metro Area","Trenton, NJ Metro Area","Trenton-Ewing, NJ Metro Area","Trenton-Princeton, NJ Metro Area","Santa Maria-Santa Barbara, CA Metro Area","Lawrence, KS Metro Area","Eau Claire, WI Metro Area","Kalamazoo-Portage, MI Metro Area","Monroe, LA Metro Area","Cleveland, TN Metro Area","Springfield, MA Metro Area","Manhattan, KS Metro Area","Roanoke, VA Metro Area","Kingsport-Bristol, TN-VA Metro Area","Kingsport-Bristol-Bristol, TN-VA Metro Area","Elizabethtown, KY Metro Area","Elizabethtown-Fort Knox, KY Metro Area","Florence, SC Metro Area","Wenatchee, WA Metro Area","Wenatchee-East Wenatchee, WA Metro Area","Ann Arbor, MI Metro Area","South Bend-Mishawaka, IN-MI Metro Area","Grand Junction, CO Metro Area","Ames, IA Metro Area","Flagstaff, AZ Metro Area","Houma-Bayou Cane-Thibodaux, LA Metro Area","Houma-Thibodaux, LA Metro Area","Peoria, IL Metro Area","Hammond, LA Metro Area","Hammond, LA Micro Area","Yakima, WA Metro Area","Canton-Massillon, OH Metro Area","Grand Forks, ND-MN Metro Area","Brunswick, GA Metro Area","Brunswick-St. Simons, GA Metro Area","State College, PA Metro Area","Sherman-Denison, TX Metro Area","Waterloo-Cedar Falls, IA Metro Area","Blacksburg-Christiansburg, VA Metro Area","Blacksburg-Christiansburg-Radford, VA Metro Area","Joplin, MO Metro Area","Joplin, MO-KS Metro Area","Tyler, TX Metro Area","Salinas, CA Metro Area","Modesto, CA Metro Area","Bloomington, IN Metro Area","Harrisonburg, VA Metro Area","California-Lexington Park, MD Metro Area","Mankato, MN Metro Area","Mankato-North Mankato, MN Metro Area","Reading, PA Metro Area","Cheyenne, WY Metro Area","Oshkosh-Neenah, WI Metro Area","Norwich-New London, CT Metro Area","Norwich-New London-Willimantic, CT Metro Area","La Crosse, WI-MN Metro Area","La Crosse-Onalaska, WI-MN Metro Area","Sioux City, IA-NE-SD Metro Area","Ithaca, NY Metro Area","Mount Vernon-Anacortes, WA Metro Area","Longview, TX Metro Area","Springfield, IL Metro Area","Merced, CA Metro Area","Dothan, AL Metro Area","Hinesville, GA Metro Area","Hinesville-Fort Stewart, GA Metro Area","Kahului-Wailuku, HI Metro Area","Kahului-Wailuku, HI Micro Area","Kahului-Wailuku-Lahaina, HI Metro Area","Casper, WY Metro Area","Hanford-Corcoran, CA Metro Area","Alexandria, LA Metro Area","Macon, GA Metro Area","Macon-Bibb County, GA Metro Area","Erie, PA Metro Area","Florence-Muscle Shoals, AL Metro Area","Wausau, WI Metro Area","Wausau-Weston, WI Metro Area","Abilene, TX Metro Area","Homosassa Springs, FL Metro Area","Homosassa Springs, FL Micro Area","Dubuque, IA Metro Area","Cape Girardeau, MO-IL Metro Area","Cape Girardeau-Jackson, MO-IL Metro Area","Lafayette, IN Metro Area","Topeka, KS Metro Area","Youngstown-Warren, OH Metro Area","Youngstown-Warren-Boardman, OH-PA Metro Area","Santa Cruz-Watsonville, CA Metro Area","Sumter, SC Metro Area","Flint, MI Metro Area","Lebanon, PA Metro Area","Owensboro, KY Metro Area","Madera, CA Metro Area","Madera-Chowchilla, CA Metro Area","Elkhart-Goshen, IN Metro Area","Bangor, ME Metro Area","Corvallis, OR Metro Area","Redding, CA Metro Area","San Angelo, TX Metro Area","Jackson, TN Metro Area","Yuba City, CA Metro Area","Albany, OR Metro Area","Albany-Lebanon, OR Metro Area","Albany-Lebanon, OR Micro Area","Utica-Rome, NY Metro Area","Glens Falls, NY Metro Area","Monroe, MI Metro Area","Pueblo, CO Metro Area","Huntington-Ashland, WV-KY-OH Metro Area","Charleston, WV Metro Area","Kingston, NY Metro Area","El Centro, CA Metro Area","Holland-Grand Haven, MI Metro Area","Goldsboro, NC Metro Area","Albany, GA Metro Area","Jefferson City, MO Metro Area","Terre Haute, IN Metro Area","Saginaw, MI Metro Area","Saginaw-Saginaw Township North, MI Metro Area","Victoria, TX Metro Area","Fond du Lac, WI Metro Area","Racine, WI Metro Area","Racine-Mount Pleasant, WI Metro Area","Staunton, VA Metro Area","Staunton-Stuarts Draft, VA Metro Area","Staunton-Waynesboro, VA Metro Area","Staunton-Waynesboro, VA Micro Area","Janesville, WI Metro Area","Janesville-Beloit, WI Metro Area","Longview, WA Metro Area","Longview-Kelso, WA Metro Area","Napa, CA Metro Area","Morristown, TN Metro Area","Rocky Mount, NC Metro Area","Bloomington-Normal, IL Metro Area","New Bern, NC Metro Area","New Bern, NC Micro Area","Binghamton, NY Metro Area","Prescott Valley-Prescott, AZ Metro Area","Morgantown, WV Metro Area","Columbus, IN Metro Area","Niles, MI Metro Area","Niles-Benton Harbor, MI Metro Area","Pocatello, ID Metro Area","Chambersburg, PA Metro Area","Chambersburg, PA Micro Area","Chambersburg-Waynesboro, PA Metro Area","Muskegon, MI Metro Area","Muskegon-Norton Shores, MI Metro Area","Texarkana, TX-AR Metro Area","Texarkana, TX-Texarkana, AR Metro Area","Rockford, IL Metro Area","Great Falls, MT Metro Area","Kokomo, IN Metro Area","Santa Fe, NM Metro Area","Wichita Falls, TX Metro Area","Bloomington, IL Metro Area","Pittsfield, MA Metro Area","Dalton, GA Metro Area","Lewiston-Auburn, ME Metro Area","Vineland, NJ Metro Area","Vineland-Bridgeton, NJ Metro Area","Vineland-Millville-Bridgeton, NJ Metro Area","Anderson, SC Metro Area","Grand Island, NE Metro Area","Grand Island, NE Micro Area","Sheboygan, WI Metro Area","Lawton, OK Metro Area","Michigan City-La Porte, IN Metro Area","Gettysburg, PA Metro Area","Gettysburg, PA Micro Area","Decatur, AL Metro Area","Hattiesburg, MS Metro Area","Williamsport, PA Metro Area","Santa Barbara-Santa Maria-Goleta, CA Metro Area","Farmington, NM Metro Area","Jackson, MI Metro Area","St. Joseph, MO-KS Metro Area","Parkersburg-Marietta-Vienna, WV-OH Metro Area","Parkersburg-Vienna, WV Metro Area","Sierra Vista-Douglas, AZ Metro Area","Sierra Vista-Douglas, AZ Micro Area","Grants Pass, OR Metro Area","Grants Pass, OR Micro Area","Rome, GA Metro Area","Pascagoula, MS Metro Area","Dayton-Kettering, OH Metro Area","Dayton-Kettering-Beavercreek, OH Metro Area","Palm Coast, FL Metro Area","Walla Walla, WA Metro Area","Watertown-Fort Drum, NY Metro Area","Watertown-Fort Drum, NY Micro Area","East Stroudsburg, PA Metro Area","East Stroudsburg, PA Micro Area","Altoona, PA Metro Area","Muncie, IN Metro Area","Elmira, NY Metro Area","Carson City, NV Metro Area","Sebring, FL Metro Area","Sebring, FL Micro Area","Sebring-Avon Park, FL Metro Area","Carbondale-Marion, IL Metro Area","Kankakee, IL Metro Area","Kankakee-Bradley, IL Metro Area","Lima, OH Metro Area","Lewiston, ID-WA Metro Area","Midland, MI Metro Area","Midland, MI Micro Area","Bloomsburg-Berwick, PA Metro Area","Bloomsburg-Berwick, PA Micro Area","Gadsden, AL Metro Area","Cumberland, MD-WV Metro Area","Cumberland, MD-WV Micro Area","Twin Falls, ID Metro Area","Twin Falls, ID Micro Area","Springfield, OH Metro Area","Bay City, MI Metro Area","Anniston-Oxford, AL Metro Area","Anniston-Oxford-Jacksonville, AL Metro Area","Johnstown, PA Metro Area","Pine Bluff, AR Metro Area","Pine Bluff, AR Micro Area","Danville, VA Metro Area","Danville, VA Micro Area","Mansfield, OH Metro Area","Battle Creek, MI Metro Area","Decatur, IL Metro Area","Hot Springs, AR Metro Area","Beckley, WV Metro Area","Beckley, WV Micro Area","Wheeling, WV-OH Metro Area","Anderson, IN Metro Area","Fairbanks, AK Metro Area","Fairbanks-College, AK Metro Area","Danville, IL Metro Area","Danville, IL Micro Area","Enid, OK Metro Area","Sandusky, OH Metro Area","Sandusky, OH Micro Area","Weirton-Steubenville, WV-OH Metro Area","Steubenville-Weirton, OH-WV Metro Area"],["26420","26420","26420","19100","35620","35620","35620","12060","12060","12060","47900","38060","38060","38060","42660","12420","12420","12420","31080","36740","36740","16740","16740","16740","33100","33100","19740","19740","19740","34980","16980","16980","16980","16980","45300","33460","14460","14460","38900","38900","41860","41860","41860","39580","39580","37980","40140","29820","29820","29820","41700","41700","27260","41740","41740","41740","26900","26900","26900","28140","18140","12580","12580","31100","41940","41180","19820","19820","41620","41620","35840","35840","36420","47260","47260","16700","16700","40900","40900","40900","14260","14260","40060","34820","34820","34820","15980","17140","17140","19780","39340","39340","24860","24860","24860","24860","31140","31140","38300","36540","36540","17900","32580","20500","17820","46140","21340","22220","22220","32820","29460","12940","31540","46060","34940","34940","28940","13820","13820","36260","36260","24340","24340","24340","35380","35380","30780","12260","48900","17460","17460","26620","39900","39900","33340","33340","24540","44060","44060","23420","28660","28660","22660","22660","24660","49180","22020","10580","19660","37860","10740","11700","41540","41540","12540","12540","30460","43620","43620","42340","37340","41100","16860","38860","38860","31180","44700","44700","17780","17300","40380","22180","30700","25060","25060","38940","39300","39300","14860","14860","18580","44180","18880","48620","28420","28420","25420","45220","15380","15380","15380","29180","27140","43900","14500","13460","13460","19300","19300","25540","25540","49340","49340","27340","17660","29700","46520","15180","23060","43340","36500","36500","36500","10900","25940","25940","25940","25940","29540","36100","29340","13140","47300","47300","45540","45540","37100","23540","42220","42220","41420","16820","26980","45060","17860","13900","20100","13740","24580","40340","17980","12220","46220","13380","33260","47380","14540","25180","39140","21660","21660","35300","35300","16580","39460","33660","37460","37460","37460","19380","15500","33860","30860","31700","47580","45780","23580","49620","10420","16300","14740","14740","11100","11260","29740","29620","36220","12020","11540","46700","46700","42680","42680","15540","24780","26180","42540","42540","46660","27860","42020","42020","49740","21780","21780","39660","31340","12100","25860","26820","39100","32780","19340","41060","27740","49020","17020","29200","20260","33540","36140","22900","29420","12700","45940","45940","45940","42200","29940","20740","28020","33740","17420","44140","31740","40220","28700","28700","21060","21060","22500","48300","48300","11460","43780","24300","11180","22380","26380","26380","37900","25220","25220","49420","15940","24220","15260","15260","44300","43300","47940","13980","13980","27900","27900","46340","41500","33700","14020","25500","15680","31860","31860","39740","16940","36780","35980","35980","29100","29100","43580","27060","34580","30980","44100","32900","20020","25980","25980","27980","27980","27980","16220","25260","10780","31420","31420","21500","22520","48140","48140","10180","26140","26140","20220","16020","16020","29140","45820","49660","49660","42100","44940","22420","30140","36980","31460","31460","21140","12620","18700","39820","41660","27180","49700","10540","10540","10540","46540","24020","33780","39380","26580","16620","28740","20940","26100","24140","10500","27620","45460","40980","40980","47020","22540","39540","39540","44420","44420","44420","44420","27500","27500","31020","31020","34900","34100","40580","14060","35100","35100","13780","39150","34060","18020","35660","35660","38540","16540","16540","16540","34740","34740","45500","45500","40420","24500","29020","42140","48660","14010","38340","19140","30340","47220","47220","47220","11340","24260","24260","43100","30020","33140","23900","23900","19460","25620","48700","42060","22140","27100","41140","37620","37620","43420","43420","24420","24420","40660","37700","19430","19430","37380","47460","48060","48060","20700","20700","11020","34620","21300","16180","42700","42700","42700","16060","28100","28100","30620","30300","33220","33220","14100","14100","23460","19060","19060","46300","46300","44220","13020","11500","11500","27780","38220","38220","19260","19260","31900","12980","19500","26300","13220","13220","48540","11300","21820","21820","19180","19180","21420","41780","41780","48260","44600"],[482075,482075,482075,460826,446020,446020,446020,254377,254377,254377,232483,219939,219939,219939,213022,212392,212392,212392,184260,171588,171588,170359,170359,170359,164006,164006,160762,160762,160762,145531,145175,145175,145175,145175,140207,127378,118018,118018,117234,117234,116917,116917,116917,116534,116534,115019,101466,100807,100807,100807,98429,98429,94357,78834,78834,78834,76533,76533,76533,75524,74006,72300,72300,67286,66077,65192,63776,63776,63479,63479,62245,62245,59298,58629,58629,57575,57575,57144,57144,57144,56352,56352,51093,50763,50763,50763,50253,48807,48807,47942,45973,45973,43432,43432,43432,43432,42813,42813,40764,40714,40714,40554,40099,39360,39344,36763,36501,35506,35506,35280,34738,34440,31932,31868,30939,30939,30308,29688,29688,29273,29273,28918,28918,28918,28736,28736,28099,27803,27081,26912,26912,26773,26607,26607,26400,26400,25971,24958,24958,24859,24053,24053,23423,23423,23150,22851,22751,22590,22427,22315,21981,21859,21814,21814,21054,21054,21004,20967,20967,20672,20559,20200,20155,19669,19669,19236,19138,19138,18861,18461,18379,18367,18263,18256,18256,18249,18130,18130,18034,18034,18014,17966,17885,17583,17115,17115,16747,16546,16321,16321,16321,16272,15664,15062,14978,14851,14851,14721,14721,14601,14601,14494,14494,14474,14046,13781,13726,13631,13591,13258,13119,13119,13119,13069,12809,12809,12809,12809,12736,12540,12505,12381,12305,12305,12028,12028,11996,11906,11804,11804,11795,11693,11377,11285,11260,11044,10935,10928,10744,10694,10641,10615,10599,10574,10327,10299,10187,9996,9956,9784,9784,9780,9780,9749,9717,9710,9669,9669,9669,9365,9362,9292,9266,9248,9183,9166,9133,8969,8880,8829,8815,8815,8802,8644,8569,8469,8377,8355,8183,8177,8177,8149,8149,8055,8017,7980,7923,7923,7858,7809,7733,7733,7718,7680,7680,7472,7282,7222,7169,7115,7034,6963,6803,6700,6565,6501,6443,6379,6369,6244,6244,6217,6163,6116,6106,6106,6106,6062,6003,5960,5922,5851,5810,5773,5769,5684,5683,5683,5613,5613,5600,5589,5589,5584,5558,5554,5487,5455,5370,5370,5249,5210,5210,5205,5155,5152,4961,4961,4853,4781,4745,4740,4740,4727,4727,4689,4680,4677,4654,4582,4580,4529,4529,4459,4389,4297,4221,4221,4092,4092,4068,4046,3881,3876,3864,3803,3802,3789,3789,3763,3763,3763,3709,3677,3636,3625,3625,3509,3502,3490,3490,3484,3422,3422,3416,3409,3409,3403,3343,3318,3318,3274,3267,3263,3238,3191,3146,3146,3098,3093,3080,3049,3032,3022,2983,2958,2958,2958,2937,2908,2869,2832,2796,2766,2754,2692,2682,2676,2650,2607,2580,2530,2530,2495,2488,2481,2481,2470,2470,2470,2470,2455,2455,2388,2388,2323,2278,2276,2256,2227,2227,2194,2180,2125,2100,2060,2060,2045,2042,2042,2042,2007,2007,1998,1998,1995,1984,1979,1974,1934,1807,1763,1739,1736,1714,1714,1714,1692,1654,1654,1612,1595,1594,1552,1552,1508,1503,1501,1497,1463,1436,1323,1317,1317,1308,1308,1307,1307,1293,1268,1231,1231,1226,1211,1188,1188,1161,1161,1158,1126,1121,1108,1087,1087,1087,1068,1059,1059,1025,1011,937,937,927,927,915,904,904,835,835,822,819,816,816,795,742,742,659,659,620,619,610,554,543,543,509,316,305,305,266,266,234,219,219,204,115]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Location<\/th>\n      <th>CBSA<\/th>\n      <th>New permits<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"autoWidth":true,"dom":"tpi","columnDefs":[{"className":"dt-right","targets":2},{"name":"Location","targets":0},{"name":"CBSA","targets":1},{"name":"New permits","targets":2}],"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="st">"10740"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA,year) <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(new_units))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 3
    CBSA  year new_units
   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
 1 10740  2021      4021
 2 10740  2022      2852
 3 10740  2023      2834
 4 10740  2013      2606
 5 10740  2014      2543
 6 10740  2016      2465
 7 10740  2015      2295
 8 10740  2017      2256
 9 10740  2018      2186
10 10740  2019      2148
11 10740  2012      2084
12 10740  2020      2014
13 10740  2010      1764
14 10740  2009      1692
15 10740  2011      1634</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Build 2015 CBSA-level totals</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>cbsa_2015 <span class="ot">&lt;-</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  INCOME <span class="sc">|&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    HOUSEHOLDS <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, NAME, year, households),</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, NAME, year, population),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">str_extract</span>(NAME, <span class="st">", (.{2})"</span>, <span class="at">group=</span><span class="dv">1</span>))<span class="sc">|&gt;</span>     </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co"># two-letter state from "Metro, ST"</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">total_income_cbsa =</span> household_income <span class="sc">*</span> households</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Collapse to state and compute average individual income</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>top_state_2015 <span class="ot">&lt;-</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  cbsa_2015 <span class="sc">|&gt;</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_income =</span> <span class="fu">sum</span>(total_income_cbsa, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop    =</span> <span class="fu">sum</span>(population,       <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_individual_income =</span> total_income <span class="sc">/</span> total_pop,</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_individual_income))</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Top state (answer row)</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>top_state_2015</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 × 4
   state total_income total_pop avg_individual_income
   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;                 &lt;dbl&gt;
 1 DC    202663489140   6098283                33233.
 2 MA    186566282228   6754601                27621.
 3 CT     94480626751   3474313                27194.
 4 AK     13197939163    499421                26426.
 5 VT      5715539271    216661                26380.
 6 NH     22249129392    847504                26253.
 7 MN    116902131752   4469143                26158.
 8 MD     93826139111   3665585                25596.
 9 WA    161492961867   6350174                25431.
10 CO    123095455889   4840469                25430.
# ℹ 42 more rows</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">"C1234"</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">as.double</span>(<span class="fu">paste0</span>(<span class="fu">str_remove</span>(x, <span class="st">"^C"</span>), <span class="st">"0"</span>))<span class="co"># -&gt; 12340</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12340</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) BLS (QCEW) filtered to NAICS 5182 and with CBSA code fixed: "C1234" -&gt; 12340</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 1) Fix codes</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>bls_5182 <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">5182</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cbsa_num =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>, <span class="st">""</span>, FIPS), <span class="st">"0"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cbsa_num, YEAR, EMPLOYMENT)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>cbsa_lookup <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME) <span class="sc">|&gt;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA_num =</span> <span class="fu">as.integer</span>(GEOID)) <span class="sc">|&gt;</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CBSA_num, NAME)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 2) Join (use by=..., not join_by)</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>ds_named <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(bls_5182, cbsa_lookup, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cbsa_num"</span> <span class="ot">=</span> <span class="st">"CBSA_num"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in inner_join(bls_5182, cbsa_lookup, by = c(cbsa_num = "CBSA_num")): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 2 of `x` matches multiple rows in `y`.
ℹ Row 2 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 3) Leader per year</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>leaders <span class="ot">&lt;-</span> ds_named <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(EMPLOYMENT, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 4) Last year NYC (35620) led</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>last_year_nyc <span class="ot">&lt;-</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  leaders <span class="sc">|&gt;</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cbsa_num <span class="sc">==</span> <span class="dv">35620</span>L) <span class="sc">|&gt;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(YEAR, NAME, EMPLOYMENT) <span class="sc">|&gt;</span> </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(YEAR)) <span class="sc">|&gt;</span> </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>leaders</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
   cbsa_num  YEAR EMPLOYMENT NAME                                               
      &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                                              
 1    35620  2009      16349 New York-Northern New Jersey-Long Island, NY-NJ-PA…
 2    19100  2010      13238 Dallas-Fort Worth-Arlington, TX Metro Area         
 3    19100  2011      13283 Dallas-Fort Worth-Arlington, TX Metro Area         
 4    35620  2012      14423 New York-Northern New Jersey-Long Island, NY-NJ-PA…
 5    35620  2013      14251 New York-Northern New Jersey-Long Island, NY-NJ-PA…
 6    35620  2014      17828 New York-Northern New Jersey-Long Island, NY-NJ-PA…
 7    35620  2015      18922 New York-Northern New Jersey-Long Island, NY-NJ-PA…
 8    41860  2016      16369 San Francisco-Oakland-Fremont, CA Metro Area       
 9    41860  2017      18089 San Francisco-Oakland-Fremont, CA Metro Area       
10    41860  2018      22379 San Francisco-Oakland-Fremont, CA Metro Area       
11    41860  2019      24154 San Francisco-Oakland-Fremont, CA Metro Area       
12    12060  2021      15810 Atlanta-Sandy Springs-Marietta, GA Metro Area      
13    41860  2022      34080 San Francisco-Oakland-Fremont, CA Metro Area       
14    41860  2023      32961 San Francisco-Oakland-Fremont, CA Metro Area       </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>last_year_nyc</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
   YEAR NAME                                                          EMPLOYMENT
  &lt;dbl&gt; &lt;chr&gt;                                                              &lt;dbl&gt;
1  2015 New York-Northern New Jersey-Long Island, NY-NJ-PA Metro Area      18922</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Convert BLS CBSA code ("C1234") → Census style ("12340")</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># BLS CBSA code: "C1234" -&gt; 12340</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>wages_clean <span class="ot">&lt;-</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  WAGES <span class="sc">|&gt;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cbsa =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>,<span class="st">""</span>, FIPS), <span class="st">"0"</span>)))</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>nyc_wages <span class="ot">&lt;-</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  wages_clean <span class="sc">|&gt;</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cbsa <span class="sc">==</span> <span class="dv">35620</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_wages_all =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_wages_fin =</span> <span class="fu">sum</span>(TOTAL_WAGES[INDUSTRY <span class="sc">==</span> <span class="dv">52</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">finance_fraction =</span> total_wages_fin <span class="sc">/</span> total_wages_all) <span class="sc">|&gt;</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(finance_fraction))</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="co"># answer rows</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>nyc_wages        <span class="co"># yearly fractions</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 4
    YEAR total_wages_all total_wages_fin finance_fraction
   &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;
 1  2014   2587096519796    119105615711           0.0460
 2  2011   2452875238158    108996581223           0.0444
 3  2010   2366455158958    103632250413           0.0438
 4  2009   2194200174111     94479998021           0.0431
 5  2021   3636399927489    156065553132           0.0429
 6  2012   2543568475824    107816036343           0.0424
 7  2017   3176952501734    130116071763           0.0410
 8  2013   2663041532424    107314017412           0.0403
 9  2018   3196707717054    128706315380           0.0403
10  2015   3008221071967    119431006954           0.0397
11  2016   3038312046515    118586163642           0.0390
12  2022   4104601808975    159178860174           0.0388
13  2023   4160135177511    160765698817           0.0386
14  2019   3617150803059    132713121248           0.0367</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>nyc_wages <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>)   <span class="co"># peak year</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
   YEAR total_wages_all total_wages_fin finance_fraction
  &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;
1  2014   2587096519796    119105615711           0.0460</code></pre>
</div>
</div>
<p>##Task 2</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'scales'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    discard</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:readr':

    col_factor</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CBSA-level data for 2009</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>cbsa_2009 <span class="ot">&lt;-</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  RENT <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, monthly_rent) <span class="sc">|&gt;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    INCOME <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, NAME, year, household_income),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter + OLS fit</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cbsa_2009, <span class="fu">aes</span>(<span class="at">x =</span> household_income, <span class="at">y =</span> monthly_rent)) <span class="sc">+</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Rent vs Household Income by CBSA (2009)"</span>,</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Average household income"</span>,</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average monthly rent"</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp.02_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>total_emp <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">cbsa =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>,<span class="st">""</span>, FIPS), <span class="st">"0"</span>)), YEAR) <span class="sc">|&gt;</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_emp =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) One row per CBSA–year: health care &amp; social assistance (NAICS 62)</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>health_emp <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">62</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">cbsa =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>,<span class="st">""</span>, FIPS), <span class="st">"0"</span>)), YEAR) <span class="sc">|&gt;</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">health_emp =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Join and plot (axes divided by 1,000,000)</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>emp_df <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(total_emp, health_emp, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cbsa"</span>,<span class="st">"YEAR"</span>))</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emp_df, <span class="fu">aes</span>(<span class="at">x =</span> total_emp<span class="sc">/</span><span class="fl">1e6</span>, <span class="at">y =</span> health_emp<span class="sc">/</span><span class="fl">1e6</span>, <span class="at">colour =</span> <span class="fu">factor</span>(cbsa))) <span class="sc">+</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">1.6</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> comma, <span class="at">name =</span> <span class="st">"Total employment (millions)"</span>) <span class="sc">+</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma, <span class="at">name =</span> <span class="st">"Health care employment (millions)"</span>) <span class="sc">+</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> YEAR, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Health care (NAICS 62) vs total employment by CBSA"</span>) <span class="sc">+</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp.02_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gghighlight)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare one row per CBSA-year with population and households</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>hh_pop <span class="ot">&lt;-</span> HOUSEHOLDS <span class="sc">|&gt;</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, households, year) <span class="sc">|&gt;</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, population, year),</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_household_size =</span> population <span class="sc">/</span> households,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">metro_area =</span> <span class="fu">case_when</span>(</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>      GEOID <span class="sc">==</span> <span class="dv">35620</span> <span class="sc">~</span> <span class="st">"NYC"</span>,                 <span class="co"># New York CBSA</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>      GEOID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">31080</span>, <span class="dv">31100</span>) <span class="sc">~</span> <span class="st">"LA"</span>,      <span class="co"># Los Angeles CBSA (codes vary by vintage)</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other CBSAs"</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Line plot over time, one line per CBSA, highlight NYC and LA</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hh_pop, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> avg_household_size, <span class="at">group =</span> GEOID)) <span class="sc">+</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> metro_area), <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> metro_area), <span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gghighlight</span>(</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    metro_area <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"NYC"</span>, <span class="st">"LA"</span>),</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">label_key =</span> metro_area,</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">unhighlighted_params =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>)</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"NYC"</span> <span class="ot">=</span> <span class="st">"#377eb8"</span>, <span class="st">"LA"</span> <span class="ot">=</span> <span class="st">"#e41a1c"</span>, <span class="st">"Other CBSAs"</span> <span class="ot">=</span> <span class="st">"gray80"</span>)) <span class="sc">+</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Evolution of Household Size by CBSA"</span>,</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"NYC and LA highlighted"</span>,</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average household size"</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Tried to calculate with group_by(), but the calculation failed.
Falling back to ungrouped filter operation...
Tried to calculate with group_by(), but the calculation failed.
Falling back to ungrouped filter operation...</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp.02_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>##Task 4</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries (assuming tidyverse and DT are installed)</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>RENT_BURDEN <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(RENT, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>, <span class="st">"NAME"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN =</span> (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(RENT_BURDEN))</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">|&gt;</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">|&gt;</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">BASE_2009 =</span> RENT_BURDEN[year <span class="sc">==</span> <span class="dv">2009</span>][<span class="dv">1</span>],</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_IDX =</span> <span class="dv">100</span> <span class="sc">*</span> RENT_BURDEN <span class="sc">/</span> BASE_2009</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  baseline <span class="sc">|&gt;</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_rent_burden =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_index =</span> <span class="fu">mean</span>(RENT_BURDEN_IDX, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  mean_rent_burden mean_index
             &lt;dbl&gt;      &lt;dbl&gt;
1            0.197       102.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>  scaled_minmax <span class="ot">&lt;-</span> baseline <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_val =</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_val =</span> <span class="fu">max</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_MINMAX =</span> <span class="dv">100</span> <span class="sc">*</span> (RENT_BURDEN <span class="sc">-</span> min_val) <span class="sc">/</span> (max_val <span class="sc">-</span> min_val)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>baseline <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_MINMAX =</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>      <span class="dv">100</span> <span class="sc">*</span> (RENT_BURDEN <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>            (<span class="fu">max</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="dv">12060</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RENT_BURDEN, RENT_BURDEN_IDX, RENT_BURDEN_MINMAX)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 6
   GEOID NAME                year RENT_BURDEN RENT_BURDEN_IDX RENT_BURDEN_MINMAX
   &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;              &lt;dbl&gt;
 1 12060 Atlanta-Sandy Spr…  2009       0.197            100                33.8
 2 12060 Atlanta-Sandy Spr…  2010       0.205            104.               34.9
 3 12060 Atlanta-Sandy Spr…  2011       0.208            106.               38.7
 4 12060 Atlanta-Sandy Spr…  2012       0.204            103.               30.2
 5 12060 Atlanta-Sandy Spr…  2013       0.204            103.               33.6
 6 12060 Atlanta-Sandy Spr…  2014       0.210            106.               31.6
 7 12060 Atlanta-Sandy Spr…  2015       0.202            103.               36.8
 8 12060 Atlanta-Sandy Spr…  2016       0.205            104.               36.2
 9 12060 Atlanta-Sandy Spr…  2017       0.205            104.               36.5
10 12060 Atlanta-Sandy Spr…  2018       0.202            102.               29.6
11 12060 Atlanta-Sandy Spr…  2019       0.205            104.               41.1
12 12060 Atlanta-Sandy Spr…  2021       0.212            107.               48.0
13 12060 Atlanta-Sandy Spr…  2022       0.219            111.               44.3
14 12060 Atlanta-Sandy Spr…  2023       0.236            120.               58.9</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute yearly scaling and summarize by metro</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>extremes <span class="ot">&lt;-</span> baseline <span class="sc">|&gt;</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_MINMAX =</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>      <span class="dv">100</span> <span class="sc">*</span> (RENT_BURDEN <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>            (<span class="fu">max</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME) <span class="sc">|&gt;</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_rent_burden =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_scaled      =</span> <span class="fu">mean</span>(RENT_BURDEN_MINMAX, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_scaled))</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 5 metros with highest rent burden</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>top_5 <span class="ot">&lt;-</span> extremes <span class="sc">|&gt;</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Bottom 5 metros with lowest rent burden</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>bottom_5 <span class="ot">&lt;-</span> extremes <span class="sc">|&gt;</span> <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>top_5</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  NAME                                           mean_rent_burden mean_scaled
  &lt;chr&gt;                                                     &lt;dbl&gt;       &lt;dbl&gt;
1 Aguadilla, PR Metro Area                                  0.309        98.5
2 San Germán, PR Metro Area                                 0.313        88.5
3 Aguadilla-Isabela-San Sebasti?n, PR Metro Area            0.313        87.4
4 Coamo, PR Micro Area                                      0.313        85.3
5 Aguadilla-Isabela, PR Metro Area                          0.305        85.2</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>bottom_5</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  NAME                          mean_rent_burden mean_scaled
  &lt;chr&gt;                                    &lt;dbl&gt;       &lt;dbl&gt;
1 Wausau-Weston, WI Metro Area             0.141        6.59
2 Bismarck, ND Metro Area                  0.140        5.12
3 Cedar Rapids, IA Metro Area              0.139        4.71
4 Jefferson City, MO Metro Area            0.138        4.03
5 Laconia, NH Micro Area                   0.127        0   </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) 5-year population growth (needed for the rate-based metric)</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>pop_growth_5yr <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(GEOID, year) <span class="sc">|&gt;</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">|&gt;</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">POP_5YR_AGO    =</span> <span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">POP_GROWTH_5YR =</span> (population <span class="sc">-</span> POP_5YR_AGO) <span class="sc">/</span> POP_5YR_AGO</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2014</span>) <span class="sc">|&gt;</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Instantaneous housing growth: (new units / population) * 1000</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>instant <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(PERMITS, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span> <span class="ot">=</span> <span class="st">"CBSA"</span>, <span class="st">"year"</span> <span class="ot">=</span> <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">INSTANT_PER_1K =</span> <span class="dv">1000</span> <span class="sc">*</span> new_housing_units_permitted <span class="sc">/</span> population</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if your column is named new_housing_units_permitted, use that instead</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Rate-based: permits per 1k divided by 5-year population growth</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>rate_based <span class="ot">&lt;-</span> pop_growth_5yr <span class="sc">|&gt;</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(PERMITS, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span> <span class="ot">=</span> <span class="st">"CBSA"</span>, <span class="st">"year"</span> <span class="ot">=</span> <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">PERMITS_PER_1K  =</span> <span class="dv">1000</span> <span class="sc">*</span> new_housing_units_permitted <span class="sc">/</span> population,</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">RATE_VS_POP_5YR =</span> PERMITS_PER_1K <span class="sc">/</span> POP_GROWTH_5YR</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RATE_VS_POP_5YR)</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Final table with both metrics (years &gt;= 2014)</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>housing_metrics <span class="ot">&lt;-</span> instant <span class="sc">|&gt;</span></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(rate_based, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"NAME"</span>, <span class="st">"year"</span>))</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>housing_metrics</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,437 × 5
   GEOID NAME                                year INSTANT_PER_1K RATE_VS_POP_5YR
   &lt;dbl&gt; &lt;chr&gt;                              &lt;dbl&gt;          &lt;dbl&gt;           &lt;dbl&gt;
 1 10180 Abilene, TX Metro Area              2014          1.70             41.1
 2 10420 Akron, OH Metro Area                2014          1.08            195. 
 3 10500 Albany, GA Metro Area               2014          1.78            -25.1
 4 10540 Albany, OR Metro Area               2014          3.29             NA  
 5 10580 Albany-Schenectady-Troy, NY Metro…  2014          2.53             96.3
 6 10740 Albuquerque, NM Metro Area          2014          2.81             49.1
 7 10780 Alexandria, LA Metro Area           2014          2.09            417. 
 8 10900 Allentown-Bethlehem-Easton, PA-NJ…  2014          2.17            128. 
 9 11020 Altoona, PA Metro Area              2014          0.794          -600. 
10 11100 Amarillo, TX Metro Area             2014          3.51             53.7
# ℹ 3,427 more rows</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># assuming you already built `housing_metrics`</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># with columns: GEOID, NAME, year, INSTANT_PER_1K, RATE_VS_POP_5YR</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>housing_metrics_z <span class="ot">&lt;-</span> housing_metrics <span class="sc">|&gt;</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">INSTANT_Z =</span> (INSTANT_PER_1K  <span class="sc">-</span> <span class="fu">mean</span>(INSTANT_PER_1K,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sd</span>(INSTANT_PER_1K,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">RATE_Z    =</span> (RATE_VS_POP_5YR <span class="sc">-</span> <span class="fu">mean</span>(RATE_VS_POP_5YR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sd</span>(RATE_VS_POP_5YR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">COMPOSITE_Z =</span> <span class="fl">0.5</span> <span class="sc">*</span> INSTANT_Z <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> RATE_Z</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 and bottom 10 by instantaneous z (any year)</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>top10_instant <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(INSTANT_Z)) <span class="sc">|&gt;</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, INSTANT_Z) <span class="sc">|&gt;</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>bottom10_instant <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(INSTANT_Z) <span class="sc">|&gt;</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, INSTANT_Z) <span class="sc">|&gt;</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 and bottom 10 by rate-based z (any year)</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>top10_rate <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(RATE_Z)) <span class="sc">|&gt;</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RATE_VS_POP_5YR, RATE_Z) <span class="sc">|&gt;</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>bottom10_rate <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(RATE_Z) <span class="sc">|&gt;</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RATE_VS_POP_5YR, RATE_Z) <span class="sc">|&gt;</span></span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>top10_instant</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   GEOID NAME                                      year INSTANT_PER_1K INSTANT_Z
   &lt;dbl&gt; &lt;chr&gt;                                    &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;
 1 41540 Salisbury, MD Metro Area                  2023           37.7      9.56
 2 45540 The Villages, FL Metro Area               2021           34.0      8.49
 3 34820 Myrtle Beach-Conway-North Myrtle Beach,…  2023           33.1      8.25
 4 45540 The Villages, FL Metro Area               2022           30.6      7.53
 5 39460 Punta Gorda, FL Metro Area                2022           28.0      6.78
 6 39460 Punta Gorda, FL Metro Area                2021           24.8      5.86
 7 34820 Myrtle Beach-Conway-North Myrtle Beach,…  2021           24.0      5.63
 8 45540 The Villages, FL Metro Area               2014           22.5      5.20
 9 34820 Myrtle Beach-Conway-North Myrtle Beach,…  2022           22.4      5.18
10 45540 The Villages, FL Metro Area               2019           22.1      5.10</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>bottom10_instant</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   GEOID NAME                        year INSTANT_PER_1K INSTANT_Z
   &lt;dbl&gt; &lt;chr&gt;                      &lt;dbl&gt;          &lt;dbl&gt;     &lt;dbl&gt;
 1 19180 Danville, IL Metro Area     2022         0.0276     -1.21
 2 21820 Fairbanks, AK Metro Area    2015         0.0703     -1.20
 3 19180 Danville, IL Metro Area     2014         0.0753     -1.19
 4 34060 Morgantown, WV Metro Area   2022         0.0780     -1.19
 5 48540 Wheeling, WV-OH Metro Area  2023         0.0812     -1.19
 6 19180 Danville, IL Metro Area     2021         0.0821     -1.19
 7 48540 Wheeling, WV-OH Metro Area  2019         0.0864     -1.19
 8 21820 Fairbanks, AK Metro Area    2016         0.109      -1.18
 9 19180 Danville, IL Micro Area     2023         0.112      -1.18
10 34060 Morgantown, WV Metro Area   2023         0.120      -1.18</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>top10_rate</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   GEOID NAME                                    year RATE_VS_POP_5YR RATE_Z
   &lt;dbl&gt; &lt;chr&gt;                                  &lt;dbl&gt;           &lt;dbl&gt;  &lt;dbl&gt;
 1 33660 Mobile, AL Metro Area                   2017          52524.  35.8 
 2 35100 New Bern, NC Metro Area                 2019          30662.  20.9 
 3 48140 Wausau, WI Metro Area                   2018          25664.  17.5 
 4 22520 Florence-Muscle Shoals, AL Metro Area   2017          15495.  10.5 
 5 38300 Pittsburgh, PA Metro Area               2021          10592.   7.17
 6 17860 Columbia, MO Metro Area                 2017           9603.   6.50
 7 10580 Albany-Schenectady-Troy, NY Metro Area  2019           8736.   5.91
 8 33780 Monroe, MI Metro Area                   2018           7806.   5.27
 9 30340 Lewiston-Auburn, ME Metro Area          2017           5998.   4.03
10 22540 Fond du Lac, WI Metro Area              2016           5612.   3.77</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>bottom10_rate</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   GEOID NAME                                        year RATE_VS_POP_5YR RATE_Z
   &lt;dbl&gt; &lt;chr&gt;                                      &lt;dbl&gt;           &lt;dbl&gt;  &lt;dbl&gt;
 1 40220 Roanoke, VA Metro Area                      2019         -17124. -11.8 
 2 21780 Evansville, IN-KY Metro Area                2019         -12240.  -8.43
 3 37100 Oxnard-Thousand Oaks-Ventura, CA Metro Ar…  2019          -6664.  -4.62
 4 37620 Parkersburg-Vienna, WV Metro Area           2018          -6251.  -4.34
 5 43420 Sierra Vista-Douglas, AZ Metro Area         2022          -4948.  -3.45
 6 35380 New Orleans-Metairie, LA Metro Area         2021          -4550.  -3.18
 7 44940 Sumter, SC Metro Area                       2016          -4268.  -2.98
 8 43420 Sierra Vista-Douglas, AZ Metro Area         2023          -4194.  -2.93
 9 29100 La Crosse-Onalaska, WI-MN Metro Area        2019          -4072.  -2.85
10 22500 Florence, SC Metro Area                     2017          -3993.  -2.80</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: top/bottom by composite (any year)</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>top10_composite <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(COMPOSITE_Z)) <span class="sc">|&gt;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, RATE_VS_POP_5YR, COMPOSITE_Z) <span class="sc">|&gt;</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>bottom10_composite <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(COMPOSITE_Z) <span class="sc">|&gt;</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, RATE_VS_POP_5YR, COMPOSITE_Z) <span class="sc">|&gt;</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>top10_composite</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   GEOID NAME                    year INSTANT_PER_1K RATE_VS_POP_5YR COMPOSITE_Z
   &lt;dbl&gt; &lt;chr&gt;                  &lt;dbl&gt;          &lt;dbl&gt;           &lt;dbl&gt;       &lt;dbl&gt;
 1 33660 Mobile, AL Metro Area   2017           2.41          52524.       17.7 
 2 35100 New Bern, NC Metro Ar…  2019           4.32          30662.       10.5 
 3 48140 Wausau, WI Metro Area   2018           2.27          25664.        8.46
 4 22520 Florence-Muscle Shoal…  2017           5.27          15495.        5.41
 5 45540 The Villages, FL Metr…  2021          34.0             241.        4.30
 6 17860 Columbia, MO Metro Ar…  2017           9.17           9603.        3.95
 7 45540 The Villages, FL Metr…  2022          30.6             181.        3.79
 8 39460 Punta Gorda, FL Metro…  2022          28.0             207.        3.43
 9 38300 Pittsburgh, PA Metro …  2021           2.22          10592.        3.30
10 39460 Punta Gorda, FL Metro…  2021          24.8             198.        2.97</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>bottom10_composite</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   GEOID NAME                    year INSTANT_PER_1K RATE_VS_POP_5YR COMPOSITE_Z
   &lt;dbl&gt; &lt;chr&gt;                  &lt;dbl&gt;          &lt;dbl&gt;           &lt;dbl&gt;       &lt;dbl&gt;
 1 40220 Roanoke, VA Metro Area  2019           2.24         -17124.       -6.17
 2 21780 Evansville, IN-KY Met…  2019           2.95         -12240.       -4.40
 3 37100 Oxnard-Thousand Oaks-…  2019           1.35          -6664.       -2.73
 4 37620 Parkersburg-Vienna, W…  2018           1.35          -6251.       -2.58
 5 44940 Sumter, SC Metro Area   2016           2.54          -4268.       -1.74
 6 43420 Sierra Vista-Douglas,…  2022           4.21          -4948.       -1.73
 7 24140 Goldsboro, NC Metro A…  2017           2.25          -3786.       -1.61
 8 35380 New Orleans-Metairie,…  2021           4.19          -4550.       -1.60
 9 43420 Sierra Vista-Douglas,…  2023           3.90          -4194.       -1.52
10 29100 La Crosse-Onalaska, W…  2019           3.96          -4072.       -1.47</code></pre>
</div>
</div>
<p>##Task 6</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(WAGES)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,442,181
Columns: 6
$ YEAR        &lt;dbl&gt; 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009…
$ FIPS        &lt;chr&gt; "C1018", "C1018", "C1018", "C1018", "C1018", "C1018", "C10…
$ INDUSTRY    &lt;dbl&gt; 101, 1011, 1012, 1013, 102, 1021, 1022, 1023, 1024, 1025, …
$ EMPLOYMENT  &lt;dbl&gt; 8050, 1769, 3328, 2952, 42334, 11993, 0, 3575, 4697, 11950…
$ TOTAL_WAGES &lt;dbl&gt; 342280951, 86660038, 151822573, 103798340, 1284997543, 368…
$ AVG_WAGE    &lt;dbl&gt; 42519.37, 48988.15, 45619.76, 35162.04, 30353.79, 30764.23…</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(INDUSTRY_CODES)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 801
Columns: 8
$ level1_title &lt;chr&gt; "Agriculture, forestry, fishing and hunting", "Agricultur…
$ level2_title &lt;chr&gt; "Crop production", "Crop production", "Crop production", …
$ level3_title &lt;chr&gt; "Oilseed and grain farming", "Oilseed and grain farming",…
$ level4_title &lt;chr&gt; "Soybean farming", "Oilseed (except soybean) farming", "D…
$ level1_code  &lt;dbl&gt; 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 1…
$ level2_code  &lt;chr&gt; "111", "111", "111", "111", "111", "111", "111", "111", "…
$ level3_code  &lt;chr&gt; "1111", "1111", "1111", "1111", "1111", "1111", "1111", "…
$ level4_code  &lt;chr&gt; "11111", "11112", "11113", "11114", "11115", "11116", "11…</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(PERMITS)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,658
Columns: 3
$ CBSA                        &lt;dbl&gt; 10180, 10420, 10500, 10580, 10740, 10780, …
$ new_housing_units_permitted &lt;dbl&gt; 214, 741, 213, 1380, 1692, 396, 1648, 125,…
$ year                        &lt;dbl&gt; 2009, 2009, 2009, 2009, 2009, 2009, 2009, …</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(INCOME)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,279
Columns: 4
$ GEOID            &lt;dbl&gt; 10140, 10180, 10300, 10380, 10420, 10500, 10540, 1058…
$ NAME             &lt;chr&gt; "Aberdeen, WA Micro Area", "Abilene, TX Metro Area", …
$ household_income &lt;dbl&gt; 36345, 42931, 45640, 13470, 47482, 36218, 47669, 5767…
$ year             &lt;dbl&gt; 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009,…</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(RENT)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,279
Columns: 4
$ GEOID        &lt;dbl&gt; 10140, 10180, 10300, 10380, 10420, 10500, 10540, 10580, 1…
$ NAME         &lt;chr&gt; "Aberdeen, WA Micro Area", "Abilene, TX Metro Area", "Adr…
$ monthly_rent &lt;dbl&gt; 650, 712, 645, 363, 723, 624, 761, 833, 579, 726, 668, 65…
$ year         &lt;dbl&gt; 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 200…</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(POPULATION)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,279
Columns: 4
$ GEOID      &lt;dbl&gt; 10140, 10180, 10300, 10380, 10420, 10500, 10540, 10580, 107…
$ NAME       &lt;chr&gt; "Aberdeen, WA Micro Area", "Abilene, TX Metro Area", "Adria…
$ population &lt;dbl&gt; 71797, 160266, 99837, 342495, 699935, 164238, 116584, 85759…
$ year       &lt;dbl&gt; 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009,…</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HOUSEHOLDS)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,279
Columns: 4
$ GEOID      &lt;dbl&gt; 10140, 10180, 10300, 10380, 10420, 10500, 10540, 10580, 107…
$ NAME       &lt;chr&gt; "Aberdeen, WA Micro Area", "Abilene, TX Metro Area", "Adria…
$ households &lt;dbl&gt; 27759, 58052, 36835, 91805, 281769, 60101, 43953, 336492, 3…
$ year       &lt;dbl&gt; 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009, 2009,…</code></pre>
</div>
</div>


<!-- -->


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/<madisonbrinson>\.github\.io\/STA9750-2025-FALL\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb77" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "mp02"</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true  </span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true </span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>))){</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>library <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Mask base::library() to automatically install packages if needed</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Masking is important here so downlit picks up packages and links</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## to documentation</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>))</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>get_acs_all_years <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">geography=</span><span class="st">"cbsa"</span>,</span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>                              <span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{variable}_{geography}_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop 2020 - No survey (covid)</span></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a>      tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(geography, variable, <span class="at">year=</span>yy, <span class="at">survey=</span><span class="st">"acs1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year=</span>yy) <span class="sc">|&gt;</span></span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span>moe, <span class="sc">-</span>variable) <span class="sc">|&gt;</span></span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="sc">!!</span><span class="at">variable :=</span> estimate)</span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-53"><a href="#cb77-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-54"><a href="#cb77-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income (12 month)</span></span>
<span id="cb77-55"><a href="#cb77-55" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B19013_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-56"><a href="#cb77-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">household_income =</span> B19013_001)</span>
<span id="cb77-57"><a href="#cb77-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-58"><a href="#cb77-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly rent</span></span>
<span id="cb77-59"><a href="#cb77-59" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B25064_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-60"><a href="#cb77-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">monthly_rent =</span> B25064_001)</span>
<span id="cb77-61"><a href="#cb77-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-62"><a href="#cb77-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Total population</span></span>
<span id="cb77-63"><a href="#cb77-63" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01003_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-64"><a href="#cb77-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">population =</span> B01003_001)</span>
<span id="cb77-65"><a href="#cb77-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-66"><a href="#cb77-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of households</span></span>
<span id="cb77-67"><a href="#cb77-67" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B11001_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-68"><a href="#cb77-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">households =</span> B11001_001)</span>
<span id="cb77-69"><a href="#cb77-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-70"><a href="#cb77-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-73"><a href="#cb77-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-74"><a href="#cb77-74" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb77-75"><a href="#cb77-75" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb77-76"><a href="#cb77-76" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb77-77"><a href="#cb77-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-78"><a href="#cb77-78" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb77-79"><a href="#cb77-79" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb77-80"><a href="#cb77-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-81"><a href="#cb77-81" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb77-82"><a href="#cb77-82" aria-hidden="true" tabindex="-1"></a>      historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb77-83"><a href="#cb77-83" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-84"><a href="#cb77-84" aria-hidden="true" tabindex="-1"></a>      LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb77-85"><a href="#cb77-85" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-86"><a href="#cb77-86" aria-hidden="true" tabindex="-1"></a>      CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb77-87"><a href="#cb77-87" aria-hidden="true" tabindex="-1"></a>      CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb77-88"><a href="#cb77-88" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-89"><a href="#cb77-89" aria-hidden="true" tabindex="-1"></a>      PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb77-90"><a href="#cb77-90" aria-hidden="true" tabindex="-1"></a>      PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb77-91"><a href="#cb77-91" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-92"><a href="#cb77-92" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb77-93"><a href="#cb77-93" aria-hidden="true" tabindex="-1"></a>                 <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb77-94"><a href="#cb77-94" aria-hidden="true" tabindex="-1"></a>                 <span class="at">year =</span> yy)</span>
<span id="cb77-95"><a href="#cb77-95" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb77-96"><a href="#cb77-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-97"><a href="#cb77-97" aria-hidden="true" tabindex="-1"></a>    CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb77-98"><a href="#cb77-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-99"><a href="#cb77-99" aria-hidden="true" tabindex="-1"></a>    CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb77-100"><a href="#cb77-100" aria-hidden="true" tabindex="-1"></a>      current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb77-101"><a href="#cb77-101" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-102"><a href="#cb77-102" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb77-103"><a href="#cb77-103" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-104"><a href="#cb77-104" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb77-105"><a href="#cb77-105" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-106"><a href="#cb77-106" aria-hidden="true" tabindex="-1"></a>      fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb77-107"><a href="#cb77-107" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(...){</span>
<span id="cb77-108"><a href="#cb77-108" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb77-109"><a href="#cb77-109" aria-hidden="true" tabindex="-1"></a>                   <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb77-110"><a href="#cb77-110" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb77-111"><a href="#cb77-111" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb77-112"><a href="#cb77-112" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-113"><a href="#cb77-113" aria-hidden="true" tabindex="-1"></a>      reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb77-114"><a href="#cb77-114" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-115"><a href="#cb77-115" aria-hidden="true" tabindex="-1"></a>      <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-116"><a href="#cb77-116" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb77-117"><a href="#cb77-117" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb77-118"><a href="#cb77-118" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb77-119"><a href="#cb77-119" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb77-120"><a href="#cb77-120" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb77-121"><a href="#cb77-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-122"><a href="#cb77-122" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb77-123"><a href="#cb77-123" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-124"><a href="#cb77-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb77-125"><a href="#cb77-125" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-126"><a href="#cb77-126" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-127"><a href="#cb77-127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-128"><a href="#cb77-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb77-129"><a href="#cb77-129" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-130"><a href="#cb77-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-131"><a href="#cb77-131" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span>
<span id="cb77-132"><a href="#cb77-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-133"><a href="#cb77-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-136"><a href="#cb77-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-137"><a href="#cb77-137" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb77-138"><a href="#cb77-138" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb77-139"><a href="#cb77-139" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb77-140"><a href="#cb77-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-141"><a href="#cb77-141" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb77-142"><a href="#cb77-142" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb77-143"><a href="#cb77-143" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-144"><a href="#cb77-144" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb77-145"><a href="#cb77-145" aria-hidden="true" tabindex="-1"></a>      historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb77-146"><a href="#cb77-146" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-147"><a href="#cb77-147" aria-hidden="true" tabindex="-1"></a>      LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb77-148"><a href="#cb77-148" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-149"><a href="#cb77-149" aria-hidden="true" tabindex="-1"></a>      CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb77-150"><a href="#cb77-150" aria-hidden="true" tabindex="-1"></a>      CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb77-151"><a href="#cb77-151" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-152"><a href="#cb77-152" aria-hidden="true" tabindex="-1"></a>      PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb77-153"><a href="#cb77-153" aria-hidden="true" tabindex="-1"></a>      PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb77-154"><a href="#cb77-154" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-155"><a href="#cb77-155" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb77-156"><a href="#cb77-156" aria-hidden="true" tabindex="-1"></a>                 <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb77-157"><a href="#cb77-157" aria-hidden="true" tabindex="-1"></a>                 <span class="at">year =</span> yy)</span>
<span id="cb77-158"><a href="#cb77-158" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb77-159"><a href="#cb77-159" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-160"><a href="#cb77-160" aria-hidden="true" tabindex="-1"></a>    CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb77-161"><a href="#cb77-161" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-162"><a href="#cb77-162" aria-hidden="true" tabindex="-1"></a>    CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb77-163"><a href="#cb77-163" aria-hidden="true" tabindex="-1"></a>      current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb77-164"><a href="#cb77-164" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-165"><a href="#cb77-165" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb77-166"><a href="#cb77-166" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-167"><a href="#cb77-167" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb77-168"><a href="#cb77-168" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-169"><a href="#cb77-169" aria-hidden="true" tabindex="-1"></a>      fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb77-170"><a href="#cb77-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(...){</span>
<span id="cb77-171"><a href="#cb77-171" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb77-172"><a href="#cb77-172" aria-hidden="true" tabindex="-1"></a>                   <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb77-173"><a href="#cb77-173" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb77-174"><a href="#cb77-174" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb77-175"><a href="#cb77-175" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-176"><a href="#cb77-176" aria-hidden="true" tabindex="-1"></a>      reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb77-177"><a href="#cb77-177" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-178"><a href="#cb77-178" aria-hidden="true" tabindex="-1"></a>      <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-179"><a href="#cb77-179" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb77-180"><a href="#cb77-180" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb77-181"><a href="#cb77-181" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb77-182"><a href="#cb77-182" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb77-183"><a href="#cb77-183" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb77-184"><a href="#cb77-184" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-185"><a href="#cb77-185" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb77-186"><a href="#cb77-186" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-187"><a href="#cb77-187" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb77-188"><a href="#cb77-188" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-189"><a href="#cb77-189" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-190"><a href="#cb77-190" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-191"><a href="#cb77-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb77-192"><a href="#cb77-192" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-193"><a href="#cb77-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-194"><a href="#cb77-194" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span>
<span id="cb77-195"><a href="#cb77-195" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-196"><a href="#cb77-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-199"><a href="#cb77-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-200"><a href="#cb77-200" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb77-201"><a href="#cb77-201" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb77-202"><a href="#cb77-202" aria-hidden="true" tabindex="-1"></a>get_bls_industry_codes <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb77-203"><a href="#cb77-203" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="st">"bls_industry_codes.csv"</span>)</span>
<span id="cb77-204"><a href="#cb77-204" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-205"><a href="#cb77-205" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb77-206"><a href="#cb77-206" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-207"><a href="#cb77-207" aria-hidden="true" tabindex="-1"></a>    resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb77-208"><a href="#cb77-208" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"classifications"</span>, <span class="st">"industry"</span>, <span class="st">"industry-titles.htm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-209"><a href="#cb77-209" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb77-210"><a href="#cb77-210" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_error</span>(<span class="at">is_error =</span> \(resp) <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-211"><a href="#cb77-211" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_perform</span>()</span>
<span id="cb77-212"><a href="#cb77-212" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-213"><a href="#cb77-213" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_check_status</span>(resp)</span>
<span id="cb77-214"><a href="#cb77-214" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-215"><a href="#cb77-215" aria-hidden="true" tabindex="-1"></a>    naics_table <span class="ot">&lt;-</span> <span class="fu">resp_body_html</span>(resp) <span class="sc">|&gt;</span></span>
<span id="cb77-216"><a href="#cb77-216" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_element</span>(<span class="st">"#naics_titles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb77-217"><a href="#cb77-217" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb77-218"><a href="#cb77-218" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(<span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>, Code), <span class="st">"NAICS"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb77-219"><a href="#cb77-219" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-220"><a href="#cb77-220" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">depth =</span> <span class="fu">if_else</span>(<span class="fu">nchar</span>(Code) <span class="sc">&lt;=</span> <span class="dv">5</span>, <span class="fu">nchar</span>(Code) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">|&gt;</span></span>
<span id="cb77-221"><a href="#cb77-221" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(depth))</span>
<span id="cb77-222"><a href="#cb77-222" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-223"><a href="#cb77-223" aria-hidden="true" tabindex="-1"></a>    naics_table <span class="ot">&lt;-</span> naics_table <span class="sc">|&gt;</span> </span>
<span id="cb77-224"><a href="#cb77-224" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb77-225"><a href="#cb77-225" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level4_title=</span>title) <span class="sc">|&gt;</span> </span>
<span id="cb77-226"><a href="#cb77-226" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">level1_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">2</span>), </span>
<span id="cb77-227"><a href="#cb77-227" aria-hidden="true" tabindex="-1"></a>             <span class="at">level2_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">3</span>), </span>
<span id="cb77-228"><a href="#cb77-228" aria-hidden="true" tabindex="-1"></a>             <span class="at">level3_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb77-229"><a href="#cb77-229" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level1_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb77-230"><a href="#cb77-230" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level1_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb77-231"><a href="#cb77-231" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level2_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb77-232"><a href="#cb77-232" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level2_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb77-233"><a href="#cb77-233" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level3_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb77-234"><a href="#cb77-234" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level3_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb77-235"><a href="#cb77-235" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"depth"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb77-236"><a href="#cb77-236" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level4_code =</span> Code) <span class="sc">|&gt;</span></span>
<span id="cb77-237"><a href="#cb77-237" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(level1_title, level2_title, level3_title, level4_title, </span>
<span id="cb77-238"><a href="#cb77-238" aria-hidden="true" tabindex="-1"></a>             level1_code,  level2_code,  level3_code,  level4_code)</span>
<span id="cb77-239"><a href="#cb77-239" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-240"><a href="#cb77-240" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(naics_table, fname)</span>
<span id="cb77-241"><a href="#cb77-241" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-242"><a href="#cb77-242" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-243"><a href="#cb77-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb77-244"><a href="#cb77-244" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-245"><a href="#cb77-245" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-246"><a href="#cb77-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-247"><a href="#cb77-247" aria-hidden="true" tabindex="-1"></a>INDUSTRY_CODES <span class="ot">&lt;-</span> <span class="fu">get_bls_industry_codes</span>()</span>
<span id="cb77-248"><a href="#cb77-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-249"><a href="#cb77-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-250"><a href="#cb77-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-253"><a href="#cb77-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-254"><a href="#cb77-254" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb77-255"><a href="#cb77-255" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb77-256"><a href="#cb77-256" aria-hidden="true" tabindex="-1"></a>get_bls_qcew_annual_averages <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb77-257"><a href="#cb77-257" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"bls_qcew_{start_year}_{end_year}.csv.gz"</span>)</span>
<span id="cb77-258"><a href="#cb77-258" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb77-259"><a href="#cb77-259" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-260"><a href="#cb77-260" aria-hidden="true" tabindex="-1"></a>  YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb77-261"><a href="#cb77-261" aria-hidden="true" tabindex="-1"></a>  YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop Covid year to match ACS</span></span>
<span id="cb77-262"><a href="#cb77-262" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-263"><a href="#cb77-263" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb77-264"><a href="#cb77-264" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="at">.progress=</span><span class="cn">TRUE</span>, <span class="fu">possibly</span>(<span class="cf">function</span>(yy){</span>
<span id="cb77-265"><a href="#cb77-265" aria-hidden="true" tabindex="-1"></a>      fname_inner <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="fu">glue</span>(<span class="st">"{yy}_qcew_annual_singlefile.zip"</span>))</span>
<span id="cb77-266"><a href="#cb77-266" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-267"><a href="#cb77-267" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname_inner)){</span>
<span id="cb77-268"><a href="#cb77-268" aria-hidden="true" tabindex="-1"></a>        <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb77-269"><a href="#cb77-269" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"data"</span>, <span class="st">"files"</span>, yy, <span class="st">"csv"</span>,</span>
<span id="cb77-270"><a href="#cb77-270" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">glue</span>(<span class="st">"{yy}_annual_singlefile.zip"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb77-271"><a href="#cb77-271" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb77-272"><a href="#cb77-272" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_retry</span>(<span class="at">max_tries=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-273"><a href="#cb77-273" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_perform</span>(fname_inner)</span>
<span id="cb77-274"><a href="#cb77-274" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb77-275"><a href="#cb77-275" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-276"><a href="#cb77-276" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">file.info</span>(fname_inner)<span class="sc">$</span>size <span class="sc">&lt;</span> <span class="fl">755e5</span>){</span>
<span id="cb77-277"><a href="#cb77-277" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sQuote</span>(fname_inner), <span class="st">"appears corrupted. Please delete and retry this step."</span>)</span>
<span id="cb77-278"><a href="#cb77-278" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb77-279"><a href="#cb77-279" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb77-280"><a href="#cb77-280" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_csv</span>(fname_inner, </span>
<span id="cb77-281"><a href="#cb77-281" aria-hidden="true" tabindex="-1"></a>               <span class="at">show_col_types=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb77-282"><a href="#cb77-282" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">YEAR =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb77-283"><a href="#cb77-283" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(area_fips, </span>
<span id="cb77-284"><a href="#cb77-284" aria-hidden="true" tabindex="-1"></a>               industry_code, </span>
<span id="cb77-285"><a href="#cb77-285" aria-hidden="true" tabindex="-1"></a>               annual_avg_emplvl, </span>
<span id="cb77-286"><a href="#cb77-286" aria-hidden="true" tabindex="-1"></a>               total_annual_wages, </span>
<span id="cb77-287"><a href="#cb77-287" aria-hidden="true" tabindex="-1"></a>               YEAR) <span class="sc">|&gt;</span></span>
<span id="cb77-288"><a href="#cb77-288" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="fu">nchar</span>(industry_code) <span class="sc">&lt;=</span> <span class="dv">5</span>, </span>
<span id="cb77-289"><a href="#cb77-289" aria-hidden="true" tabindex="-1"></a>               <span class="fu">str_starts</span>(area_fips, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb77-290"><a href="#cb77-290" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="fu">str_detect</span>(industry_code, <span class="st">"-"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb77-291"><a href="#cb77-291" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">FIPS =</span> area_fips, </span>
<span id="cb77-292"><a href="#cb77-292" aria-hidden="true" tabindex="-1"></a>               <span class="at">INDUSTRY =</span> <span class="fu">as.integer</span>(industry_code), </span>
<span id="cb77-293"><a href="#cb77-293" aria-hidden="true" tabindex="-1"></a>               <span class="at">EMPLOYMENT =</span> <span class="fu">as.integer</span>(annual_avg_emplvl), </span>
<span id="cb77-294"><a href="#cb77-294" aria-hidden="true" tabindex="-1"></a>               <span class="at">TOTAL_WAGES =</span> total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb77-295"><a href="#cb77-295" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span>area_fips, </span>
<span id="cb77-296"><a href="#cb77-296" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>industry_code, </span>
<span id="cb77-297"><a href="#cb77-297" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>annual_avg_emplvl, </span>
<span id="cb77-298"><a href="#cb77-298" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb77-299"><a href="#cb77-299" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 10 is a special value: "all industries" , so omit</span></span>
<span id="cb77-300"><a href="#cb77-300" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(INDUSTRY <span class="sc">!=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb77-301"><a href="#cb77-301" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">AVG_WAGE =</span> TOTAL_WAGES <span class="sc">/</span> EMPLOYMENT)</span>
<span id="cb77-302"><a href="#cb77-302" aria-hidden="true" tabindex="-1"></a>    })) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb77-303"><a href="#cb77-303" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-304"><a href="#cb77-304" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb77-305"><a href="#cb77-305" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-306"><a href="#cb77-306" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-307"><a href="#cb77-307" aria-hidden="true" tabindex="-1"></a>  ALL_DATA <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb77-308"><a href="#cb77-308" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-309"><a href="#cb77-309" aria-hidden="true" tabindex="-1"></a>  ALL_DATA_YEARS <span class="ot">&lt;-</span> <span class="fu">unique</span>(ALL_DATA<span class="sc">$</span>YEAR)</span>
<span id="cb77-310"><a href="#cb77-310" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-311"><a href="#cb77-311" aria-hidden="true" tabindex="-1"></a>  YEARS_DIFF <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(YEARS, ALL_DATA_YEARS)</span>
<span id="cb77-312"><a href="#cb77-312" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-313"><a href="#cb77-313" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(YEARS_DIFF) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb77-314"><a href="#cb77-314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Download failed for the following years: "</span>, YEARS_DIFF, </span>
<span id="cb77-315"><a href="#cb77-315" aria-hidden="true" tabindex="-1"></a>         <span class="st">". Please delete intermediate files and try again."</span>)</span>
<span id="cb77-316"><a href="#cb77-316" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-317"><a href="#cb77-317" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-318"><a href="#cb77-318" aria-hidden="true" tabindex="-1"></a>  ALL_DATA</span>
<span id="cb77-319"><a href="#cb77-319" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-320"><a href="#cb77-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-321"><a href="#cb77-321" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> <span class="fu">get_bls_qcew_annual_averages</span>()</span>
<span id="cb77-322"><a href="#cb77-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-323"><a href="#cb77-323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-324"><a href="#cb77-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-325"><a href="#cb77-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-326"><a href="#cb77-326" aria-hidden="true" tabindex="-1"></a>##Task 1</span>
<span id="cb77-329"><a href="#cb77-329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-330"><a href="#cb77-330" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb77-331"><a href="#cb77-331" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-332"><a href="#cb77-332" aria-hidden="true" tabindex="-1"></a><span class="co">#finding CSBA name in income data</span></span>
<span id="cb77-333"><a href="#cb77-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-334"><a href="#cb77-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-335"><a href="#cb77-335" aria-hidden="true" tabindex="-1"></a>CBSA_NAME <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb77-336"><a href="#cb77-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(GEOID, NAME) <span class="sc">|&gt;</span></span>
<span id="cb77-337"><a href="#cb77-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(GEOID))</span>
<span id="cb77-338"><a href="#cb77-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-339"><a href="#cb77-339" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb77-340"><a href="#cb77-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)) <span class="sc">|&gt;</span></span>
<span id="cb77-341"><a href="#cb77-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(CBSA_NAME <span class="sc">|&gt;</span> <span class="fu">select</span>(CBSA, NAME), <span class="at">by =</span> <span class="st">"CBSA"</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-342"><a href="#cb77-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2010</span>, year <span class="sc">&lt;=</span> <span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-343"><a href="#cb77-343" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME, CBSA) <span class="sc">|&gt;</span></span>
<span id="cb77-344"><a href="#cb77-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_units =</span> <span class="fu">sum</span>(new_housing_units_permitted), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-345"><a href="#cb77-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_units))</span>
<span id="cb77-346"><a href="#cb77-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-347"><a href="#cb77-347" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb77-348"><a href="#cb77-348" aria-hidden="true" tabindex="-1"></a>  result <span class="sc">|&gt;</span></span>
<span id="cb77-349"><a href="#cb77-349" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Location =</span> NAME,</span>
<span id="cb77-350"><a href="#cb77-350" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">New permits</span><span class="st">`</span> <span class="ot">=</span> total_units) <span class="sc">|&gt;</span></span>
<span id="cb77-351"><a href="#cb77-351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Location, CBSA, <span class="st">`</span><span class="at">New permits</span><span class="st">`</span>),</span>
<span id="cb77-352"><a href="#cb77-352" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb77-353"><a href="#cb77-353" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">autoWidth =</span> <span class="cn">TRUE</span>, <span class="at">dom =</span> <span class="st">"tpi"</span>)</span>
<span id="cb77-354"><a href="#cb77-354" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-355"><a href="#cb77-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-356"><a href="#cb77-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-357"><a href="#cb77-357" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb77-358"><a href="#cb77-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-359"><a href="#cb77-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-362"><a href="#cb77-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-363"><a href="#cb77-363" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-364"><a href="#cb77-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-365"><a href="#cb77-365" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="sc">|&gt;</span></span>
<span id="cb77-366"><a href="#cb77-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="st">"10740"</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-367"><a href="#cb77-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA,year) <span class="sc">|&gt;</span></span>
<span id="cb77-368"><a href="#cb77-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb77-369"><a href="#cb77-369" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb77-370"><a href="#cb77-370" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb77-371"><a href="#cb77-371" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-372"><a href="#cb77-372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(new_units))</span>
<span id="cb77-373"><a href="#cb77-373" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb77-374"><a href="#cb77-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-375"><a href="#cb77-375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-376"><a href="#cb77-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-377"><a href="#cb77-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-380"><a href="#cb77-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-381"><a href="#cb77-381" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-382"><a href="#cb77-382" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb77-383"><a href="#cb77-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-384"><a href="#cb77-384" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Build 2015 CBSA-level totals</span></span>
<span id="cb77-385"><a href="#cb77-385" aria-hidden="true" tabindex="-1"></a>cbsa_2015 <span class="ot">&lt;-</span></span>
<span id="cb77-386"><a href="#cb77-386" aria-hidden="true" tabindex="-1"></a>  INCOME <span class="sc">|&gt;</span></span>
<span id="cb77-387"><a href="#cb77-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-388"><a href="#cb77-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb77-389"><a href="#cb77-389" aria-hidden="true" tabindex="-1"></a>    HOUSEHOLDS <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, NAME, year, households),</span>
<span id="cb77-390"><a href="#cb77-390" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)</span>
<span id="cb77-391"><a href="#cb77-391" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-392"><a href="#cb77-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb77-393"><a href="#cb77-393" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, NAME, year, population),</span>
<span id="cb77-394"><a href="#cb77-394" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)</span>
<span id="cb77-395"><a href="#cb77-395" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-396"><a href="#cb77-396" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">str_extract</span>(NAME, <span class="st">", (.{2})"</span>, <span class="at">group=</span><span class="dv">1</span>))<span class="sc">|&gt;</span>     </span>
<span id="cb77-397"><a href="#cb77-397" aria-hidden="true" tabindex="-1"></a><span class="co"># two-letter state from "Metro, ST"</span></span>
<span id="cb77-398"><a href="#cb77-398" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">total_income_cbsa =</span> household_income <span class="sc">*</span> households</span>
<span id="cb77-399"><a href="#cb77-399" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb77-400"><a href="#cb77-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-401"><a href="#cb77-401" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Collapse to state and compute average individual income</span></span>
<span id="cb77-402"><a href="#cb77-402" aria-hidden="true" tabindex="-1"></a>top_state_2015 <span class="ot">&lt;-</span></span>
<span id="cb77-403"><a href="#cb77-403" aria-hidden="true" tabindex="-1"></a>  cbsa_2015 <span class="sc">|&gt;</span></span>
<span id="cb77-404"><a href="#cb77-404" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb77-405"><a href="#cb77-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb77-406"><a href="#cb77-406" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_income =</span> <span class="fu">sum</span>(total_income_cbsa, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb77-407"><a href="#cb77-407" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop    =</span> <span class="fu">sum</span>(population,       <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb77-408"><a href="#cb77-408" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_individual_income =</span> total_income <span class="sc">/</span> total_pop,</span>
<span id="cb77-409"><a href="#cb77-409" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb77-410"><a href="#cb77-410" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-411"><a href="#cb77-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_individual_income))</span>
<span id="cb77-412"><a href="#cb77-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-413"><a href="#cb77-413" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Top state (answer row)</span></span>
<span id="cb77-414"><a href="#cb77-414" aria-hidden="true" tabindex="-1"></a>top_state_2015</span>
<span id="cb77-415"><a href="#cb77-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-416"><a href="#cb77-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-419"><a href="#cb77-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-420"><a href="#cb77-420" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-421"><a href="#cb77-421" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb77-422"><a href="#cb77-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-423"><a href="#cb77-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-424"><a href="#cb77-424" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">"C1234"</span></span>
<span id="cb77-425"><a href="#cb77-425" aria-hidden="true" tabindex="-1"></a><span class="fu">as.double</span>(<span class="fu">paste0</span>(<span class="fu">str_remove</span>(x, <span class="st">"^C"</span>), <span class="st">"0"</span>))<span class="co"># -&gt; 12340</span></span>
<span id="cb77-426"><a href="#cb77-426" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) BLS (QCEW) filtered to NAICS 5182 and with CBSA code fixed: "C1234" -&gt; 12340</span></span>
<span id="cb77-427"><a href="#cb77-427" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-428"><a href="#cb77-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-429"><a href="#cb77-429" aria-hidden="true" tabindex="-1"></a><span class="do">## 1) Fix codes</span></span>
<span id="cb77-430"><a href="#cb77-430" aria-hidden="true" tabindex="-1"></a>bls_5182 <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb77-431"><a href="#cb77-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">5182</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-432"><a href="#cb77-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cbsa_num =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>, <span class="st">""</span>, FIPS), <span class="st">"0"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb77-433"><a href="#cb77-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cbsa_num, YEAR, EMPLOYMENT)</span>
<span id="cb77-434"><a href="#cb77-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-435"><a href="#cb77-435" aria-hidden="true" tabindex="-1"></a>cbsa_lookup <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb77-436"><a href="#cb77-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME) <span class="sc">|&gt;</span></span>
<span id="cb77-437"><a href="#cb77-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb77-438"><a href="#cb77-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA_num =</span> <span class="fu">as.integer</span>(GEOID)) <span class="sc">|&gt;</span></span>
<span id="cb77-439"><a href="#cb77-439" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CBSA_num, NAME)</span>
<span id="cb77-440"><a href="#cb77-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-441"><a href="#cb77-441" aria-hidden="true" tabindex="-1"></a><span class="do">## 2) Join (use by=..., not join_by)</span></span>
<span id="cb77-442"><a href="#cb77-442" aria-hidden="true" tabindex="-1"></a>ds_named <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(bls_5182, cbsa_lookup, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cbsa_num"</span> <span class="ot">=</span> <span class="st">"CBSA_num"</span>))</span>
<span id="cb77-443"><a href="#cb77-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-444"><a href="#cb77-444" aria-hidden="true" tabindex="-1"></a><span class="do">## 3) Leader per year</span></span>
<span id="cb77-445"><a href="#cb77-445" aria-hidden="true" tabindex="-1"></a>leaders <span class="ot">&lt;-</span> ds_named <span class="sc">|&gt;</span></span>
<span id="cb77-446"><a href="#cb77-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb77-447"><a href="#cb77-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(EMPLOYMENT, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-448"><a href="#cb77-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb77-449"><a href="#cb77-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-450"><a href="#cb77-450" aria-hidden="true" tabindex="-1"></a><span class="do">## 4) Last year NYC (35620) led</span></span>
<span id="cb77-451"><a href="#cb77-451" aria-hidden="true" tabindex="-1"></a>last_year_nyc <span class="ot">&lt;-</span></span>
<span id="cb77-452"><a href="#cb77-452" aria-hidden="true" tabindex="-1"></a>  leaders <span class="sc">|&gt;</span></span>
<span id="cb77-453"><a href="#cb77-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cbsa_num <span class="sc">==</span> <span class="dv">35620</span>L) <span class="sc">|&gt;</span></span>
<span id="cb77-454"><a href="#cb77-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(YEAR, NAME, EMPLOYMENT) <span class="sc">|&gt;</span> </span>
<span id="cb77-455"><a href="#cb77-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(YEAR)) <span class="sc">|&gt;</span> </span>
<span id="cb77-456"><a href="#cb77-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb77-457"><a href="#cb77-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-458"><a href="#cb77-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-459"><a href="#cb77-459" aria-hidden="true" tabindex="-1"></a>leaders</span>
<span id="cb77-460"><a href="#cb77-460" aria-hidden="true" tabindex="-1"></a>last_year_nyc</span>
<span id="cb77-461"><a href="#cb77-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-462"><a href="#cb77-462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-463"><a href="#cb77-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-466"><a href="#cb77-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-467"><a href="#cb77-467" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-468"><a href="#cb77-468" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb77-469"><a href="#cb77-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-470"><a href="#cb77-470" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Convert BLS CBSA code ("C1234") → Census style ("12340")</span></span>
<span id="cb77-471"><a href="#cb77-471" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-472"><a href="#cb77-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-473"><a href="#cb77-473" aria-hidden="true" tabindex="-1"></a><span class="co"># BLS CBSA code: "C1234" -&gt; 12340</span></span>
<span id="cb77-474"><a href="#cb77-474" aria-hidden="true" tabindex="-1"></a>wages_clean <span class="ot">&lt;-</span></span>
<span id="cb77-475"><a href="#cb77-475" aria-hidden="true" tabindex="-1"></a>  WAGES <span class="sc">|&gt;</span></span>
<span id="cb77-476"><a href="#cb77-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cbsa =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>,<span class="st">""</span>, FIPS), <span class="st">"0"</span>)))</span>
<span id="cb77-477"><a href="#cb77-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-478"><a href="#cb77-478" aria-hidden="true" tabindex="-1"></a>nyc_wages <span class="ot">&lt;-</span></span>
<span id="cb77-479"><a href="#cb77-479" aria-hidden="true" tabindex="-1"></a>  wages_clean <span class="sc">|&gt;</span></span>
<span id="cb77-480"><a href="#cb77-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cbsa <span class="sc">==</span> <span class="dv">35620</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-481"><a href="#cb77-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb77-482"><a href="#cb77-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb77-483"><a href="#cb77-483" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_wages_all =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb77-484"><a href="#cb77-484" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_wages_fin =</span> <span class="fu">sum</span>(TOTAL_WAGES[INDUSTRY <span class="sc">==</span> <span class="dv">52</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb77-485"><a href="#cb77-485" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb77-486"><a href="#cb77-486" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-487"><a href="#cb77-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">finance_fraction =</span> total_wages_fin <span class="sc">/</span> total_wages_all) <span class="sc">|&gt;</span></span>
<span id="cb77-488"><a href="#cb77-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(finance_fraction))</span>
<span id="cb77-489"><a href="#cb77-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-490"><a href="#cb77-490" aria-hidden="true" tabindex="-1"></a><span class="co"># answer rows</span></span>
<span id="cb77-491"><a href="#cb77-491" aria-hidden="true" tabindex="-1"></a>nyc_wages        <span class="co"># yearly fractions</span></span>
<span id="cb77-492"><a href="#cb77-492" aria-hidden="true" tabindex="-1"></a>nyc_wages <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>)   <span class="co"># peak year</span></span>
<span id="cb77-493"><a href="#cb77-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-494"><a href="#cb77-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-495"><a href="#cb77-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-496"><a href="#cb77-496" aria-hidden="true" tabindex="-1"></a>##Task 2</span>
<span id="cb77-499"><a href="#cb77-499" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-500"><a href="#cb77-500" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-501"><a href="#cb77-501" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb77-502"><a href="#cb77-502" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb77-503"><a href="#cb77-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-504"><a href="#cb77-504" aria-hidden="true" tabindex="-1"></a><span class="co"># CBSA-level data for 2009</span></span>
<span id="cb77-505"><a href="#cb77-505" aria-hidden="true" tabindex="-1"></a>cbsa_2009 <span class="ot">&lt;-</span></span>
<span id="cb77-506"><a href="#cb77-506" aria-hidden="true" tabindex="-1"></a>  RENT <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-507"><a href="#cb77-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, monthly_rent) <span class="sc">|&gt;</span></span>
<span id="cb77-508"><a href="#cb77-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb77-509"><a href="#cb77-509" aria-hidden="true" tabindex="-1"></a>    INCOME <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, NAME, year, household_income),</span>
<span id="cb77-510"><a href="#cb77-510" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)</span>
<span id="cb77-511"><a href="#cb77-511" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb77-512"><a href="#cb77-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-513"><a href="#cb77-513" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter + OLS fit</span></span>
<span id="cb77-514"><a href="#cb77-514" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cbsa_2009, <span class="fu">aes</span>(<span class="at">x =</span> household_income, <span class="at">y =</span> monthly_rent)) <span class="sc">+</span></span>
<span id="cb77-515"><a href="#cb77-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb77-516"><a href="#cb77-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb77-517"><a href="#cb77-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb77-518"><a href="#cb77-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb77-519"><a href="#cb77-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb77-520"><a href="#cb77-520" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Rent vs Household Income by CBSA (2009)"</span>,</span>
<span id="cb77-521"><a href="#cb77-521" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Average household income"</span>,</span>
<span id="cb77-522"><a href="#cb77-522" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average monthly rent"</span></span>
<span id="cb77-523"><a href="#cb77-523" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb77-524"><a href="#cb77-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb77-525"><a href="#cb77-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-526"><a href="#cb77-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-529"><a href="#cb77-529" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-530"><a href="#cb77-530" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-531"><a href="#cb77-531" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb77-532"><a href="#cb77-532" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb77-533"><a href="#cb77-533" aria-hidden="true" tabindex="-1"></a>total_emp <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb77-534"><a href="#cb77-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">cbsa =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>,<span class="st">""</span>, FIPS), <span class="st">"0"</span>)), YEAR) <span class="sc">|&gt;</span></span>
<span id="cb77-535"><a href="#cb77-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_emp =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb77-536"><a href="#cb77-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-537"><a href="#cb77-537" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) One row per CBSA–year: health care &amp; social assistance (NAICS 62)</span></span>
<span id="cb77-538"><a href="#cb77-538" aria-hidden="true" tabindex="-1"></a>health_emp <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb77-539"><a href="#cb77-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">62</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-540"><a href="#cb77-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">cbsa =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>,<span class="st">""</span>, FIPS), <span class="st">"0"</span>)), YEAR) <span class="sc">|&gt;</span></span>
<span id="cb77-541"><a href="#cb77-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">health_emp =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb77-542"><a href="#cb77-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-543"><a href="#cb77-543" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Join and plot (axes divided by 1,000,000)</span></span>
<span id="cb77-544"><a href="#cb77-544" aria-hidden="true" tabindex="-1"></a>emp_df <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(total_emp, health_emp, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cbsa"</span>,<span class="st">"YEAR"</span>))</span>
<span id="cb77-545"><a href="#cb77-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-546"><a href="#cb77-546" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emp_df, <span class="fu">aes</span>(<span class="at">x =</span> total_emp<span class="sc">/</span><span class="fl">1e6</span>, <span class="at">y =</span> health_emp<span class="sc">/</span><span class="fl">1e6</span>, <span class="at">colour =</span> <span class="fu">factor</span>(cbsa))) <span class="sc">+</span></span>
<span id="cb77-547"><a href="#cb77-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">1.6</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb77-548"><a href="#cb77-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">colour =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb77-549"><a href="#cb77-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> comma, <span class="at">name =</span> <span class="st">"Total employment (millions)"</span>) <span class="sc">+</span></span>
<span id="cb77-550"><a href="#cb77-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma, <span class="at">name =</span> <span class="st">"Health care employment (millions)"</span>) <span class="sc">+</span></span>
<span id="cb77-551"><a href="#cb77-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> YEAR, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb77-552"><a href="#cb77-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Health care (NAICS 62) vs total employment by CBSA"</span>) <span class="sc">+</span></span>
<span id="cb77-553"><a href="#cb77-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span>
<span id="cb77-554"><a href="#cb77-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-555"><a href="#cb77-555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-556"><a href="#cb77-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-559"><a href="#cb77-559" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-560"><a href="#cb77-560" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-561"><a href="#cb77-561" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb77-562"><a href="#cb77-562" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gghighlight)</span>
<span id="cb77-563"><a href="#cb77-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-564"><a href="#cb77-564" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare one row per CBSA-year with population and households</span></span>
<span id="cb77-565"><a href="#cb77-565" aria-hidden="true" tabindex="-1"></a>hh_pop <span class="ot">&lt;-</span> HOUSEHOLDS <span class="sc">|&gt;</span></span>
<span id="cb77-566"><a href="#cb77-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, households, year) <span class="sc">|&gt;</span></span>
<span id="cb77-567"><a href="#cb77-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb77-568"><a href="#cb77-568" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, population, year),</span>
<span id="cb77-569"><a href="#cb77-569" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)</span>
<span id="cb77-570"><a href="#cb77-570" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-571"><a href="#cb77-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-572"><a href="#cb77-572" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_household_size =</span> population <span class="sc">/</span> households,</span>
<span id="cb77-573"><a href="#cb77-573" aria-hidden="true" tabindex="-1"></a>    <span class="at">metro_area =</span> <span class="fu">case_when</span>(</span>
<span id="cb77-574"><a href="#cb77-574" aria-hidden="true" tabindex="-1"></a>      GEOID <span class="sc">==</span> <span class="dv">35620</span> <span class="sc">~</span> <span class="st">"NYC"</span>,                 <span class="co"># New York CBSA</span></span>
<span id="cb77-575"><a href="#cb77-575" aria-hidden="true" tabindex="-1"></a>      GEOID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">31080</span>, <span class="dv">31100</span>) <span class="sc">~</span> <span class="st">"LA"</span>,      <span class="co"># Los Angeles CBSA (codes vary by vintage)</span></span>
<span id="cb77-576"><a href="#cb77-576" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other CBSAs"</span></span>
<span id="cb77-577"><a href="#cb77-577" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb77-578"><a href="#cb77-578" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb77-579"><a href="#cb77-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-580"><a href="#cb77-580" aria-hidden="true" tabindex="-1"></a><span class="co"># Line plot over time, one line per CBSA, highlight NYC and LA</span></span>
<span id="cb77-581"><a href="#cb77-581" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hh_pop, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> avg_household_size, <span class="at">group =</span> GEOID)) <span class="sc">+</span></span>
<span id="cb77-582"><a href="#cb77-582" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> metro_area), <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb77-583"><a href="#cb77-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> metro_area), <span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb77-584"><a href="#cb77-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gghighlight</span>(</span>
<span id="cb77-585"><a href="#cb77-585" aria-hidden="true" tabindex="-1"></a>    metro_area <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"NYC"</span>, <span class="st">"LA"</span>),</span>
<span id="cb77-586"><a href="#cb77-586" aria-hidden="true" tabindex="-1"></a>    <span class="at">label_key =</span> metro_area,</span>
<span id="cb77-587"><a href="#cb77-587" aria-hidden="true" tabindex="-1"></a>    <span class="at">unhighlighted_params =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>)</span>
<span id="cb77-588"><a href="#cb77-588" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb77-589"><a href="#cb77-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"NYC"</span> <span class="ot">=</span> <span class="st">"#377eb8"</span>, <span class="st">"LA"</span> <span class="ot">=</span> <span class="st">"#e41a1c"</span>, <span class="st">"Other CBSAs"</span> <span class="ot">=</span> <span class="st">"gray80"</span>)) <span class="sc">+</span></span>
<span id="cb77-590"><a href="#cb77-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb77-591"><a href="#cb77-591" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Evolution of Household Size by CBSA"</span>,</span>
<span id="cb77-592"><a href="#cb77-592" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"NYC and LA highlighted"</span>,</span>
<span id="cb77-593"><a href="#cb77-593" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb77-594"><a href="#cb77-594" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average household size"</span></span>
<span id="cb77-595"><a href="#cb77-595" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb77-596"><a href="#cb77-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb77-597"><a href="#cb77-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb77-598"><a href="#cb77-598" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb77-599"><a href="#cb77-599" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb77-600"><a href="#cb77-600" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb77-601"><a href="#cb77-601" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb77-602"><a href="#cb77-602" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb77-603"><a href="#cb77-603" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb77-604"><a href="#cb77-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-605"><a href="#cb77-605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-606"><a href="#cb77-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-607"><a href="#cb77-607" aria-hidden="true" tabindex="-1"></a>##Task 4</span>
<span id="cb77-610"><a href="#cb77-610" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-611"><a href="#cb77-611" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries (assuming tidyverse and DT are installed)</span></span>
<span id="cb77-612"><a href="#cb77-612" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-613"><a href="#cb77-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-614"><a href="#cb77-614" aria-hidden="true" tabindex="-1"></a>RENT_BURDEN <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb77-615"><a href="#cb77-615" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(RENT, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>, <span class="st">"NAME"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb77-616"><a href="#cb77-616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-617"><a href="#cb77-617" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN =</span> (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income</span>
<span id="cb77-618"><a href="#cb77-618" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-619"><a href="#cb77-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(RENT_BURDEN))</span>
<span id="cb77-620"><a href="#cb77-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-621"><a href="#cb77-621" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">|&gt;</span></span>
<span id="cb77-622"><a href="#cb77-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">|&gt;</span></span>
<span id="cb77-623"><a href="#cb77-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-624"><a href="#cb77-624" aria-hidden="true" tabindex="-1"></a>    <span class="at">BASE_2009 =</span> RENT_BURDEN[year <span class="sc">==</span> <span class="dv">2009</span>][<span class="dv">1</span>],</span>
<span id="cb77-625"><a href="#cb77-625" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_IDX =</span> <span class="dv">100</span> <span class="sc">*</span> RENT_BURDEN <span class="sc">/</span> BASE_2009</span>
<span id="cb77-626"><a href="#cb77-626" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-627"><a href="#cb77-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb77-628"><a href="#cb77-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-629"><a href="#cb77-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-630"><a href="#cb77-630" aria-hidden="true" tabindex="-1"></a>  baseline <span class="sc">|&gt;</span></span>
<span id="cb77-631"><a href="#cb77-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_rent_burden =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb77-632"><a href="#cb77-632" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_index =</span> <span class="fu">mean</span>(RENT_BURDEN_IDX, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb77-633"><a href="#cb77-633" aria-hidden="true" tabindex="-1"></a>  scaled_minmax <span class="ot">&lt;-</span> baseline <span class="sc">|&gt;</span></span>
<span id="cb77-634"><a href="#cb77-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb77-635"><a href="#cb77-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-636"><a href="#cb77-636" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_val =</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb77-637"><a href="#cb77-637" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_val =</span> <span class="fu">max</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb77-638"><a href="#cb77-638" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_MINMAX =</span> <span class="dv">100</span> <span class="sc">*</span> (RENT_BURDEN <span class="sc">-</span> min_val) <span class="sc">/</span> (max_val <span class="sc">-</span> min_val)</span>
<span id="cb77-639"><a href="#cb77-639" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-640"><a href="#cb77-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb77-641"><a href="#cb77-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-642"><a href="#cb77-642" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-645"><a href="#cb77-645" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-646"><a href="#cb77-646" aria-hidden="true" tabindex="-1"></a>baseline <span class="sc">|&gt;</span></span>
<span id="cb77-647"><a href="#cb77-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb77-648"><a href="#cb77-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-649"><a href="#cb77-649" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_MINMAX =</span></span>
<span id="cb77-650"><a href="#cb77-650" aria-hidden="true" tabindex="-1"></a>      <span class="dv">100</span> <span class="sc">*</span> (RENT_BURDEN <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb77-651"><a href="#cb77-651" aria-hidden="true" tabindex="-1"></a>            (<span class="fu">max</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb77-652"><a href="#cb77-652" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-653"><a href="#cb77-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb77-654"><a href="#cb77-654" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="dv">12060</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-655"><a href="#cb77-655" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb77-656"><a href="#cb77-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RENT_BURDEN, RENT_BURDEN_IDX, RENT_BURDEN_MINMAX)</span>
<span id="cb77-657"><a href="#cb77-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-658"><a href="#cb77-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-659"><a href="#cb77-659" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-660"><a href="#cb77-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-663"><a href="#cb77-663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-664"><a href="#cb77-664" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-665"><a href="#cb77-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-666"><a href="#cb77-666" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute yearly scaling and summarize by metro</span></span>
<span id="cb77-667"><a href="#cb77-667" aria-hidden="true" tabindex="-1"></a>extremes <span class="ot">&lt;-</span> baseline <span class="sc">|&gt;</span></span>
<span id="cb77-668"><a href="#cb77-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb77-669"><a href="#cb77-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-670"><a href="#cb77-670" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_MINMAX =</span></span>
<span id="cb77-671"><a href="#cb77-671" aria-hidden="true" tabindex="-1"></a>      <span class="dv">100</span> <span class="sc">*</span> (RENT_BURDEN <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb77-672"><a href="#cb77-672" aria-hidden="true" tabindex="-1"></a>            (<span class="fu">max</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb77-673"><a href="#cb77-673" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-674"><a href="#cb77-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb77-675"><a href="#cb77-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME) <span class="sc">|&gt;</span></span>
<span id="cb77-676"><a href="#cb77-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb77-677"><a href="#cb77-677" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_rent_burden =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb77-678"><a href="#cb77-678" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_scaled      =</span> <span class="fu">mean</span>(RENT_BURDEN_MINMAX, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-679"><a href="#cb77-679" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-680"><a href="#cb77-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_scaled))</span>
<span id="cb77-681"><a href="#cb77-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-682"><a href="#cb77-682" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 5 metros with highest rent burden</span></span>
<span id="cb77-683"><a href="#cb77-683" aria-hidden="true" tabindex="-1"></a>top_5 <span class="ot">&lt;-</span> extremes <span class="sc">|&gt;</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb77-684"><a href="#cb77-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-685"><a href="#cb77-685" aria-hidden="true" tabindex="-1"></a><span class="co"># Bottom 5 metros with lowest rent burden</span></span>
<span id="cb77-686"><a href="#cb77-686" aria-hidden="true" tabindex="-1"></a>bottom_5 <span class="ot">&lt;-</span> extremes <span class="sc">|&gt;</span> <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb77-687"><a href="#cb77-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-688"><a href="#cb77-688" aria-hidden="true" tabindex="-1"></a>top_5</span>
<span id="cb77-689"><a href="#cb77-689" aria-hidden="true" tabindex="-1"></a>bottom_5</span>
<span id="cb77-690"><a href="#cb77-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-691"><a href="#cb77-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-692"><a href="#cb77-692" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-693"><a href="#cb77-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-696"><a href="#cb77-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-697"><a href="#cb77-697" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-698"><a href="#cb77-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-699"><a href="#cb77-699" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-700"><a href="#cb77-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-701"><a href="#cb77-701" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) 5-year population growth (needed for the rate-based metric)</span></span>
<span id="cb77-702"><a href="#cb77-702" aria-hidden="true" tabindex="-1"></a>pop_growth_5yr <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb77-703"><a href="#cb77-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(GEOID, year) <span class="sc">|&gt;</span></span>
<span id="cb77-704"><a href="#cb77-704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">|&gt;</span></span>
<span id="cb77-705"><a href="#cb77-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-706"><a href="#cb77-706" aria-hidden="true" tabindex="-1"></a>    <span class="at">POP_5YR_AGO    =</span> <span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb77-707"><a href="#cb77-707" aria-hidden="true" tabindex="-1"></a>    <span class="at">POP_GROWTH_5YR =</span> (population <span class="sc">-</span> POP_5YR_AGO) <span class="sc">/</span> POP_5YR_AGO</span>
<span id="cb77-708"><a href="#cb77-708" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-709"><a href="#cb77-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2014</span>) <span class="sc">|&gt;</span></span>
<span id="cb77-710"><a href="#cb77-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb77-711"><a href="#cb77-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-712"><a href="#cb77-712" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Instantaneous housing growth: (new units / population) * 1000</span></span>
<span id="cb77-713"><a href="#cb77-713" aria-hidden="true" tabindex="-1"></a>instant <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb77-714"><a href="#cb77-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(PERMITS, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span> <span class="ot">=</span> <span class="st">"CBSA"</span>, <span class="st">"year"</span> <span class="ot">=</span> <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb77-715"><a href="#cb77-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-716"><a href="#cb77-716" aria-hidden="true" tabindex="-1"></a>    <span class="at">INSTANT_PER_1K =</span> <span class="dv">1000</span> <span class="sc">*</span> new_housing_units_permitted <span class="sc">/</span> population</span>
<span id="cb77-717"><a href="#cb77-717" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if your column is named new_housing_units_permitted, use that instead</span></span>
<span id="cb77-718"><a href="#cb77-718" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-719"><a href="#cb77-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K)</span>
<span id="cb77-720"><a href="#cb77-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-721"><a href="#cb77-721" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Rate-based: permits per 1k divided by 5-year population growth</span></span>
<span id="cb77-722"><a href="#cb77-722" aria-hidden="true" tabindex="-1"></a>rate_based <span class="ot">&lt;-</span> pop_growth_5yr <span class="sc">|&gt;</span></span>
<span id="cb77-723"><a href="#cb77-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(PERMITS, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span> <span class="ot">=</span> <span class="st">"CBSA"</span>, <span class="st">"year"</span> <span class="ot">=</span> <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb77-724"><a href="#cb77-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-725"><a href="#cb77-725" aria-hidden="true" tabindex="-1"></a>    <span class="at">PERMITS_PER_1K  =</span> <span class="dv">1000</span> <span class="sc">*</span> new_housing_units_permitted <span class="sc">/</span> population,</span>
<span id="cb77-726"><a href="#cb77-726" aria-hidden="true" tabindex="-1"></a>    <span class="at">RATE_VS_POP_5YR =</span> PERMITS_PER_1K <span class="sc">/</span> POP_GROWTH_5YR</span>
<span id="cb77-727"><a href="#cb77-727" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb77-728"><a href="#cb77-728" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RATE_VS_POP_5YR)</span>
<span id="cb77-729"><a href="#cb77-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-730"><a href="#cb77-730" aria-hidden="true" tabindex="-1"></a><span class="co"># 4) Final table with both metrics (years &gt;= 2014)</span></span>
<span id="cb77-731"><a href="#cb77-731" aria-hidden="true" tabindex="-1"></a>housing_metrics <span class="ot">&lt;-</span> instant <span class="sc">|&gt;</span></span>
<span id="cb77-732"><a href="#cb77-732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(rate_based, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"NAME"</span>, <span class="st">"year"</span>))</span>
<span id="cb77-733"><a href="#cb77-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-734"><a href="#cb77-734" aria-hidden="true" tabindex="-1"></a>housing_metrics</span>
<span id="cb77-735"><a href="#cb77-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-736"><a href="#cb77-736" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-737"><a href="#cb77-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-738"><a href="#cb77-738" aria-hidden="true" tabindex="-1"></a><span class="co"># assuming you already built `housing_metrics`</span></span>
<span id="cb77-739"><a href="#cb77-739" aria-hidden="true" tabindex="-1"></a><span class="co"># with columns: GEOID, NAME, year, INSTANT_PER_1K, RATE_VS_POP_5YR</span></span>
<span id="cb77-740"><a href="#cb77-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-741"><a href="#cb77-741" aria-hidden="true" tabindex="-1"></a>housing_metrics_z <span class="ot">&lt;-</span> housing_metrics <span class="sc">|&gt;</span></span>
<span id="cb77-742"><a href="#cb77-742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb77-743"><a href="#cb77-743" aria-hidden="true" tabindex="-1"></a>    <span class="at">INSTANT_Z =</span> (INSTANT_PER_1K  <span class="sc">-</span> <span class="fu">mean</span>(INSTANT_PER_1K,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb77-744"><a href="#cb77-744" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sd</span>(INSTANT_PER_1K,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb77-745"><a href="#cb77-745" aria-hidden="true" tabindex="-1"></a>    <span class="at">RATE_Z    =</span> (RATE_VS_POP_5YR <span class="sc">-</span> <span class="fu">mean</span>(RATE_VS_POP_5YR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb77-746"><a href="#cb77-746" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sd</span>(RATE_VS_POP_5YR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb77-747"><a href="#cb77-747" aria-hidden="true" tabindex="-1"></a>    <span class="at">COMPOSITE_Z =</span> <span class="fl">0.5</span> <span class="sc">*</span> INSTANT_Z <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> RATE_Z</span>
<span id="cb77-748"><a href="#cb77-748" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb77-749"><a href="#cb77-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-750"><a href="#cb77-750" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 and bottom 10 by instantaneous z (any year)</span></span>
<span id="cb77-751"><a href="#cb77-751" aria-hidden="true" tabindex="-1"></a>top10_instant <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb77-752"><a href="#cb77-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(INSTANT_Z)) <span class="sc">|&gt;</span></span>
<span id="cb77-753"><a href="#cb77-753" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, INSTANT_Z) <span class="sc">|&gt;</span></span>
<span id="cb77-754"><a href="#cb77-754" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb77-755"><a href="#cb77-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-756"><a href="#cb77-756" aria-hidden="true" tabindex="-1"></a>bottom10_instant <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb77-757"><a href="#cb77-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(INSTANT_Z) <span class="sc">|&gt;</span></span>
<span id="cb77-758"><a href="#cb77-758" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, INSTANT_Z) <span class="sc">|&gt;</span></span>
<span id="cb77-759"><a href="#cb77-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb77-760"><a href="#cb77-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-761"><a href="#cb77-761" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 and bottom 10 by rate-based z (any year)</span></span>
<span id="cb77-762"><a href="#cb77-762" aria-hidden="true" tabindex="-1"></a>top10_rate <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb77-763"><a href="#cb77-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(RATE_Z)) <span class="sc">|&gt;</span></span>
<span id="cb77-764"><a href="#cb77-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RATE_VS_POP_5YR, RATE_Z) <span class="sc">|&gt;</span></span>
<span id="cb77-765"><a href="#cb77-765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb77-766"><a href="#cb77-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-767"><a href="#cb77-767" aria-hidden="true" tabindex="-1"></a>bottom10_rate <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb77-768"><a href="#cb77-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(RATE_Z) <span class="sc">|&gt;</span></span>
<span id="cb77-769"><a href="#cb77-769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RATE_VS_POP_5YR, RATE_Z) <span class="sc">|&gt;</span></span>
<span id="cb77-770"><a href="#cb77-770" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb77-771"><a href="#cb77-771" aria-hidden="true" tabindex="-1"></a>top10_instant</span>
<span id="cb77-772"><a href="#cb77-772" aria-hidden="true" tabindex="-1"></a>bottom10_instant</span>
<span id="cb77-773"><a href="#cb77-773" aria-hidden="true" tabindex="-1"></a>top10_rate</span>
<span id="cb77-774"><a href="#cb77-774" aria-hidden="true" tabindex="-1"></a>bottom10_rate</span>
<span id="cb77-775"><a href="#cb77-775" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-776"><a href="#cb77-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-779"><a href="#cb77-779" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-780"><a href="#cb77-780" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: top/bottom by composite (any year)</span></span>
<span id="cb77-781"><a href="#cb77-781" aria-hidden="true" tabindex="-1"></a>top10_composite <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb77-782"><a href="#cb77-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(COMPOSITE_Z)) <span class="sc">|&gt;</span></span>
<span id="cb77-783"><a href="#cb77-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, RATE_VS_POP_5YR, COMPOSITE_Z) <span class="sc">|&gt;</span></span>
<span id="cb77-784"><a href="#cb77-784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb77-785"><a href="#cb77-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-786"><a href="#cb77-786" aria-hidden="true" tabindex="-1"></a>bottom10_composite <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb77-787"><a href="#cb77-787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(COMPOSITE_Z) <span class="sc">|&gt;</span></span>
<span id="cb77-788"><a href="#cb77-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, RATE_VS_POP_5YR, COMPOSITE_Z) <span class="sc">|&gt;</span></span>
<span id="cb77-789"><a href="#cb77-789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb77-790"><a href="#cb77-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-791"><a href="#cb77-791" aria-hidden="true" tabindex="-1"></a>top10_composite</span>
<span id="cb77-792"><a href="#cb77-792" aria-hidden="true" tabindex="-1"></a>bottom10_composite</span>
<span id="cb77-793"><a href="#cb77-793" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb77-794"><a href="#cb77-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-795"><a href="#cb77-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-796"><a href="#cb77-796" aria-hidden="true" tabindex="-1"></a>##Task 6</span>
<span id="cb77-797"><a href="#cb77-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-800"><a href="#cb77-800" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb77-801"><a href="#cb77-801" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(WAGES)</span>
<span id="cb77-802"><a href="#cb77-802" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(INDUSTRY_CODES)</span>
<span id="cb77-803"><a href="#cb77-803" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(PERMITS)</span>
<span id="cb77-804"><a href="#cb77-804" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(INCOME)</span>
<span id="cb77-805"><a href="#cb77-805" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(RENT)</span>
<span id="cb77-806"><a href="#cb77-806" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(POPULATION)</span>
<span id="cb77-807"><a href="#cb77-807" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(HOUSEHOLDS)</span>
<span id="cb77-808"><a href="#cb77-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-809"><a href="#cb77-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-810"><a href="#cb77-810" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>