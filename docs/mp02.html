<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mini Project 2 – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-1fe81d0376b2c50856e68e651e390326.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-5657dfa6c17a855b02079790714f0f49.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="site_libs/datatables-binding-0.34.0/datatables.js"></script>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="site_libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>



</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Homepage</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./mp01.html"> 
<span class="menu-text">Mini Project 01</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./mp02.html" aria-current="page"> 
<span class="menu-text">Mini Project 02</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data-acquisition" id="toc-data-acquisition" class="nav-link" data-scroll-target="#data-acquisition">Data Acquisition</a></li>
  <li><a href="#entity-relationship-diagram" id="toc-entity-relationship-diagram" class="nav-link" data-scroll-target="#entity-relationship-diagram">Entity Relationship Diagram</a></li>
  <li><a href="#task-1" id="toc-task-1" class="nav-link" data-scroll-target="#task-1">Task 1</a>
  <ul class="collapse">
  <li><a href="#which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive" id="toc-which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive" class="nav-link" data-scroll-target="#which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive">Which CBSA (by name) permitted the largest number of new housing units in the decade from 2010 to 2019 (inclusive)?</a></li>
  <li><a href="#in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units" id="toc-in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units" class="nav-link" data-scroll-target="#in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units">In what year did Albuquerque, NM (CBSA Number 10740) permit the most new housing units?</a></li>
  <li><a href="#which-state-not-cbsa-had-the-highest-average-individual-income-in-2015" id="toc-which-state-not-cbsa-had-the-highest-average-individual-income-in-2015" class="nav-link" data-scroll-target="#which-state-not-cbsa-had-the-highest-average-individual-income-in-2015">Which state (not CBSA) had the highest average individual income in 2015?</a></li>
  <li><a href="#data-scientists-and-business-analysts-are-recorded-under-naics-code-5182.-what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country-in-recent-years-the-san-francisco-cbsa-has-had-the-most-data-scientists." id="toc-data-scientists-and-business-analysts-are-recorded-under-naics-code-5182.-what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country-in-recent-years-the-san-francisco-cbsa-has-had-the-most-data-scientists." class="nav-link" data-scroll-target="#data-scientists-and-business-analysts-are-recorded-under-naics-code-5182.-what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country-in-recent-years-the-san-francisco-cbsa-has-had-the-most-data-scientists.">Data scientists and business analysts are recorded under NAICS code 5182. What is the last year in which the NYC CBSA had the most data scientists in the country? In recent years, the San Francisco CBSA has had the most data scientists.</a></li>
  <li><a href="#what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak" id="toc-what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak" class="nav-link" data-scroll-target="#what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak">What fraction of total wages in the NYC CBSA was earned by people employed in the finance and insurance industries (NAICS code 52)? In what year did this fraction peak?</a></li>
  </ul></li>
  <li><a href="#task-3" id="toc-task-3" class="nav-link" data-scroll-target="#task-3">Task 3</a>
  <ul class="collapse">
  <li><a href="#the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009." id="toc-the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009." class="nav-link" data-scroll-target="#the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009.">The relationship between monthly rent and average household income per CBSA in 2009.</a></li>
  <li><a href="#the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas.-design-your-visualization-so-that-it-is-possible-to-see-the-evolution-of-this-relationship-over-time." id="toc-the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas.-design-your-visualization-so-that-it-is-possible-to-see-the-evolution-of-this-relationship-over-time." class="nav-link" data-scroll-target="#the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas.-design-your-visualization-so-that-it-is-possible-to-see-the-evolution-of-this-relationship-over-time.">The relationship between total employment and total employment in the health care and social services sector (NAICS 62) across different CBSAs. Design your visualization so that it is possible to see the evolution of this relationship over time.</a></li>
  <li><a href="#the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas." id="toc-the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas." class="nav-link" data-scroll-target="#the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas.">The evolution of average household size over time. Use different lines to represent different CBSAs.</a></li>
  </ul></li>
  <li><a href="#task-5-housing-growth" id="toc-task-5-housing-growth" class="nav-link" data-scroll-target="#task-5-housing-growth">Task 5 Housing Growth</a>
  <ul class="collapse">
  <li><a href="#finding-our-baseline-for-rent-burden" id="toc-finding-our-baseline-for-rent-burden" class="nav-link" data-scroll-target="#finding-our-baseline-for-rent-burden">Finding our Baseline for Rent Burden</a></li>
  <li><a href="#rent-burden-in-atlanta" id="toc-rent-burden-in-atlanta" class="nav-link" data-scroll-target="#rent-burden-in-atlanta">Rent Burden in Atlanta</a></li>
  <li><a href="#top-5-and-bottom-5" id="toc-top-5-and-bottom-5" class="nav-link" data-scroll-target="#top-5-and-bottom-5">Top 5 and Bottom 5</a></li>
  <li><a href="#top-5" id="toc-top-5" class="nav-link" data-scroll-target="#top-5">Top 5</a></li>
  <li><a href="#bottom-5" id="toc-bottom-5" class="nav-link" data-scroll-target="#bottom-5">Bottom 5</a></li>
  <li><a href="#population-and-housing-growth" id="toc-population-and-housing-growth" class="nav-link" data-scroll-target="#population-and-housing-growth">Population and Housing Growth</a></li>
  </ul></li>
  <li><a href="#top-10-instantaneous-housing-growth" id="toc-top-10-instantaneous-housing-growth" class="nav-link" data-scroll-target="#top-10-instantaneous-housing-growth">Top 10 Instantaneous Housing Growth</a>
  <ul class="collapse">
  <li><a href="#bottom-10-instantaneous-housing-growth" id="toc-bottom-10-instantaneous-housing-growth" class="nav-link" data-scroll-target="#bottom-10-instantaneous-housing-growth">Bottom 10 Instantaneous Housing Growth</a></li>
  <li><a href="#top-10-housing-growth-rate" id="toc-top-10-housing-growth-rate" class="nav-link" data-scroll-target="#top-10-housing-growth-rate">Top 10 Housing Growth Rate</a></li>
  <li><a href="#bottom-10-housing-growth-rate" id="toc-bottom-10-housing-growth-rate" class="nav-link" data-scroll-target="#bottom-10-housing-growth-rate">Bottom 10 Housing Growth Rate</a></li>
  <li><a href="#top-and-bottom-composite-z-score" id="toc-top-and-bottom-composite-z-score" class="nav-link" data-scroll-target="#top-and-bottom-composite-z-score">Top and Bottom Composite Z-score</a></li>
  <li><a href="#top-10-by-composite-z-score" id="toc-top-10-by-composite-z-score" class="nav-link" data-scroll-target="#top-10-by-composite-z-score">Top 10 by Composite Z Score</a></li>
  <li><a href="#bottom-10-by-composite-z-score" id="toc-bottom-10-by-composite-z-score" class="nav-link" data-scroll-target="#bottom-10-by-composite-z-score">Bottom 10 by Composite z-score</a></li>
  </ul></li>
  <li><a href="#task-6-visualization-of-yimbys" id="toc-task-6-visualization-of-yimbys" class="nav-link" data-scroll-target="#task-6-visualization-of-yimbys">Task 6 Visualization of Yimbys</a>
  <ul class="collapse">
  <li><a href="#defining-a-yimby" id="toc-defining-a-yimby" class="nav-link" data-scroll-target="#defining-a-yimby">Defining a YIMBY</a></li>
  <li><a href="#bubble-plot-of-possible-yimbys" id="toc-bubble-plot-of-possible-yimbys" class="nav-link" data-scroll-target="#bubble-plot-of-possible-yimbys">Bubble plot of possible YIMBYS</a></li>
  <li><a href="#time-plot-for-possible-yimbys" id="toc-time-plot-for-possible-yimbys" class="nav-link" data-scroll-target="#time-plot-for-possible-yimbys">Time Plot for possible YIMBYs</a></li>
  </ul></li>
  <li><a href="#task-7-policy-brief" id="toc-task-7-policy-brief" class="nav-link" data-scroll-target="#task-7-policy-brief">Task 7 Policy Brief</a>
  <ul class="collapse">
  <li><a href="#introduction-1" id="toc-introduction-1" class="nav-link" data-scroll-target="#introduction-1"><strong>Introduction</strong></a></li>
  <li><a href="#sponsors" id="toc-sponsors" class="nav-link" data-scroll-target="#sponsors"><strong>Sponsors</strong></a></li>
  <li><a href="#potential-benefits-from-our-policy" id="toc-potential-benefits-from-our-policy" class="nav-link" data-scroll-target="#potential-benefits-from-our-policy"><strong>Potential Benefits from our Policy</strong></a></li>
  <li><a href="#metrics" id="toc-metrics" class="nav-link" data-scroll-target="#metrics"><strong>Metrics</strong></a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><strong>Conclusion</strong></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Mini Project 2</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<p><img src="housing.png" class="img-fluid">{width = 30%}</p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>We are examining the relationship between housing growth and rent burden. Throughout this analysis we will look at the effect of income on rent cost, income by state and industry, the effects of COVID 19 on employment in the healthcare industry, and population growth. In this analysis we will conduct a search for YIMBYs, or Yes In My Backyard cities. These cities allow for housing growth, account for population growth, and have lowered rent cost over our study period.</p>
</section>
<section id="data-acquisition" class="level1">
<h1>Data Acquisition</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>))){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>library <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Mask base::library() to automatically install packages if needed</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Masking is important here so downlit picks up packages and links</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## to documentation</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>get_acs_all_years <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">geography=</span><span class="st">"cbsa"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{variable}_{geography}_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop 2020 - No survey (covid)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(geography, variable, <span class="at">year=</span>yy, <span class="at">survey=</span><span class="st">"acs1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year=</span>yy) <span class="sc">|&gt;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span>moe, <span class="sc">-</span>variable) <span class="sc">|&gt;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="sc">!!</span><span class="at">variable :=</span> estimate)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income (12 month)</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B19013_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">household_income =</span> B19013_001)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly rent</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B25064_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">monthly_rent =</span> B25064_001)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Total population</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01003_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">population =</span> B01003_001)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of households</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B11001_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">households =</span> B11001_001)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>      CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>      CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>      PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">year =</span> yy)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>      current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>      fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(...){</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>                   <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>      reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>      CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>      CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>      PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>      PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">year =</span> yy)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>      current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>      fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(...){</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>                   <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>      reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rvest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:readr':

    guess_encoding</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>get_bls_industry_codes <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="st">"bls_industry_codes.csv"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"classifications"</span>, <span class="st">"industry"</span>, <span class="st">"industry-titles.htm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_error</span>(<span class="at">is_error =</span> \(resp) <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_perform</span>()</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_check_status</span>(resp)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    naics_table <span class="ot">&lt;-</span> <span class="fu">resp_body_html</span>(resp) <span class="sc">|&gt;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_element</span>(<span class="st">"#naics_titles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(<span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>, Code), <span class="st">"NAICS"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">depth =</span> <span class="fu">if_else</span>(<span class="fu">nchar</span>(Code) <span class="sc">&lt;=</span> <span class="dv">5</span>, <span class="fu">nchar</span>(Code) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(depth))</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    naics_table <span class="ot">&lt;-</span> naics_table <span class="sc">|&gt;</span> </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level4_title=</span>title) <span class="sc">|&gt;</span> </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">level1_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">2</span>), </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">level2_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">3</span>), </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">level3_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level1_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level1_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level2_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level2_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level3_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level3_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"depth"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level4_code =</span> Code) <span class="sc">|&gt;</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(level1_title, level2_title, level3_title, level4_title, </span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>             level1_code,  level2_code,  level3_code,  level4_code)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(naics_table, fname)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>INDUSTRY_CODES <span class="ot">&lt;-</span> <span class="fu">get_bls_industry_codes</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>get_bls_qcew_annual_averages <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"bls_qcew_{start_year}_{end_year}.csv.gz"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop Covid year </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="at">.progress=</span><span class="cn">TRUE</span>, <span class="fu">possibly</span>(<span class="cf">function</span>(yy){</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>      fname_inner <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="fu">glue</span>(<span class="st">"{yy}_qcew_annual_singlefile.zip"</span>))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname_inner)){</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"data"</span>, <span class="st">"files"</span>, yy, <span class="st">"csv"</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">glue</span>(<span class="st">"{yy}_annual_singlefile.zip"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_retry</span>(<span class="at">max_tries=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_perform</span>(fname_inner)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">file.info</span>(fname_inner)<span class="sc">$</span>size <span class="sc">&lt;</span> <span class="fl">755e5</span>){</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sQuote</span>(fname_inner), <span class="st">"appears corrupted. Please delete and retry this step."</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_csv</span>(fname_inner, </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">show_col_types=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">YEAR =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(area_fips, </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>               industry_code, </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>               annual_avg_emplvl, </span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>               total_annual_wages, </span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>               YEAR) <span class="sc">|&gt;</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="fu">nchar</span>(industry_code) <span class="sc">&lt;=</span> <span class="dv">5</span>, </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>               <span class="fu">str_starts</span>(area_fips, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="fu">str_detect</span>(industry_code, <span class="st">"-"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">FIPS =</span> area_fips, </span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">INDUSTRY =</span> <span class="fu">as.integer</span>(industry_code), </span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>               <span class="at">EMPLOYMENT =</span> <span class="fu">as.integer</span>(annual_avg_emplvl), </span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>               <span class="at">TOTAL_WAGES =</span> total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span>area_fips, </span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>industry_code, </span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>annual_avg_emplvl, </span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(INDUSTRY <span class="sc">!=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">AVG_WAGE =</span> TOTAL_WAGES <span class="sc">/</span> EMPLOYMENT)</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    })) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>  ALL_DATA <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  ALL_DATA_YEARS <span class="ot">&lt;-</span> <span class="fu">unique</span>(ALL_DATA<span class="sc">$</span>YEAR)</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>  YEARS_DIFF <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(YEARS, ALL_DATA_YEARS)</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(YEARS_DIFF) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Download failed for the following years: "</span>, YEARS_DIFF, </span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>         <span class="st">". Please delete intermediate files and try again."</span>)</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>  ALL_DATA</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> <span class="fu">get_bls_qcew_annual_averages</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="entity-relationship-diagram" class="level1">
<h1>Entity Relationship Diagram</h1>
<p><img src="ERD.png" class="img-fluid"></p>
</section>
<section id="task-1" class="level1">
<h1>Task 1</h1>
<section id="which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive" class="level2">
<h2 class="anchored" data-anchor-id="which-cbsa-by-name-permitted-the-largest-number-of-new-housing-units-in-the-decade-from-2010-to-2019-inclusive">Which CBSA (by name) permitted the largest number of new housing units in the decade from 2010 to 2019 (inclusive)?</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#finding CSBA name in income data</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT) </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>CBSA_NAME_CANONICAL <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">|&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">NAME =</span> <span class="fu">first</span>(NAME), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(GEOID))</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)) <span class="sc">|&gt;</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(CBSA_NAME_CANONICAL <span class="sc">|&gt;</span> <span class="fu">select</span>(CBSA, NAME), <span class="at">by =</span> <span class="st">"CBSA"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2010</span>, year <span class="sc">&lt;=</span> <span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME, CBSA) <span class="sc">|&gt;</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_units =</span> <span class="fu">sum</span>(new_housing_units_permitted), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_units))</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  result <span class="sc">|&gt;</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Location =</span> NAME,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">New permits</span><span class="st">`</span> <span class="ot">=</span> total_units) <span class="sc">|&gt;</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Location, CBSA, <span class="st">`</span><span class="at">New permits</span><span class="st">`</span>),</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Largest Number of New Units"</span>,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">autoWidth =</span> <span class="cn">TRUE</span>, <span class="at">dom =</span> <span class="st">"tip"</span>)</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-c5e7e83a75d926d0ea6f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c5e7e83a75d926d0ea6f">{"x":{"filter":"none","vertical":false,"caption":"<caption>Largest Number of New Units<\/caption>","data":[["Houston-Sugar Land-Baytown, TX Metro Area","Dallas-Fort Worth-Arlington, TX Metro Area","New York-Northern New Jersey-Long Island, NY-NJ-PA Metro Area","Atlanta-Sandy Springs-Marietta, GA Metro Area","Washington-Arlington-Alexandria, DC-VA-MD-WV Metro Area","Phoenix-Mesa-Scottsdale, AZ Metro Area","Seattle-Tacoma-Bellevue, WA Metro Area","Austin-Round Rock, TX Metro Area","Los Angeles-Long Beach-Anaheim, CA Metro Area","Orlando-Kissimmee, FL Metro Area","Charlotte-Gastonia-Concord, NC-SC Metro Area","Miami-Fort Lauderdale-Pompano Beach, FL Metro Area","Denver-Aurora-Broomfield, CO Metro Area","Nashville-Davidson--Murfreesboro--Franklin, TN Metro Area","Chicago-Naperville-Joliet, IL-IN-WI Metro Area","Tampa-St. Petersburg-Clearwater, FL Metro Area","Minneapolis-St. Paul-Bloomington, MN-WI Metro Area","Boston-Cambridge-Quincy, MA-NH Metro Area","Portland-Vancouver-Beaverton, OR-WA Metro Area","San Francisco-Oakland-Fremont, CA Metro Area","Raleigh-Cary, NC Metro Area","Philadelphia-Camden-Wilmington, PA-NJ-DE-MD Metro Area","Riverside-San Bernardino-Ontario, CA Metro Area","Las Vegas-Paradise, NV Metro Area","San Antonio, TX Metro Area","Jacksonville, FL Metro Area","San Diego-Carlsbad-San Marcos, CA Metro Area","Indianapolis-Carmel, IN Metro Area","Kansas City, MO-KS Metro Area","Columbus, OH Metro Area","Baltimore-Towson, MD Metro Area","Los Angeles-Long Beach-Santa Ana, CA Metro Area","San Jose-Sunnyvale-Santa Clara, CA Metro Area","St. Louis, MO-IL Metro Area","Detroit-Warren-Livonia, MI Metro Area","Salt Lake City, UT Metro Area","North Port-Bradenton-Sarasota, FL Metro Area","Oklahoma City, OK Metro Area","Virginia Beach-Norfolk-Newport News, VA-NC Metro Area","Charleston-North Charleston-Summerville, SC Metro Area","Sacramento--Arden-Arcade--Roseville, CA Metro Area","Boise City-Nampa, ID Metro Area","Richmond, VA Metro Area","Myrtle Beach-North Myrtle Beach-Conway, SC Metro Area","Cape Coral-Fort Myers, FL Metro Area","Cincinnati-Middletown, OH-KY-IN Metro Area","Des Moines-West Des Moines, IA Metro Area","Provo-Orem, UT Metro Area","Greenville-Mauldin-Easley, SC Metro Area","Louisville-Jefferson County, KY-IN Metro Area","Pittsburgh, PA Metro Area","Omaha-Council Bluffs, NE-IA Metro Area","Columbia, SC Metro Area","McAllen-Edinburg-Mission, TX Metro Area","Durham-Chapel Hill, NC Metro Area","Colorado Springs, CO Metro Area","Tulsa, OK Metro Area","El Paso, TX Metro Area","Fayetteville-Springdale-Rogers, AR-MO Metro Area","Memphis, TN-MS-AR Metro Area","Lakeland-Winter Haven, FL Metro Area","Baton Rouge, LA Metro Area","Madison, WI Metro Area","Tucson, AZ Metro Area","Naples-Marco Island, FL Metro Area","Knoxville, TN Metro Area","Birmingham-Hoover, AL Metro Area","Ogden-Clearfield, UT Metro Area","Grand Rapids-Wyoming, MI Metro Area","New Orleans-Metairie-Kenner, LA Metro Area","Little Rock-North Little Rock-Conway, AR Metro Area","Augusta-Richmond County, GA-SC Metro Area","Wilmington, NC Metro Area","Cleveland-Elyria-Mentor, OH Metro Area","Huntsville, AL Metro Area","Reno-Sparks, NV Metro Area","Milwaukee-Waukesha-West Allis, WI Metro Area","Greeley, CO Metro Area","Spokane, WA Metro Area","Fresno, CA Metro Area","Killeen-Temple-Fort Hood, TX Metro Area","Fort Collins-Loveland, CO Metro Area","Greensboro-High Point, NC Metro Area","Winston-Salem, NC Metro Area","Fargo, ND-MN Metro Area","Albany-Schenectady-Troy, NY Metro Area","Deltona-Daytona Beach-Ormond Beach, FL Metro Area","Pensacola-Ferry Pass-Brent, FL Metro Area","Albuquerque, NM Metro Area","Asheville, NC Metro Area","Salisbury, MD Metro Area","Bakersfield, CA Metro Area","Lexington-Fayette, KY Metro Area","Sioux Falls, SD Metro Area","Savannah, GA Metro Area","Palm Bay-Melbourne-Titusville, FL Metro Area","St. George, UT Metro Area","Chattanooga, TN-GA Metro Area","Portland-South Portland-Biddeford, ME Metro Area","Lubbock, TX Metro Area","Stockton, CA Metro Area","College Station-Bryan, TX Metro Area","Clarksville, TN-KY Metro Area","Rochester, NY Metro Area","Fayetteville, NC Metro Area","Lincoln, NE Metro Area","Gulfport-Biloxi, MS Metro Area","Port St. Lucie, FL Metro Area","Providence-New Bedford-Fall River, RI-MA Metro Area","Bridgeport-Stamford-Norwalk, CT Metro Area","Corpus Christi, TX Metro Area","Springfield, MO Metro Area","Crestview-Fort Walton Beach-Destin, FL Metro Area","Wichita, KS Metro Area","Kennewick-Pasco-Richland, WA Metro Area","Harrisburg-Carlisle, PA Metro Area","Tallahassee, FL Metro Area","Buffalo-Niagara Falls, NY Metro Area","Lafayette, LA Metro Area","Jackson, MS Metro Area","Spartanburg, SC Metro Area","Boulder, CO Metro Area","Bend, OR Metro Area","Daphne-Fairhope-Foley, AL Micro Area","Hartford-West Hartford-East Hartford, CT Metro Area","Worcester, MA Metro Area","Jacksonville, NC Metro Area","Coeur d'Alene, ID Metro Area","Laredo, TX Metro Area","Urban Honolulu, HI Metro Area","Brownsville-Harlingen, TX Metro Area","Fort Wayne, IN Metro Area","Shreveport-Bossier City, LA Metro Area","Olympia, WA Metro Area","Allentown-Bethlehem-Easton, PA-NJ Metro Area","Hilton Head Island-Beaufort, SC Micro Area","Lancaster, PA Metro Area","Ocala, FL Metro Area","Lake Charles, LA Metro Area","Beaumont-Port Arthur, TX Metro Area","Visalia-Porterville, CA Metro Area","The Villages, FL Micro Area","Oxnard-Thousand Oaks-Ventura, CA Metro Area","Gainesville, FL Metro Area","Santa Rosa-Petaluma, CA Metro Area","Salem, OR Metro Area","Charlottesville, VA Metro Area","Iowa City, IA Metro Area","Syracuse, NY Metro Area","Columbia, MO Metro Area","Bismarck, ND Metro Area","Dover, DE Metro Area","Billings, MT Metro Area","Green Bay, WI Metro Area","Rochester, MN Metro Area","Columbus, GA-AL Metro Area","Auburn-Opelika, AL Metro Area","Tuscaloosa, AL Metro Area","Bellingham, WA Metro Area","Midland, TX Metro Area","Waco, TX Metro Area","Bowling Green, KY Metro Area","Hagerstown-Martinsburg, MD-WV Metro Area","Prescott, AZ Metro Area","Eugene-Springfield, OR Metro Area","New Haven-Milford, CT Metro Area","Champaign-Urbana, IL Metro Area","Punta Gorda, FL Metro Area","Mobile, AL Metro Area","Panama City-Lynn Haven-Panama City Beach, FL Metro Area","Dayton, OH Metro Area","Burlington, NC Metro Area","Montgomery, AL Metro Area","Logan, UT-ID Metro Area","Manchester-Nashua, NH Metro Area","Warner Robins, GA Metro Area","Toledo, OH Metro Area","Gainesville, GA Metro Area","York-Hanover, PA Metro Area","Akron, OH Metro Area","Cedar Rapids, IA Metro Area","Bremerton-Silverdale, WA Metro Area","Amarillo, TX Metro Area","Anchorage, AK Metro Area","Las Cruces, NM Metro Area","Lansing-East Lansing, MI Metro Area","Odessa, TX Metro Area","Athens-Clarke County, GA Metro Area","Appleton, WI Metro Area","Vallejo-Fairfield, CA Metro Area","Sebastian-Vero Beach, FL Metro Area","Burlington-South Burlington, VT Metro Area","Greenville, NC Metro Area","Honolulu, HI Metro Area","Scranton--Wilkes-Barre, PA Metro Area","Valdosta, GA Metro Area","Jonesboro, AR Metro Area","San Luis Obispo-Paso Robles, CA Metro Area","Yuma, AZ Metro Area","Evansville, IN-KY Metro Area","Rapid City, SD Metro Area","Lynchburg, VA Metro Area","Atlantic City-Hammonton, NJ Metro Area","Hickory-Lenoir-Morganton, NC Metro Area","Idaho Falls, ID Metro Area","Poughkeepsie-Newburgh-Middletown, NY Metro Area","Medford, OR Metro Area","Davenport-Moline-Rock Island, IA-IL Metro Area","St. Cloud, MN Metro Area","Johnson City, TN Metro Area","Winchester, VA-WV Metro Area","Chico, CA Metro Area","Lafayette-West Lafayette, IN Metro Area","Duluth, MN-WI Metro Area","Missoula, MT Metro Area","Ocean City, NJ Metro Area","Fort Smith, AR-OK Metro Area","Lake Havasu City-Kingman, AZ Metro Area","Barnstable Town, MA Metro Area","Trenton-Ewing, NJ Metro Area","Santa Maria-Santa Barbara, CA Metro Area","Lawrence, KS Metro Area","Eau Claire, WI Metro Area","Kalamazoo-Portage, MI Metro Area","Monroe, LA Metro Area","Cleveland, TN Metro Area","Springfield, MA Metro Area","Manhattan, KS Metro Area","Roanoke, VA Metro Area","Kingsport-Bristol-Bristol, TN-VA Metro Area","Elizabethtown, KY Metro Area","Florence, SC Metro Area","Wenatchee-East Wenatchee, WA Metro Area","Ann Arbor, MI Metro Area","South Bend-Mishawaka, IN-MI Metro Area","Grand Junction, CO Metro Area","Ames, IA Metro Area","Flagstaff, AZ Metro Area","Houma-Bayou Cane-Thibodaux, LA Metro Area","Peoria, IL Metro Area","Hammond, LA Micro Area","Yakima, WA Metro Area","Canton-Massillon, OH Metro Area","Grand Forks, ND-MN Metro Area","Brunswick, GA Metro Area","State College, PA Metro Area","Sherman-Denison, TX Metro Area","Waterloo-Cedar Falls, IA Metro Area","Blacksburg-Christiansburg-Radford, VA Metro Area","Joplin, MO Metro Area","Tyler, TX Metro Area","Salinas, CA Metro Area","Modesto, CA Metro Area","Bloomington, IN Metro Area","Harrisonburg, VA Metro Area","California-Lexington Park, MD Metro Area","Mankato-North Mankato, MN Metro Area","Reading, PA Metro Area","Cheyenne, WY Metro Area","Oshkosh-Neenah, WI Metro Area","Norwich-New London, CT Metro Area","La Crosse, WI-MN Metro Area","Sioux City, IA-NE-SD Metro Area","Ithaca, NY Metro Area","Mount Vernon-Anacortes, WA Metro Area","Longview, TX Metro Area","Springfield, IL Metro Area","Merced, CA Metro Area","Dothan, AL Metro Area","Hinesville-Fort Stewart, GA Metro Area","Kahului-Wailuku, HI Micro Area","Casper, WY Metro Area","Hanford-Corcoran, CA Metro Area","Alexandria, LA Metro Area","Macon, GA Metro Area","Erie, PA Metro Area","Florence-Muscle Shoals, AL Metro Area","Wausau, WI Metro Area","Abilene, TX Metro Area","Homosassa Springs, FL Micro Area","Dubuque, IA Metro Area","Cape Girardeau-Jackson, MO-IL Metro Area","Lafayette, IN Metro Area","Topeka, KS Metro Area","Youngstown-Warren-Boardman, OH-PA Metro Area","Santa Cruz-Watsonville, CA Metro Area","Sumter, SC Metro Area","Flint, MI Metro Area","Lebanon, PA Metro Area","Owensboro, KY Metro Area","Madera-Chowchilla, CA Metro Area","Elkhart-Goshen, IN Metro Area","Bangor, ME Metro Area","Corvallis, OR Metro Area","Redding, CA Metro Area","San Angelo, TX Metro Area","Jackson, TN Metro Area","Yuba City, CA Metro Area","Albany-Lebanon, OR Micro Area","Utica-Rome, NY Metro Area","Glens Falls, NY Metro Area","Monroe, MI Metro Area","Pueblo, CO Metro Area","Huntington-Ashland, WV-KY-OH Metro Area","Charleston, WV Metro Area","Kingston, NY Metro Area","El Centro, CA Metro Area","Holland-Grand Haven, MI Metro Area","Goldsboro, NC Metro Area","Albany, GA Metro Area","Jefferson City, MO Metro Area","Terre Haute, IN Metro Area","Saginaw-Saginaw Township North, MI Metro Area","Victoria, TX Metro Area","Fond du Lac, WI Metro Area","Racine, WI Metro Area","Staunton-Waynesboro, VA Micro Area","Janesville, WI Metro Area","Longview, WA Metro Area","Napa, CA Metro Area","Morristown, TN Metro Area","Rocky Mount, NC Metro Area","Bloomington-Normal, IL Metro Area","New Bern, NC Micro Area","Binghamton, NY Metro Area","Prescott Valley-Prescott, AZ Metro Area","Morgantown, WV Metro Area","Columbus, IN Metro Area","Niles-Benton Harbor, MI Metro Area","Pocatello, ID Metro Area","Chambersburg, PA Micro Area","Muskegon-Norton Shores, MI Metro Area","Texarkana, TX-Texarkana, AR Metro Area","Rockford, IL Metro Area","Great Falls, MT Metro Area","Kokomo, IN Metro Area","Santa Fe, NM Metro Area","Wichita Falls, TX Metro Area","Bloomington, IL Metro Area","Pittsfield, MA Metro Area","Dalton, GA Metro Area","Lewiston-Auburn, ME Metro Area","Vineland-Millville-Bridgeton, NJ Metro Area","Anderson, SC Metro Area","Grand Island, NE Micro Area","Sheboygan, WI Metro Area","Lawton, OK Metro Area","Michigan City-La Porte, IN Metro Area","Gettysburg, PA Micro Area","Decatur, AL Metro Area","Hattiesburg, MS Metro Area","Williamsport, PA Metro Area","Santa Barbara-Santa Maria-Goleta, CA Metro Area","Farmington, NM Metro Area","Jackson, MI Metro Area","St. Joseph, MO-KS Metro Area","Parkersburg-Marietta-Vienna, WV-OH Metro Area","Sierra Vista-Douglas, AZ Micro Area","Grants Pass, OR Micro Area","Rome, GA Metro Area","Pascagoula, MS Metro Area","Dayton-Kettering, OH Metro Area","Palm Coast, FL Metro Area","Walla Walla, WA Metro Area","Watertown-Fort Drum, NY Micro Area","East Stroudsburg, PA Micro Area","Altoona, PA Metro Area","Muncie, IN Metro Area","Elmira, NY Metro Area","Carson City, NV Metro Area","Sebring, FL Micro Area","Carbondale-Marion, IL Metro Area","Kankakee-Bradley, IL Metro Area","Lima, OH Metro Area","Lewiston, ID-WA Metro Area","Midland, MI Micro Area","Bloomsburg-Berwick, PA Micro Area","Gadsden, AL Metro Area","Cumberland, MD-WV Metro Area","Twin Falls, ID Micro Area","Springfield, OH Metro Area","Bay City, MI Metro Area","Anniston-Oxford, AL Metro Area","Johnstown, PA Metro Area","Pine Bluff, AR Metro Area","Danville, VA Metro Area","Mansfield, OH Metro Area","Battle Creek, MI Metro Area","Decatur, IL Metro Area","Hot Springs, AR Metro Area","Beckley, WV Micro Area","Wheeling, WV-OH Metro Area","Anderson, IN Metro Area","Fairbanks, AK Metro Area","Danville, IL Metro Area","Enid, OK Metro Area","Sandusky, OH Metro Area","Weirton-Steubenville, WV-OH Metro Area","Steubenville-Weirton, OH-WV Metro Area"],["26420","19100","35620","12060","47900","38060","42660","12420","31080","36740","16740","33100","19740","34980","16980","45300","33460","14460","38900","41860","39580","37980","40140","29820","41700","27260","41740","26900","28140","18140","12580","31100","41940","41180","19820","41620","35840","36420","47260","16700","40900","14260","40060","34820","15980","17140","19780","39340","24860","31140","38300","36540","17900","32580","20500","17820","46140","21340","22220","32820","29460","12940","31540","46060","34940","28940","13820","36260","24340","35380","30780","12260","48900","17460","26620","39900","33340","24540","44060","23420","28660","22660","24660","49180","22020","10580","19660","37860","10740","11700","41540","12540","30460","43620","42340","37340","41100","16860","38860","31180","44700","17780","17300","40380","22180","30700","25060","38940","39300","14860","18580","44180","18880","48620","28420","25420","45220","15380","29180","27140","43900","14500","13460","19300","25540","49340","27340","17660","29700","46520","15180","23060","43340","36500","10900","25940","29540","36100","29340","13140","47300","45540","37100","23540","42220","41420","16820","26980","45060","17860","13900","20100","13740","24580","40340","17980","12220","46220","13380","33260","47380","14540","25180","39140","21660","35300","16580","39460","33660","37460","19380","15500","33860","30860","31700","47580","45780","23580","49620","10420","16300","14740","11100","11260","29740","29620","36220","12020","11540","46700","42680","15540","24780","26180","42540","46660","27860","42020","49740","21780","39660","31340","12100","25860","26820","39100","32780","19340","41060","27740","49020","17020","29200","20260","33540","36140","22900","29420","12700","45940","42200","29940","20740","28020","33740","17420","44140","31740","40220","28700","21060","22500","48300","11460","43780","24300","11180","22380","26380","37900","25220","49420","15940","24220","15260","44300","43300","47940","13980","27900","46340","41500","33700","14020","25500","15680","31860","39740","16940","36780","35980","29100","43580","27060","34580","30980","44100","32900","20020","25980","27980","16220","25260","10780","31420","21500","22520","48140","10180","26140","20220","16020","29140","45820","49660","42100","44940","22420","30140","36980","31460","21140","12620","18700","39820","41660","27180","49700","10540","46540","24020","33780","39380","26580","16620","28740","20940","26100","24140","10500","27620","45460","40980","47020","22540","39540","44420","27500","31020","34900","34100","40580","14060","35100","13780","39150","34060","18020","35660","38540","16540","34740","45500","40420","24500","29020","42140","48660","14010","38340","19140","30340","47220","11340","24260","43100","30020","33140","23900","19460","25620","48700","42060","22140","27100","41140","37620","43420","24420","40660","37700","19430","37380","47460","48060","20700","11020","34620","21300","16180","42700","16060","28100","30620","30300","33220","14100","23460","19060","46300","44220","13020","11500","27780","38220","19260","31900","12980","19500","26300","13220","48540","11300","21820","19180","21420","41780","48260","44600"],[482075,460826,446020,254377,232483,219939,213022,212392,184260,171588,170359,164006,160762,145531,145175,140207,127378,118018,117234,116917,116534,115019,101466,100807,98429,94357,78834,76533,75524,74006,72300,67286,66077,65192,63776,63479,62245,59298,58629,57575,57144,56352,51093,50763,50253,48807,47942,45973,43432,42813,40764,40714,40554,40099,39360,39344,36763,36501,35506,35280,34738,34440,31932,31868,30939,30308,29688,29273,28918,28736,28099,27803,27081,26912,26773,26607,26400,25971,24958,24859,24053,23423,23150,22851,22751,22590,22427,22315,21981,21859,21814,21054,21004,20967,20672,20559,20200,20155,19669,19236,19138,18861,18461,18379,18367,18263,18256,18249,18130,18034,18014,17966,17885,17583,17115,16747,16546,16321,16272,15664,15062,14978,14851,14721,14601,14494,14474,14046,13781,13726,13631,13591,13258,13119,13069,12809,12736,12540,12505,12381,12305,12028,11996,11906,11804,11795,11693,11377,11285,11260,11044,10935,10928,10744,10694,10641,10615,10599,10574,10327,10299,10187,9996,9956,9784,9780,9749,9717,9710,9669,9365,9362,9292,9266,9248,9183,9166,9133,8969,8880,8829,8815,8802,8644,8569,8469,8377,8355,8183,8177,8149,8055,8017,7980,7923,7858,7809,7733,7718,7680,7472,7282,7222,7169,7115,7034,6963,6803,6700,6565,6501,6443,6379,6369,6244,6244,6217,6163,6116,6106,6062,6003,5960,5922,5851,5810,5773,5769,5684,5683,5613,5600,5589,5584,5558,5554,5487,5455,5370,5249,5210,5205,5155,5152,4961,4853,4781,4745,4740,4727,4689,4680,4677,4654,4582,4580,4529,4459,4389,4297,4221,4092,4068,4046,3881,3876,3864,3803,3802,3789,3763,3709,3677,3636,3625,3509,3502,3490,3484,3422,3416,3409,3403,3343,3318,3274,3267,3263,3238,3191,3146,3098,3093,3080,3049,3032,3022,2983,2958,2937,2908,2869,2832,2796,2766,2754,2692,2682,2676,2650,2607,2580,2530,2495,2488,2481,2470,2455,2388,2323,2278,2276,2256,2227,2194,2180,2125,2100,2060,2045,2042,2007,1998,1995,1984,1979,1974,1934,1807,1763,1739,1736,1714,1692,1654,1612,1595,1594,1552,1508,1503,1501,1497,1463,1436,1323,1317,1308,1307,1293,1268,1231,1226,1211,1188,1161,1158,1126,1121,1108,1087,1068,1059,1025,1011,937,927,915,904,835,822,819,816,795,742,659,620,619,610,554,543,509,316,305,266,234,219,204,115]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Location<\/th>\n      <th>CBSA<\/th>\n      <th>New permits<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"autoWidth":true,"dom":"tip","columnDefs":[{"className":"dt-right","targets":2},{"name":"Location","targets":0},{"name":"CBSA","targets":1},{"name":"New permits","targets":2}],"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><strong>Houston, TX</strong> permitted the largest number of new housing units from 2010 to 2019 with <strong>482,075</strong> new units permitted.</p>
</section>
<section id="in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units" class="level2">
<h2 class="anchored" data-anchor-id="in-what-year-did-albuquerque-nm-cbsa-number-10740-permit-the-most-new-housing-units">In what year did Albuquerque, NM (CBSA Number 10740) permit the most new housing units?</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>albuquerque_permits <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="st">"10740"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA, year) <span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(new_units))</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a> <span class="fu">datatable</span>(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  albuquerque_permits <span class="sc">|&gt;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CBSA ID</span><span class="st">`</span> <span class="ot">=</span> CBSA,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">Year =</span> year,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">New Units Permitted</span><span class="st">`</span> <span class="ot">=</span> new_units</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Year, <span class="st">`</span><span class="at">CBSA ID</span><span class="st">`</span>, <span class="st">`</span><span class="at">New Units Permitted</span><span class="st">`</span>),</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"New Housing Units in Albuquerque, NM"</span>,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'tip'</span>, </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">autoWidth =</span> <span class="cn">TRUE</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-fb6b77e511cf390ca08d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-fb6b77e511cf390ca08d">{"x":{"filter":"none","vertical":false,"caption":"<caption>New Housing Units in Albuquerque, NM<\/caption>","data":[[2021,2022,2023,2013,2014,2016,2015,2017,2018,2019,2012,2020,2010,2009,2011],[10740,10740,10740,10740,10740,10740,10740,10740,10740,10740,10740,10740,10740,10740,10740],[4021,2852,2834,2606,2543,2465,2295,2256,2186,2148,2084,2014,1764,1692,1634]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Year<\/th>\n      <th>CBSA ID<\/th>\n      <th>New Units Permitted<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"dom":"tip","autoWidth":true,"columnDefs":[{"className":"dt-right","targets":[0,1,2]},{"name":"Year","targets":0},{"name":"CBSA ID","targets":1},{"name":"New Units Permitted","targets":2}],"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Albuquerque, NM permitted the most new units in <strong>2021</strong>.</p>
</section>
<section id="which-state-not-cbsa-had-the-highest-average-individual-income-in-2015" class="level2">
<h2 class="anchored" data-anchor-id="which-state-not-cbsa-had-the-highest-average-individual-income-in-2015">Which state (not CBSA) had the highest average individual income in 2015?</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>cbsa_2015 <span class="ot">&lt;-</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  INCOME <span class="sc">|&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    HOUSEHOLDS <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, NAME, year, households),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, NAME, year, population),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">str_extract</span>(NAME, <span class="st">", (.{2})"</span>, <span class="at">group=</span><span class="dv">1</span>))<span class="sc">|&gt;</span>     </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">total_income_cbsa =</span> household_income <span class="sc">*</span> households</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>top_state_2015 <span class="ot">&lt;-</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  cbsa_2015 <span class="sc">|&gt;</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_income =</span> <span class="fu">sum</span>(total_income_cbsa, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop    =</span> <span class="fu">sum</span>(population,       <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_individual_income =</span> total_income <span class="sc">/</span> total_pop,</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_individual_income))</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  top_state_2015 <span class="sc">|&gt;</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">State =</span> state,</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Avg Individual Income</span><span class="st">`</span> <span class="ot">=</span> avg_individual_income,</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Total State Income</span><span class="st">`</span> <span class="ot">=</span> total_income,</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Total Population</span><span class="st">`</span> <span class="ot">=</span> total_pop</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Highest Individual Income by State"</span>,</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'tip'</span>,</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">autoWidth =</span> <span class="cn">TRUE</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Avg Individual Income"</span>, <span class="st">"Total State Income"</span>),</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">currency =</span> <span class="st">"$"</span>,</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">0</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a><span class="fu">formatRound</span>(</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="st">"Total Population"</span>,</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">0</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-d19ca6675d50a0a7efc6" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d19ca6675d50a0a7efc6">{"x":{"filter":"none","vertical":false,"caption":"<caption>Highest Individual Income by State<\/caption>","data":[["DC","MA","CT","AK","VT","NH","MN","MD","WA","CO","ND","NY","HI","ME","WI","RI","NE","SD","IL","IA","PA","WY","CA","NJ","MO","OR","VA","MT","OH","DE","MI","UT","TX","KY","GA","KS","IN","NC","OK","AZ","TN","NV","SC","FL","ID","AL","LA","AR","NM","WV","MS","PR"],[202663489140,186566282228,94480626751,13197939163,5715539271,22249129392,116902131752,93826139111,161492961867,123095455889,13236786070,606749678532,32994062792,20681619066,102818567612,36712021755,29950574149,8975551194,262262861989,44381872108,313011539946,4009185964,845185409868,19566133509,135981133083,90838697950,98627665257,13535349740,218840799220,3547319106,175744254958,53283805620,489874231682,51439352901,170746594521,22624606130,84853440974,172481513224,51416746747,124804732169,115699938584,49039466550,73956340549,363239584433,22249785194,71252458302,70950015789,34776672740,28725058212,23946108281,23173691784,22353202947],[6098283,6754601,3474313,499421,216661,847504,4469143,3665585,6350174,4840469,546662,25676968,1431603,906200,4512709,1613070,1324056,397691,11624088,1969270,13890368,179299,38700100,896198,6235216,4169845,4532206,641526,10602897,173533,8639435,2688976,24860668,2613656,8685867,1158609,4414972,8994051,2692251,6589624,6110935,2620460,3967485,19783678,1217204,3918760,3991679,2010218,1665941,1395695,1446662,3325515],[33232.87704752305,27620.62218449321,27194.04577279019,26426.48019006009,26380.10196112821,26252.53614378221,26157.61718790381,25596.4979971819,25431.26564201233,25430.48119696666,24213.83975838818,23630.11390332379,23046.93605140531,22822.35606488634,22784.22287189358,22759.10019713961,22620.32281791707,22569.15845216512,22562.01621916489,22537.22044615517,22534.43104934297,22360.33644359422,21839.35984320454,21832.37801133232,21808.5681527312,21784.67016160073,21761.51420676818,21098.67681122823,20639.7175432337,20441.75520506186,20342.1004912937,19815.6493847472,19704.78957693333,19680.99585446593,19657.97939583924,19527.38683196834,19219.47431920293,19177.2887683203,19098.05094212984,18939.58322493059,18933.26284504744,18714.06796898254,18640.60999575298,18360.56897170486,18279.4216860937,18182.39910124631,17774.47930783011,17299.95092074591,17242.54233013054,17157.12120556425,16018.73263001309,6721.72669406092]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>State<\/th>\n      <th>Total State Income<\/th>\n      <th>Total Population<\/th>\n      <th>Avg Individual Income<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"dom":"tip","autoWidth":true,"columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 0, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"$\", 0, 3, \",\", \".\", true, null);\n  }"},{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"$\", 0, 3, \",\", \".\", true, null);\n  }"},{"className":"dt-right","targets":[1,2,3]},{"name":"State","targets":0},{"name":"Total State Income","targets":1},{"name":"Total Population","targets":2},{"name":"Avg Individual Income","targets":3}],"order":[],"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
<p>Washington DC had the highest individual income by state in 2015 at <strong>$33,233</strong>.</p>
</section>
<section id="data-scientists-and-business-analysts-are-recorded-under-naics-code-5182.-what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country-in-recent-years-the-san-francisco-cbsa-has-had-the-most-data-scientists." class="level2">
<h2 class="anchored" data-anchor-id="data-scientists-and-business-analysts-are-recorded-under-naics-code-5182.-what-is-the-last-year-in-which-the-nyc-cbsa-had-the-most-data-scientists-in-the-country-in-recent-years-the-san-francisco-cbsa-has-had-the-most-data-scientists.">Data scientists and business analysts are recorded under NAICS code 5182. What is the last year in which the NYC CBSA had the most data scientists in the country? In recent years, the San Francisco CBSA has had the most data scientists.</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>bls_5182 <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">5182</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cbsa_num =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>, <span class="st">""</span>, FIPS), <span class="st">"0"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cbsa_num, YEAR, EMPLOYMENT)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>cbsa_lookup <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">|&gt;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">NAME =</span> <span class="fu">first</span>(NAME), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA_num =</span> <span class="fu">as.integer</span>(GEOID)) <span class="sc">|&gt;</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CBSA_num, NAME)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>ds_named <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(bls_5182, cbsa_lookup, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cbsa_num"</span> <span class="ot">=</span> <span class="st">"CBSA_num"</span>))</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>most_by_year <span class="ot">&lt;-</span> ds_named <span class="sc">|&gt;</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(EMPLOYMENT, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>nyc_cbsa <span class="ot">&lt;-</span> cbsa_lookup <span class="sc">|&gt;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(NAME, <span class="st">"^New York"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(CBSA_num)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>nyc_last_most <span class="ot">&lt;-</span> most_by_year <span class="sc">|&gt;</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cbsa_num <span class="sc">==</span> nyc_cbsa) <span class="sc">|&gt;</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(YEAR, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> nyc_last_most <span class="sc">|&gt;</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">year =</span> YEAR, <span class="at">employment =</span> EMPLOYMENT)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  result <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">Year =</span> year, <span class="st">`</span><span class="at">Data Scientists</span><span class="st">`</span> <span class="ot">=</span> employment),</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">5</span>, <span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>),</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"NYC Data Scientists"</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-d6ae31f514743bb50487" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d6ae31f514743bb50487">{"x":{"filter":"none","vertical":false,"caption":"<caption>NYC Data Scientists<\/caption>","data":[[2015],[18922]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Year<\/th>\n      <th>Data Scientists<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"t","ordering":false,"columnDefs":[{"className":"dt-right","targets":[0,1]},{"name":"Year","targets":0},{"name":"Data Scientists","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Nyc had the most data scientists in <strong>2015</strong> with <strong>18,922</strong> data scientists.</p>
</section>
<section id="what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak" class="level2">
<h2 class="anchored" data-anchor-id="what-fraction-of-total-wages-in-the-nyc-cbsa-was-earned-by-people-employed-in-the-finance-and-insurance-industries-naics-code-52-in-what-year-did-this-fraction-peak">What fraction of total wages in the NYC CBSA was earned by people employed in the finance and insurance industries (NAICS code 52)? In what year did this fraction peak?</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>wages_now <span class="ot">&lt;-</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  WAGES <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cbsa =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>,<span class="st">""</span>, FIPS), <span class="st">"0"</span>)))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>nyc_wages <span class="ot">&lt;-</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  wages_now <span class="sc">|&gt;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cbsa <span class="sc">==</span> <span class="dv">35620</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_wages_all =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_wages_fin =</span> <span class="fu">sum</span>(TOTAL_WAGES[INDUSTRY <span class="sc">==</span> <span class="dv">52</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">finance_fraction =</span> total_wages_fin <span class="sc">/</span> total_wages_all) <span class="sc">|&gt;</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(finance_fraction))</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> nyc_wages <span class="sc">|&gt;</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Year =</span> YEAR,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Wages</span><span class="st">`</span> <span class="ot">=</span> total_wages_all,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Wages for Finance</span><span class="st">`</span> <span class="ot">=</span> total_wages_fin,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Finance Percent</span><span class="st">`</span> <span class="ot">=</span> finance_fraction</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  tbl,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">25</span>, <span class="at">autoWidth =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"NYC CBSA: finance wage share by year"</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(<span class="fu">c</span>(<span class="st">"Total Wages"</span>,<span class="st">"Total Wages for Finance"</span>), <span class="at">currency =</span> <span class="st">"$"</span>, <span class="at">digits =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatPercentage</span>(<span class="st">"Finance Percent"</span>, <span class="dv">1</span>)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>result  </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-1593866ced9e7ae82d1d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1593866ced9e7ae82d1d">{"x":{"filter":"none","vertical":false,"caption":"<caption>NYC CBSA: finance wage share by year<\/caption>","data":[[2014,2011,2010,2009,2021,2012,2017,2013,2018,2015,2016,2022,2023,2019],[2587096519796,2452875238158,2366455158958,2194200174111,3636399927489,2543568475824,3176952501734,2663041532424,3196707717054,3008221071967,3038312046515,4104601808975,4160135177511,3617150803059],[119105615711,108996581223,103632250413,94479998021,156065553132,107816036343,130116071763,107314017412,128706315380,119431006954,118586163642,159178860174,160765698817,132713121248],[0.04603833478945417,0.04443625159869589,0.04379218850638669,0.04305896933914857,0.04291759879111154,0.04238770741490359,0.04095625341958429,0.04029753802386956,0.04026214679977445,0.03970153924754841,0.03903027793936456,0.03878058520218557,0.03864434494486445,0.03668996082103224]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Year<\/th>\n      <th>Total Wages<\/th>\n      <th>Total Wages for Finance<\/th>\n      <th>Finance Percent<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":25,"autoWidth":true,"columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatPercentage(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"$\", 0, 3, \",\", \".\", true, null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatCurrency(data, \"$\", 0, 3, \",\", \".\", true, null);\n  }"},{"className":"dt-right","targets":[0,1,2,3]},{"name":"Year","targets":0},{"name":"Total Wages","targets":1},{"name":"Total Wages for Finance","targets":2},{"name":"Finance Percent","targets":3}],"order":[],"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
<p><strong>4.6%</strong> of total wages in the NYC CBSA was earned by people in the finance and insurance industry at its peak in <strong>2014</strong>.</p>
</section>
</section>
<section id="task-3" class="level1">
<h1>Task 3</h1>
<section id="the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009." class="level2">
<h2 class="anchored" data-anchor-id="the-relationship-between-monthly-rent-and-average-household-income-per-cbsa-in-2009.">The relationship between monthly rent and average household income per CBSA in 2009.</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>cbsa_2009 <span class="ot">&lt;-</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  RENT <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, monthly_rent) <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    INCOME <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, NAME, year, household_income),</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cbsa_2009, <span class="fu">aes</span>(<span class="at">x =</span> household_income, <span class="at">y =</span> monthly_rent)) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Rent vs Household Income by CBSA (2009)"</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Average household income"</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average monthly rent"</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The data for <strong>monthly rent</strong> and <strong>average household</strong> income seem to have a positive correlation. This positive correlation makes sense because with more income, families are able to afford a higher rent cost, and provide a better quality of life. This correlation could also be attributed to inflation of rent price based on the increase in household income.</p>
</section>
<section id="the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas.-design-your-visualization-so-that-it-is-possible-to-see-the-evolution-of-this-relationship-over-time." class="level2">
<h2 class="anchored" data-anchor-id="the-relationship-between-total-employment-and-total-employment-in-the-health-care-and-social-services-sector-naics-62-across-different-cbsas.-design-your-visualization-so-that-it-is-possible-to-see-the-evolution-of-this-relationship-over-time.">The relationship between total employment and total employment in the health care and social services sector (NAICS 62) across different CBSAs. Design your visualization so that it is possible to see the evolution of this relationship over time.</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>total_emp <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cbsa =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>, <span class="st">""</span>, FIPS), <span class="st">"0"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cbsa, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_emp =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Health care </span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>health_emp <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">62</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cbsa =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>, <span class="st">""</span>, FIPS), <span class="st">"0"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cbsa, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">health_emp =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>emp_df <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(total_emp, health_emp, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cbsa"</span>, <span class="st">"YEAR"</span>))</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emp_df, <span class="fu">aes</span>(<span class="at">x =</span> total_emp <span class="sc">/</span> <span class="fl">1e6</span>, <span class="at">y =</span> health_emp <span class="sc">/</span> <span class="fl">1e6</span>, <span class="at">color =</span> <span class="fu">factor</span>(cbsa))) <span class="sc">+</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">1.6</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> comma, <span class="at">name =</span> <span class="st">"Total employment (millions)"</span>) <span class="sc">+</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma, <span class="at">name =</span> <span class="st">"Health care (millions)"</span>) <span class="sc">+</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> YEAR, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Health Care vs Total Employment"</span>) <span class="sc">+</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see from these plots that as total employment increases, employment within the healthcare sector increases steadily as well, which is intuitive. But we can infer from this data that total employment also increases as the population increases, because the population has increased since 2013. If more people exist, more people will become employed and be employed in the healthcare sector. However, if we take a look at the graphs from 2019 and 2021, we can see that after the pandemic in 2020 the total employment in 2021 actually goes down significantly, while healthcare employment remains relatively the same. This highlights the need for healthcare workers after a global health crisis.</p>
</section>
<section id="the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas." class="level2">
<h2 class="anchored" data-anchor-id="the-evolution-of-average-household-size-over-time.-use-different-lines-to-represent-different-cbsas.">The evolution of average household size over time. Use different lines to represent different CBSAs.</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gghighlight)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>hh_pop <span class="ot">&lt;-</span> HOUSEHOLDS <span class="sc">|&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, households, year) <span class="sc">|&gt;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, population, year),</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_household_size =</span> population <span class="sc">/</span> households,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">metro_area =</span> <span class="fu">case_when</span>(</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>      GEOID <span class="sc">==</span> <span class="dv">35620</span> <span class="sc">~</span> <span class="st">"NYC"</span>,                 </span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>      GEOID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">31080</span>, <span class="dv">31100</span>) <span class="sc">~</span> <span class="st">"LA"</span>,      </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other CBSAs"</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hh_pop, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> avg_household_size, <span class="at">group =</span> GEOID)) <span class="sc">+</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> metro_area), <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> metro_area), <span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gghighlight</span>(</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    metro_area <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"NYC"</span>, <span class="st">"LA"</span>),</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">label_key =</span> metro_area,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">unhighlighted_params =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>),</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_group_by =</span> <span class="cn">FALSE</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"NYC"</span> <span class="ot">=</span> <span class="st">"#377eb8"</span>, <span class="st">"LA"</span> <span class="ot">=</span> <span class="st">"#e41a1c"</span>, <span class="st">"Other CBSAs"</span> <span class="ot">=</span> <span class="st">"gray80"</span>)) <span class="sc">+</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Evolution of Household Size by CBSA"</span>,</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"NYC and LA highlighted"</span>,</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average household size"</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Overall, and for out two highlighted CBSAs, it seems that housing size has decreased.</p>
</section>
</section>
<section id="task-5-housing-growth" class="level1">
<h1>Task 5 Housing Growth</h1>
<section id="finding-our-baseline-for-rent-burden" class="level2">
<h2 class="anchored" data-anchor-id="finding-our-baseline-for-rent-burden">Finding our Baseline for Rent Burden</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>RENT_BURDEN <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(RENT, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>,<span class="st">"NAME"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RENT_BURDEN =</span> (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income) <span class="sc">|&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(RENT_BURDEN))</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">|&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">|&gt;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">BASE_2009 =</span> RENT_BURDEN[year <span class="sc">==</span> <span class="dv">2009</span>][<span class="dv">1</span>],</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_IDX =</span> <span class="dv">100</span> <span class="sc">*</span> RENT_BURDEN <span class="sc">/</span> BASE_2009</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the summary (no stray prints)</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>summary_tbl <span class="ot">&lt;-</span> baseline <span class="sc">%&gt;%</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean Rent Burden</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean Index</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(RENT_BURDEN_IDX, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  summary_tbl,</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">formatPercentage</span>(result, <span class="st">"Mean Rent Burden"</span>, <span class="dv">1</span>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">formatRound</span>(result, <span class="st">"Mean Index"</span>, <span class="dv">1</span>)</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-4032f3699dbe785756bc" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4032f3699dbe785756bc">{"x":{"filter":"none","vertical":false,"data":[[0.1966428285939738],[101.7257015423445]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th>Mean Rent Burden<\/th>\n      <th>Mean Index<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"ordering":false,"info":false,"columnDefs":[{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":0,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatPercentage(data, 1, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[0,1]},{"name":"Mean Rent Burden","targets":0},{"name":"Mean Index","targets":1}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="rent-burden-in-atlanta" class="level2">
<h2 class="anchored" data-anchor-id="rent-burden-in-atlanta">Rent Burden in Atlanta</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> baseline <span class="sc">|&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_MINMAX =</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>      <span class="dv">100</span> <span class="sc">*</span> (RENT_BURDEN <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">max</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="dv">12060</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RENT_BURDEN, RENT_BURDEN_IDX, RENT_BURDEN_MINMAX)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  tbl <span class="sc">|&gt;</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CBSA Code</span><span class="st">`</span> <span class="ot">=</span> GEOID,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CBSA Name</span><span class="st">`</span> <span class="ot">=</span> NAME,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">Year =</span> year,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent Burden</span><span class="st">`</span> <span class="ot">=</span> RENT_BURDEN,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent Burden Index (2009=100)</span><span class="st">`</span> <span class="ot">=</span> RENT_BURDEN_IDX,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent Burden Min-Max (0-100)</span><span class="st">`</span> <span class="ot">=</span> RENT_BURDEN_MINMAX</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">"t"</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatPercentage</span>(<span class="st">"Rent Burden"</span>, <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="fu">c</span>(<span class="st">"Rent Burden Index (2009=100)"</span>, <span class="st">"Rent Burden Min-Max (0-100)"</span>), <span class="dv">1</span>)</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-60336688b91526c8e7ce" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-60336688b91526c8e7ce">{"x":{"filter":"none","vertical":false,"data":[[12060,12060,12060,12060,12060,12060,12060,12060,12060,12060,12060,12060,12060,12060],["Atlanta-Sandy Springs-Marietta, GA Metro Area","Atlanta-Sandy Springs-Marietta, GA Metro Area","Atlanta-Sandy Springs-Marietta, GA Metro Area","Atlanta-Sandy Springs-Marietta, GA Metro Area","Atlanta-Sandy Springs-Roswell, GA Metro Area","Atlanta-Sandy Springs-Roswell, GA Metro Area","Atlanta-Sandy Springs-Roswell, GA Metro Area","Atlanta-Sandy Springs-Roswell, GA Metro Area","Atlanta-Sandy Springs-Roswell, GA Metro Area","Atlanta-Sandy Springs-Roswell, GA Metro Area","Atlanta-Sandy Springs-Alpharetta, GA Metro Area","Atlanta-Sandy Springs-Alpharetta, GA Metro Area","Atlanta-Sandy Springs-Alpharetta, GA Metro Area","Atlanta-Sandy Springs-Roswell, GA Metro Area"],[2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2021,2022,2023],[0.1973171787105149,0.2053326313414313,0.2083626208704573,0.2040711722925972,0.2039007410331402,0.2098066445892533,0.2022617446320929,0.2046859278424608,0.2046466098713693,0.2019463319129333,0.2047336288366647,0.2118857054479372,0.2190018379753994,0.2359632391191261],[100,104.0622173311508,105.5978107086901,103.4229120982877,103.3365378349971,106.329639396001,102.5058973343786,103.7344691324401,103.7145428536699,102.3460467216642,103.7586439126167,107.3833037917068,110.9897472721816,119.5857556149781],[33.76869290491317,34.9411769553859,38.73917225147165,30.2004382895966,33.59363053793523,31.56545748036701,36.76617849457435,36.23076636238083,36.47481194700359,29.58653294785839,41.08368892281425,47.95443318214603,44.26653587567015,58.91392927208033]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th>CBSA Code<\/th>\n      <th>CBSA Name<\/th>\n      <th>Year<\/th>\n      <th>Rent Burden<\/th>\n      <th>Rent Burden Index (2009=100)<\/th>\n      <th>Rent Burden Min-Max (0-100)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"ordering":false,"info":false,"columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatPercentage(data, 1, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[0,2,3,4,5]},{"name":"CBSA Code","targets":0},{"name":"CBSA Name","targets":1},{"name":"Year","targets":2},{"name":"Rent Burden","targets":3},{"name":"Rent Burden Index (2009=100)","targets":4},{"name":"Rent Burden Min-Max (0-100)","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
<p>Our <strong>rent burden</strong> for Atlanta has increased significantly, especially from 2022 to 2023.</p>
</section>
<section id="top-5-and-bottom-5" class="level2">
<h2 class="anchored" data-anchor-id="top-5-and-bottom-5">Top 5 and Bottom 5</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute yearly</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>extremes <span class="ot">&lt;-</span> baseline <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_MINMAX =</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>      <span class="dv">100</span> <span class="sc">*</span> (RENT_BURDEN <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>            (<span class="fu">max</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME) <span class="sc">|&gt;</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_rent_burden =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_scaled      =</span> <span class="fu">mean</span>(RENT_BURDEN_MINMAX, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_scaled))</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 5</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>top_5 <span class="ot">&lt;-</span> extremes <span class="sc">|&gt;</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Bottom 5 </span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>bottom_5 <span class="ot">&lt;-</span> extremes <span class="sc">|&gt;</span> <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="top-5" class="level2">
<h2 class="anchored" data-anchor-id="top-5">Top 5</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  top_5,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">5</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'t'</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordering =</span> <span class="cn">FALSE</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CBSA Name"</span> <span class="ot">=</span> <span class="st">"NAME"</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mean Rent Burden"</span> <span class="ot">=</span> <span class="st">"mean_rent_burden"</span>, </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mean Scaled Rent Burden"</span> <span class="ot">=</span> <span class="st">"mean_scaled"</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Top 5 CBSAs"</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-3cd8c2f6296256c8d0b1" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3cd8c2f6296256c8d0b1">{"x":{"filter":"none","vertical":false,"caption":"<caption>Top 5 CBSAs<\/caption>","data":[["1","2","3","4","5"],["Aguadilla, PR Metro Area","San Germán, PR Metro Area","Aguadilla-Isabela-San Sebasti?n, PR Metro Area","Coamo, PR Micro Area","Aguadilla-Isabela, PR Metro Area"],[0.3088774072334429,0.3129453715350934,0.3127028315324989,0.3128803497606878,0.3047715562719051],[98.47489060988821,88.53159882858822,87.38760772035982,85.26161943725737,85.15340911477517]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>CBSA Name<\/th>\n      <th>Mean Rent Burden<\/th>\n      <th>Mean Scaled Rent Burden<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"t","ordering":false,"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME","targets":1},{"name":"mean_rent_burden","targets":2},{"name":"mean_scaled","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="bottom-5" class="level2">
<h2 class="anchored" data-anchor-id="bottom-5">Bottom 5</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  bottom_5,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">5</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'t'</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordering =</span> <span class="cn">FALSE</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CBSA Name"</span> <span class="ot">=</span> <span class="st">"NAME"</span>,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mean Rent Burden"</span> <span class="ot">=</span> <span class="st">"mean_rent_burden"</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mean Scaled Rent Burden"</span> <span class="ot">=</span> <span class="st">"mean_scaled"</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Bottom 5 CBSAs"</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-a35c9f810f2582233d0b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a35c9f810f2582233d0b">{"x":{"filter":"none","vertical":false,"caption":"<caption>Bottom 5 CBSAs<\/caption>","data":[["1","2","3","4","5"],["Wausau-Weston, WI Metro Area","Bismarck, ND Metro Area","Cedar Rapids, IA Metro Area","Jefferson City, MO Metro Area","Laconia, NH Micro Area"],[0.1408623868912235,0.1400966929412084,0.1393469269451927,0.1381285010556133,0.1273799287556811],[6.591415920849118,5.120959737657384,4.705128574429457,4.02792450158048,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>CBSA Name<\/th>\n      <th>Mean Rent Burden<\/th>\n      <th>Mean Scaled Rent Burden<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"t","ordering":false,"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"NAME","targets":1},{"name":"mean_rent_burden","targets":2},{"name":"mean_scaled","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="population-and-housing-growth" class="level2">
<h2 class="anchored" data-anchor-id="population-and-housing-growth">Population and Housing Growth</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>pop_growth_5yr <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(GEOID, year) <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">|&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">POP_5YR_AGO    =</span> <span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">POP_GROWTH_5YR =</span> (population <span class="sc">-</span> POP_5YR_AGO) <span class="sc">/</span> POP_5YR_AGO</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2014</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Instantaneous housing growth</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>instant <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(PERMITS, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span> <span class="ot">=</span> <span class="st">"CBSA"</span>, <span class="st">"year"</span> <span class="ot">=</span> <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">INSTANT_PER_1K =</span> <span class="dv">1000</span> <span class="sc">*</span> new_housing_units_permitted <span class="sc">/</span> population</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>rate_based <span class="ot">&lt;-</span> pop_growth_5yr <span class="sc">|&gt;</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(PERMITS, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span> <span class="ot">=</span> <span class="st">"CBSA"</span>, <span class="st">"year"</span> <span class="ot">=</span> <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">PERMITS_PER_1K  =</span> <span class="dv">1000</span> <span class="sc">*</span> new_housing_units_permitted <span class="sc">/</span> population,</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">RATE_VS_POP_5YR =</span> PERMITS_PER_1K <span class="sc">/</span> POP_GROWTH_5YR</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RATE_VS_POP_5YR)</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>housing_metrics <span class="ot">&lt;-</span> instant <span class="sc">|&gt;</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(rate_based, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"NAME"</span>, <span class="st">"year"</span>))</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>housing_metrics_z <span class="ot">&lt;-</span> housing_metrics <span class="sc">|&gt;</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">INSTANT_Z =</span> (INSTANT_PER_1K  <span class="sc">-</span> <span class="fu">mean</span>(INSTANT_PER_1K,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sd</span>(INSTANT_PER_1K,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">RATE_Z    =</span> (RATE_VS_POP_5YR <span class="sc">-</span> <span class="fu">mean</span>(RATE_VS_POP_5YR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sd</span>(RATE_VS_POP_5YR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">COMPOSITE_Z =</span> <span class="fl">0.5</span> <span class="sc">*</span> INSTANT_Z <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> RATE_Z</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 and bottom 10 instant </span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>top10_instant <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(INSTANT_Z)) <span class="sc">|&gt;</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, INSTANT_Z) <span class="sc">|&gt;</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>bottom10_instant <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(INSTANT_Z) <span class="sc">|&gt;</span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, INSTANT_Z) <span class="sc">|&gt;</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 and bottom 10 rate-based </span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>top10_rate <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(RATE_Z)) <span class="sc">|&gt;</span></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RATE_VS_POP_5YR, RATE_Z) <span class="sc">|&gt;</span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>bottom10_rate <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(RATE_Z) <span class="sc">|&gt;</span></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RATE_VS_POP_5YR, RATE_Z) <span class="sc">|&gt;</span></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="top-10-instantaneous-housing-growth" class="level1">
<h1>Top 10 Instantaneous Housing Growth</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>result_top_instant <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  top10_instant,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"CBSA Code"</span>,<span class="st">"CBSA Name"</span>,<span class="st">"Year"</span>,<span class="st">"Instant per 1k"</span>,<span class="st">"Instant Z"</span>),</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>result_top_instant <span class="ot">&lt;-</span> <span class="fu">formatRound</span>(result_top_instant, <span class="dv">4</span>, <span class="dv">1</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>result_top_instant <span class="ot">&lt;-</span> <span class="fu">formatRound</span>(result_top_instant, <span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>result_top_instant</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-3902db97775b99708798" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3902db97775b99708798">{"x":{"filter":"none","vertical":false,"data":[[41540,45540,34820,45540,39460,39460,34820,45540,34820,45540],["Salisbury, MD Metro Area","The Villages, FL Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC Metro Area","The Villages, FL Metro Area","Punta Gorda, FL Metro Area","Punta Gorda, FL Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC-NC Metro Area","The Villages, FL Metro Area","Myrtle Beach-Conway-North Myrtle Beach, SC-NC Metro Area","The Villages, FL Metro Area"],[2023,2021,2023,2022,2022,2021,2021,2014,2022,2019],[37.73032148639273,33.99489818487444,33.14900447320355,30.62012830240739,28.007362047952,24.78918924467392,23.96850492551894,22.47485789243551,22.38116997566048,22.11146352514726],[9.558640176530274,8.492003104561993,8.250461110794834,7.528349356260349,6.782283081453663,5.863345081955377,5.629001542138096,5.202495850728326,5.175743593444096,5.098729858869637]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th>CBSA Code<\/th>\n      <th>CBSA Name<\/th>\n      <th>Year<\/th>\n      <th>Instant per 1k<\/th>\n      <th>Instant Z<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"ordering":false,"info":false,"columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[0,2,3,4]},{"name":"GEOID","targets":0},{"name":"NAME","targets":1},{"name":"year","targets":2},{"name":"INSTANT_PER_1K","targets":3},{"name":"INSTANT_Z","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>
</div>
</div>
<section id="bottom-10-instantaneous-housing-growth" class="level2">
<h2 class="anchored" data-anchor-id="bottom-10-instantaneous-housing-growth">Bottom 10 Instantaneous Housing Growth</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a> result_bottom_instant <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  bottom10_instant <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">`</span><span class="at">CBSA Code</span><span class="st">`</span> <span class="ot">=</span> GEOID, <span class="st">`</span><span class="at">CBSA Name</span><span class="st">`</span> <span class="ot">=</span> NAME, <span class="at">Year =</span> year,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Instant per 1k</span><span class="st">`</span> <span class="ot">=</span> INSTANT_PER_1K, <span class="st">`</span><span class="at">Instant Z</span><span class="st">`</span> <span class="ot">=</span> INSTANT_Z),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>, <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">formatRound</span>(<span class="dv">4</span>, <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">formatRound</span>(<span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>result_bottom_instant</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-84872cafed425323cb39" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-84872cafed425323cb39">{"x":{"filter":"none","vertical":false,"data":[[19180,21820,19180,34060,48540,19180,48540,21820,19180,34060],["Danville, IL Metro Area","Fairbanks, AK Metro Area","Danville, IL Metro Area","Morgantown, WV Metro Area","Wheeling, WV-OH Metro Area","Danville, IL Metro Area","Wheeling, WV-OH Metro Area","Fairbanks, AK Metro Area","Danville, IL Micro Area","Morgantown, WV Metro Area"],[2022,2015,2014,2022,2023,2021,2019,2016,2023,2023],[0.02764836805507555,0.07025925665706456,0.07525586995785671,0.07799150601598116,0.08117062803928658,0.08208495793145906,0.08636324380343725,0.1093385020625217,0.1116507564338748,0.1198727938117433],[-1.207226397138975,-1.195059006783532,-1.19363224131394,-1.19285108999601,-1.191943302810287,-1.191682219104298,-1.190460569522127,-1.183900064803097,-1.183239808646505,-1.180892034601518]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th>CBSA Code<\/th>\n      <th>CBSA Name<\/th>\n      <th>Year<\/th>\n      <th>Instant per 1k<\/th>\n      <th>Instant Z<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"ordering":false,"info":false,"columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[0,2,3,4]},{"name":"CBSA Code","targets":0},{"name":"CBSA Name","targets":1},{"name":"Year","targets":2},{"name":"Instant per 1k","targets":3},{"name":"Instant Z","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="top-10-housing-growth-rate" class="level2">
<h2 class="anchored" data-anchor-id="top-10-housing-growth-rate">Top 10 Housing Growth Rate</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>result_top_rate <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  top10_rate <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">`</span><span class="at">CBSA Code</span><span class="st">`</span> <span class="ot">=</span> GEOID, <span class="st">`</span><span class="at">CBSA Name</span><span class="st">`</span> <span class="ot">=</span> NAME, <span class="at">Year =</span> year,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Rate of Growth</span><span class="st">`</span> <span class="ot">=</span> RATE_VS_POP_5YR, <span class="st">`</span><span class="at">Rate Z</span><span class="st">`</span> <span class="ot">=</span> RATE_Z),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>, <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>),</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">formatRound</span>(<span class="dv">4</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">formatRound</span>(<span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>result_top_rate</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-b9e539d8e82782fc3e4f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b9e539d8e82782fc3e4f">{"x":{"filter":"none","vertical":false,"data":[[33660,35100,48140,22520,38300,17860,10580,33780,30340,22540],["Mobile, AL Metro Area","New Bern, NC Metro Area","Wausau, WI Metro Area","Florence-Muscle Shoals, AL Metro Area","Pittsburgh, PA Metro Area","Columbia, MO Metro Area","Albany-Schenectady-Troy, NY Metro Area","Monroe, MI Metro Area","Lewiston-Auburn, ME Metro Area","Fond du Lac, WI Metro Area"],[2017,2019,2018,2017,2021,2017,2019,2018,2017,2016],[52523.90489940109,30662.35092986406,25664.39239546721,15494.72925366232,10592.10127471856,9602.598885305815,8736.193676639596,7806.253380978021,5997.659102098448,5611.811228793137],[35.84145836364713,20.89579757085526,17.47894106488033,10.52644647523827,7.174762744582785,6.498289009621978,5.905970715328848,5.270216631430078,4.033770373237091,3.76998530836581]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th>CBSA Code<\/th>\n      <th>CBSA Name<\/th>\n      <th>Year<\/th>\n      <th>Rate of Growth<\/th>\n      <th>Rate Z<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"ordering":false,"info":false,"columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[0,2,3,4]},{"name":"CBSA Code","targets":0},{"name":"CBSA Name","targets":1},{"name":"Year","targets":2},{"name":"Rate of Growth","targets":3},{"name":"Rate Z","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="bottom-10-housing-growth-rate" class="level2">
<h2 class="anchored" data-anchor-id="bottom-10-housing-growth-rate">Bottom 10 Housing Growth Rate</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>result_bottom_rate <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  bottom10_rate <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">`</span><span class="at">CBSA Code</span><span class="st">`</span> <span class="ot">=</span> GEOID, <span class="st">`</span><span class="at">CBSA Name</span><span class="st">`</span> <span class="ot">=</span> NAME, <span class="at">Year =</span> year,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Rate of Growth</span><span class="st">`</span> <span class="ot">=</span> RATE_VS_POP_5YR, <span class="st">`</span><span class="at">Rate Z</span><span class="st">`</span> <span class="ot">=</span> RATE_Z),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>, <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">formatRound</span>(<span class="dv">4</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">formatRound</span>(<span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>result_bottom_rate</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-af3dac298ede5bd39f90" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-af3dac298ede5bd39f90">{"x":{"filter":"none","vertical":false,"data":[[40220,21780,37100,37620,43420,35380,44940,43420,29100,22500],["Roanoke, VA Metro Area","Evansville, IN-KY Metro Area","Oxnard-Thousand Oaks-Ventura, CA Metro Area","Parkersburg-Vienna, WV Metro Area","Sierra Vista-Douglas, AZ Metro Area","New Orleans-Metairie, LA Metro Area","Sumter, SC Metro Area","Sierra Vista-Douglas, AZ Metro Area","La Crosse-Onalaska, WI-MN Metro Area","Florence, SC Metro Area"],[2019,2019,2019,2018,2022,2021,2016,2023,2019,2017],[-17124.19549373565,-12239.79368038868,-6664.145297996402,-6251.351365960712,-4948.134905545101,-4549.79734437652,-4268.166994115237,-4193.554402195565,-4071.629177616995,-3993.24163011767],[-11.77349548586555,-8.434272081175099,-4.622477661655229,-4.340270912120175,-3.449326417319145,-3.177002771957549,-2.984466061629201,-2.933457131008061,-2.850102898679677,-2.796513218049642]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th>CBSA Code<\/th>\n      <th>CBSA Name<\/th>\n      <th>Year<\/th>\n      <th>Rate of Growth<\/th>\n      <th>Rate Z<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"ordering":false,"info":false,"columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[0,2,3,4]},{"name":"CBSA Code","targets":0},{"name":"CBSA Name","targets":1},{"name":"Year","targets":2},{"name":"Rate of Growth","targets":3},{"name":"Rate Z","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="top-and-bottom-composite-z-score" class="level2">
<h2 class="anchored" data-anchor-id="top-and-bottom-composite-z-score">Top and Bottom Composite Z-score</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>top10_composite <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(COMPOSITE_Z)) <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, INSTANT_PER_1K, RATE_VS_POP_5YR, COMPOSITE_Z) <span class="sc">|&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>bottom10_composite <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(COMPOSITE_Z) <span class="sc">|&gt;</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, RATE_VS_POP_5YR, COMPOSITE_Z) <span class="sc">|&gt;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="top-10-by-composite-z-score" class="level2">
<h2 class="anchored" data-anchor-id="top-10-by-composite-z-score">Top 10 by Composite Z Score</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>dt_top_composite <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  top10_composite,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"CBSA Code"</span>,<span class="st">"CBSA Name"</span>,<span class="st">"Instantaneous"</span>,<span class="st">"Rate"</span>,<span class="st">"Composite Z"</span>),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="dv">3</span>, <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="dv">4</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>dt_top_composite</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-53ab41bdde85b6cdef86" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-53ab41bdde85b6cdef86">{"x":{"filter":"none","vertical":false,"data":[[33660,35100,48140,22520,45540,17860,45540,39460,38300,39460],["Mobile, AL Metro Area","New Bern, NC Metro Area","Wausau, WI Metro Area","Florence-Muscle Shoals, AL Metro Area","The Villages, FL Metro Area","Columbia, MO Metro Area","The Villages, FL Metro Area","Punta Gorda, FL Metro Area","Pittsburgh, PA Metro Area","Punta Gorda, FL Metro Area"],[2.410890072592431,4.315736802601951,2.274271199456538,5.270746337681416,33.99489818487444,9.165820576537968,30.62012830240739,28.007362047952,2.219212096851634,24.78918924467392],[52523.90489940109,30662.35092986406,25664.39239546721,15494.72925366232,241.3379972590857,9602.598885305815,181.0228582523747,206.5768667501965,10592.10127471856,197.5046251883158],[17.65737915402875,10.45650992168883,8.456614983710409,5.408184191822641,4.295231036857515,3.950217878662403,3.792786927318931,3.428488794376771,3.29666485637703,2.965918673700839]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th>CBSA Code<\/th>\n      <th>CBSA Name<\/th>\n      <th>Instantaneous<\/th>\n      <th>Rate<\/th>\n      <th>Composite Z<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"ordering":false,"info":false,"columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[0,2,3,4]},{"name":"GEOID","targets":0},{"name":"NAME","targets":1},{"name":"INSTANT_PER_1K","targets":2},{"name":"RATE_VS_POP_5YR","targets":3},{"name":"COMPOSITE_Z","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="bottom-10-by-composite-z-score" class="level2">
<h2 class="anchored" data-anchor-id="bottom-10-by-composite-z-score">Bottom 10 by Composite z-score</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dt_bottom_composite <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  bottom10_composite,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"CBSA Code"</span>,<span class="st">"CBSA Name"</span>,<span class="st">"Year"</span>,<span class="st">"Instantaneous"</span>,<span class="st">"Rate"</span>,<span class="st">"Composite Z"</span>),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="dv">4</span>, <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="dv">5</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="dv">6</span>, <span class="dv">2</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>dt_bottom_composite</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-2ed5ef56769b33081751" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2ed5ef56769b33081751">{"x":{"filter":"none","vertical":false,"data":[[40220,21780,37100,37620,44940,43420,24140,35380,43420,29100],["Roanoke, VA Metro Area","Evansville, IN-KY Metro Area","Oxnard-Thousand Oaks-Ventura, CA Metro Area","Parkersburg-Vienna, WV Metro Area","Sumter, SC Metro Area","Sierra Vista-Douglas, AZ Metro Area","Goldsboro, NC Metro Area","New Orleans-Metairie, LA Metro Area","Sierra Vista-Douglas, AZ Metro Area","La Crosse-Onalaska, WI-MN Metro Area"],[2019,2019,2019,2018,2016,2022,2017,2021,2023,2019],[2.244274223455543,2.951575125521286,1.354600321983532,1.351365960713089,2.541994115237066,4.209671900241121,2.254936700705473,4.186328885986339,3.899229781771502,3.960004684663583],[-17124.19549373565,-12239.79368038868,-6664.145297996402,-6251.351365960712,-4268.166994115237,-4948.134905545101,-3786.038720484489,-4549.79734437652,-4193.554402195565,-4071.629177616995],[-6.173886057505507,-4.403290704542522,-2.725398782397552,-2.584757187909892,-1.736864907963296,-1.731195303534561,-1.613045427802103,-1.598366238933083,-1.517583491492359,-1.467229344743225]],"container":"<table class=\"compact\">\n  <thead>\n    <tr>\n      <th>CBSA Code<\/th>\n      <th>CBSA Name<\/th>\n      <th>Year<\/th>\n      <th>Instantaneous<\/th>\n      <th>Rate<\/th>\n      <th>Composite Z<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","paging":false,"ordering":false,"info":false,"columnDefs":[{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[0,2,3,4,5]},{"name":"GEOID","targets":0},{"name":"NAME","targets":1},{"name":"year","targets":2},{"name":"INSTANT_PER_1K","targets":3},{"name":"RATE_VS_POP_5YR","targets":4},{"name":"COMPOSITE_Z","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="task-6-visualization-of-yimbys" class="level1">
<h1>Task 6 Visualization of Yimbys</h1>
<section id="defining-a-yimby" class="level2">
<h2 class="anchored" data-anchor-id="defining-a-yimby">Defining a YIMBY</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> <span class="dv">2014</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">max</span>(RENT_BURDEN<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>N  <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>rb_2014 <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">%&gt;%</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> y0) <span class="sc">%&gt;%</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">rb_2014 =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>rb_latest <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">%&gt;%</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> y1) <span class="sc">%&gt;%</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">rb_latest =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>rb_change <span class="ot">&lt;-</span> rb_2014 <span class="sc">%&gt;%</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(rb_latest, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delta_rb =</span> rb_latest <span class="sc">-</span> rb_2014) <span class="sc">%&gt;%</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(delta_rb))</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>growth_z <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">%&gt;%</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> y0 <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> y1) <span class="sc">%&gt;%</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_comp_z =</span> <span class="fu">mean</span>(COMPOSITE_Z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>pop_flags <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(y0, y1)) <span class="sc">%&gt;%</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_2014   =</span> population[year <span class="sc">==</span> y0][<span class="dv">1</span>],</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_latest =</span> population[year <span class="sc">==</span> y1][<span class="dv">1</span>],</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">growing_population =</span> pop_latest <span class="sc">&gt;</span> pop_2014,</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, growing_population)</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a><span class="co"># High initial burden cutoff (2014 median)</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>rb_med <span class="ot">&lt;-</span> <span class="fu">median</span>(rb_2014<span class="sc">$</span>rb_2014, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a><span class="co"># YIMBYs = high initial 2014 burden, rent decrease, pop growth, above-avg housing growth</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>topN <span class="ot">&lt;-</span> rb_change <span class="sc">%&gt;%</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(growth_z, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pop_flags, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">high_initial_burden      =</span> rb_2014 <span class="sc">&gt;</span> rb_med,</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">decreasing_burden        =</span> delta_rb <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">above_avg_housing_growth =</span> avg_comp_z <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb33-53"><a href="#cb33-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(high_initial_burden,</span>
<span id="cb33-54"><a href="#cb33-54" aria-hidden="true" tabindex="-1"></a>         decreasing_burden,</span>
<span id="cb33-55"><a href="#cb33-55" aria-hidden="true" tabindex="-1"></a>         growing_population,</span>
<span id="cb33-56"><a href="#cb33-56" aria-hidden="true" tabindex="-1"></a>         above_avg_housing_growth) <span class="sc">%&gt;%</span></span>
<span id="cb33-57"><a href="#cb33-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_comp_z), delta_rb, NAME, GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb33-58"><a href="#cb33-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> N) <span class="sc">%&gt;%</span></span>
<span id="cb33-59"><a href="#cb33-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, rb_2014, rb_latest, delta_rb, avg_comp_z)</span>
<span id="cb33-60"><a href="#cb33-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-61"><a href="#cb33-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-62"><a href="#cb33-62" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb33-63"><a href="#cb33-63" aria-hidden="true" tabindex="-1"></a>  topN <span class="sc">%&gt;%</span></span>
<span id="cb33-64"><a href="#cb33-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb33-65"><a href="#cb33-65" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CBSA Code</span><span class="st">`</span> <span class="ot">=</span> GEOID,</span>
<span id="cb33-66"><a href="#cb33-66" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CBSA Name</span><span class="st">`</span> <span class="ot">=</span> NAME,</span>
<span id="cb33-67"><a href="#cb33-67" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent Burden 2014</span><span class="st">`</span> <span class="ot">=</span> rb_2014,</span>
<span id="cb33-68"><a href="#cb33-68" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent Burden Latest</span><span class="st">`</span> <span class="ot">=</span> rb_latest,</span>
<span id="cb33-69"><a href="#cb33-69" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Δ Rent Burden</span><span class="st">`</span> <span class="ot">=</span> delta_rb,</span>
<span id="cb33-70"><a href="#cb33-70" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Avg Composite Z (≥2014)</span><span class="st">`</span> <span class="ot">=</span> avg_comp_z</span>
<span id="cb33-71"><a href="#cb33-71" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb33-72"><a href="#cb33-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-73"><a href="#cb33-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">25</span>)</span>
<span id="cb33-74"><a href="#cb33-74" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-75"><a href="#cb33-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-76"><a href="#cb33-76" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-4047989eb54b5117a4e7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4047989eb54b5117a4e7">{"x":{"filter":"none","vertical":false,"data":[[19300,25220,26140,15500,25980,12220,46660,33540,20100,47580],["Daphne-Fairhope-Foley, AL Metro Area","Hammond, LA Metro Area","Homosassa Springs, FL Metro Area","Burlington, NC Metro Area","Hinesville, GA Metro Area","Auburn-Opelika, AL Metro Area","Valdosta, GA Metro Area","Missoula, MT Metro Area","Dover, DE Metro Area","Warner Robins, GA Metro Area"],[0.2122118817193207,0.2203052422030524,0.2560062796108884,0.233474833232262,0.2769379889686368,0.2247821296203546,0.2374243258117777,0.2018559913296755,0.22271714922049,0.2075556410749791],[0.211643694713022,0.2176525718066046,0.2539375569481377,0.1888684046135328,0.2357241651847461,0.2013199027440083,0.2191391741315272,0.1908242867274017,0.2172541489507612,0.1826638477801268],[-0.0005681870062986538,-0.00265267039644787,-0.00206872266275071,-0.04460642861872915,-0.04121382378389066,-0.02346222687634625,-0.01828515168025047,-0.01103170460227387,-0.00546300026972879,-0.0248917932948523],[1.524715100606506,0.7866934505022549,0.7467496957276655,0.7164511499274558,0.6998478728196902,0.5687157743807557,0.530009232671296,0.4719869379846777,0.4342955088830319,0.3717406513139324]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>CBSA Code<\/th>\n      <th>CBSA Name<\/th>\n      <th>Rent Burden 2014<\/th>\n      <th>Rent Burden Latest<\/th>\n      <th>Δ Rent Burden<\/th>\n      <th>Avg Composite Z (≥2014)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":25,"columnDefs":[{"className":"dt-right","targets":[0,2,3,4,5]},{"name":"CBSA Code","targets":0},{"name":"CBSA Name","targets":1},{"name":"Rent Burden 2014","targets":2},{"name":"Rent Burden Latest","targets":3},{"name":"Δ Rent Burden","targets":4},{"name":"Avg Composite Z (≥2014)","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The table provides a list of locations performing well in terms of housing growth and decreasing rent burden.YIMBYs are defined by CBSAs with population growth, rent decrease, housing growth, and high initial rent burden.</p>
</section>
<section id="bubble-plot-of-possible-yimbys" class="level2">
<h2 class="anchored" data-anchor-id="bubble-plot-of-possible-yimbys">Bubble plot of possible YIMBYS</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>baseline_us <span class="ot">&lt;-</span> baseline <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">substr</span>(GEOID, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">!=</span> <span class="st">"72"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> <span class="dv">2014</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">max</span>(baseline_us<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>rb_change <span class="ot">&lt;-</span> baseline_us <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(y0, y1)) <span class="sc">%&gt;%</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RENT_BURDEN) <span class="sc">%&gt;%</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> RENT_BURDEN, <span class="at">names_prefix =</span> <span class="st">"rb_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    GEOID, NAME,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">initial_rent_burden =</span> rb_2014,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">latest_rent_burden  =</span> .data[[<span class="fu">paste0</span>(<span class="st">"rb_"</span>, y1)]],</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_change  =</span> latest_rent_burden <span class="sc">-</span> initial_rent_burden</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(initial_rent_burden), <span class="sc">!</span><span class="fu">is.na</span>(latest_rent_burden))</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>avg_z <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">%&gt;%</span></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> y0 <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> y1) <span class="sc">%&gt;%</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_comp_z =</span> <span class="fu">mean</span>(COMPOSITE_Z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>cbsa_metrics <span class="ot">&lt;-</span> rb_change <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(avg_z, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>))</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>rb2014_tbl <span class="ot">&lt;-</span> baseline_us <span class="sc">%&gt;%</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> y0) <span class="sc">%&gt;%</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, <span class="at">rb2014 =</span> RENT_BURDEN)</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>rb2014_med <span class="ot">&lt;-</span> <span class="fu">median</span>(rb2014_tbl<span class="sc">$</span>rb2014, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>pop_flags <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(y0, y1)) <span class="sc">%&gt;%</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> population, <span class="at">names_prefix =</span> <span class="st">"pop_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(GEOID, <span class="at">growing_population =</span> .data[[<span class="fu">paste0</span>(<span class="st">"pop_"</span>, y1)]] <span class="sc">&gt;</span> pop_2014)</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>cbsa_metrics <span class="ot">&lt;-</span> cbsa_metrics <span class="sc">%&gt;%</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, avg_comp_z, rent_burden_change) <span class="sc">%&gt;%</span></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(rb2014_tbl, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pop_flags, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">cbsa_type =</span> <span class="fu">ifelse</span>(rb2014 <span class="sc">&gt;</span> rb2014_med <span class="sc">&amp;</span></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>                         rent_burden_change <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>                         growing_population <span class="sc">&amp;</span></span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>                         avg_comp_z <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"YIMBY"</span>, <span class="st">"Other"</span>),</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha_val =</span> <span class="fu">ifelse</span>(cbsa_type <span class="sc">==</span> <span class="st">"YIMBY"</span>, <span class="dv">1</span>, <span class="fl">0.6</span>)</span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>housing_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(cbsa_metrics<span class="sc">$</span>avg_comp_z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>rent_change_zero <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cbsa_metrics, <span class="fu">aes</span>(<span class="at">x =</span> avg_comp_z, <span class="at">y =</span> rent_burden_change)) <span class="sc">+</span></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>,</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> housing_mean, <span class="at">xmax =</span> <span class="cn">Inf</span>,</span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> rent_change_zero,</span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"green"</span>, <span class="at">alpha =</span> <span class="fl">0.08</span>) <span class="sc">+</span></span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> rent_change_zero, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> housing_mean, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> cbsa_type,</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">size  =</span> avg_comp_z,</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> alpha_val</span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"YIMBY"</span> <span class="ot">=</span> <span class="st">"#8073ac"</span>, <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"gray70"</span>)) <span class="sc">+</span></span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_identity</span>() <span class="sc">+</span></span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rent Burden Change vs Housing Growth"</span>,</span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Housing Growth"</span>,</span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Change in Rent Burden"</span>,</span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"CBSA Type"</span>,</span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">size  =</span> <span class="st">"Avg Composite Z"</span></span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see from the plot that the YIMBYs lie in the lower right quadrant. Meaning the values in this area have positive housing growth and a decreasing rent burden.</p>
</section>
<section id="time-plot-for-possible-yimbys" class="level2">
<h2 class="anchored" data-anchor-id="time-plot-for-possible-yimbys">Time Plot for possible YIMBYs</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gghighlight)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> <span class="dv">2014</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">max</span>(RENT_BURDEN<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>rb_2014_tbl <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">%&gt;%</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> y0) <span class="sc">%&gt;%</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">rb2014 =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>rb_latest_tbl <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">%&gt;%</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> y1) <span class="sc">%&gt;%</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">rb_latest =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>rb_change <span class="ot">&lt;-</span> rb_2014_tbl <span class="sc">%&gt;%</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(rb_latest_tbl, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delta_rb =</span> rb_latest <span class="sc">-</span> rb2014) <span class="sc">%&gt;%</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(delta_rb))</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>growth_z <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">%&gt;%</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> y0 <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> y1) <span class="sc">%&gt;%</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_comp_z =</span> <span class="fu">mean</span>(COMPOSITE_Z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>pop_flags <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(y0, y1)) <span class="sc">%&gt;%</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> population, <span class="at">names_prefix =</span> <span class="st">"pop_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(GEOID, <span class="at">growing_population =</span> .data[[<span class="fu">paste0</span>(<span class="st">"pop_"</span>, y1)]] <span class="sc">&gt;</span> pop_2014)</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>rb2014_cutoff <span class="ot">&lt;-</span> <span class="fu">median</span>(rb_2014_tbl<span class="sc">$</span>rb2014, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>pool <span class="ot">&lt;-</span> rb_change <span class="sc">%&gt;%</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(growth_z, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pop_flags, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">high_initial_burden      =</span> rb2014 <span class="sc">&gt;</span> rb2014_cutoff,</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">decreasing_burden        =</span> delta_rb <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">above_avg_housing_growth =</span> avg_comp_z <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(high_initial_burden, decreasing_burden, growing_population, above_avg_housing_growth)</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>topN <span class="ot">&lt;-</span> pool <span class="sc">%&gt;%</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_comp_z), delta_rb, NAME, GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>top5 <span class="ot">&lt;-</span> topN <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>name_map <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">%&gt;%</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(year, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME)</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">%&gt;%</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GEOID <span class="sc">%in%</span> pool<span class="sc">$</span>GEOID, <span class="sc">!</span><span class="fu">is.na</span>(RENT_BURDEN)) <span class="sc">%&gt;%</span></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, year, RENT_BURDEN) <span class="sc">%&gt;%</span></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(name_map, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlight_flag =</span> GEOID <span class="sc">%in%</span> top5<span class="sc">$</span>GEOID,</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">color_group =</span> <span class="fu">ifelse</span>(NAME <span class="sc">%in%</span> top5<span class="sc">$</span>NAME, NAME, <span class="st">"Other"</span>)</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>palette_pp <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"#7B2CBF"</span>,<span class="st">"#9D4EDD"</span>,<span class="st">"#C77DFF"</span>,<span class="st">"#F72585"</span>,<span class="st">"#FF4D6D"</span>,<span class="st">"grey75"</span>),</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(top5<span class="sc">$</span>NAME, <span class="st">"Other"</span>))</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(year, RENT_BURDEN, <span class="at">color =</span> color_group, <span class="at">group =</span> GEOID)) <span class="sc">+</span></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gghighlight</span>(highlight_flag, <span class="at">use_direct_label =</span> <span class="cn">FALSE</span>,</span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>              <span class="at">use_group_by =</span> <span class="cn">FALSE</span>,</span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>              <span class="at">unhighlighted_params =</span> <span class="fu">list</span>(<span class="at">colour =</span> <span class="st">"grey75"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)) <span class="sc">+</span></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> palette_pp, <span class="at">name =</span> <span class="st">"CBSA"</span>) <span class="sc">+</span></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"YIMBY Top 5"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Rent Burden"</span>) <span class="sc">+</span></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box =</span> <span class="st">"horizontal"</span>,</span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.width  =</span> <span class="fu">unit</span>(<span class="dv">10</span>, <span class="st">"pt"</span>),</span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="dv">10</span>, <span class="st">"pt"</span>),</span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">4</span>, <span class="at">r =</span> <span class="dv">8</span>, <span class="at">b =</span> <span class="dv">4</span>, <span class="at">l =</span> <span class="dv">8</span>),</span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">6</span>, <span class="at">b =</span> <span class="dv">12</span>),</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">10</span>, <span class="at">b =</span> <span class="dv">30</span>, <span class="at">l =</span> <span class="dv">10</span>)  <span class="co"># extra bottom room</span></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plot shows the decrease in rent for our top 5 YIMBYs since 2014. Our top 5 YIMBY candidates do behave like YIMBYS as we defined earlier in terms of rent decrease over our period of time since 2014.</p>
</section>
</section>
<section id="task-7-policy-brief" class="level1">
<h1>Task 7 Policy Brief</h1>
<section id="introduction-1" class="level3">
<h3 class="anchored" data-anchor-id="introduction-1"><strong>Introduction</strong></h3>
<p>Across the country, especially in highly populated areas like NYC, rental costs are sky high. The rental market today is extremely competitive, driving prices higher. This limits families across the nation from affordable, high quality homes. While rental prices have climbed in NIMBY cities like NYC, increases in individual income have not been sufficient to cover these costs. Students, or recent graduates, are particularly burdened when it comes to high rental costs. Our study looked at cities starting in 2014 and determined which cities are considered YIMBYs and which cities are considered NIMBYs.</p>
</section>
<section id="sponsors" class="level3">
<h3 class="anchored" data-anchor-id="sponsors"><strong>Sponsors</strong></h3>
<p>We will have one representative from our YIMBY city Burlington, North Carolina, and one representative from NYC as sponsors for this bill.</p>
</section>
<section id="potential-benefits-from-our-policy" class="level3">
<h3 class="anchored" data-anchor-id="potential-benefits-from-our-policy"><strong>Potential Benefits from our Policy</strong></h3>
<p>NYC is a major hub for the arts, education, and city jobs. Modeling NYC’s policies to rival one of a NIMBY city may be difficult purely because of the geography of Manhattan, however these policies would benefit local artists, students, and city workers such as MTA employees. Giving these groups access to more affordable, nice housing would allow them to flourish and, in turn, give them a suitable foundation to boost the economy. MTA workers would especially benefit and, since NYC relies on MTA workers to keep the city functioning, this benefit would lead to the running optimally. The residents of Burlington, North Carolina also have countless city jobs and many residents rely on these city jobs for income. Burlington, North Carolina is located near several universities - conveniently located approximately 30 minutes from Duke - so students and recent graduates would also benefit from more available housing and a lower rent cost. NYC is home to many colleges and universities, so students in NYC would benefit from these policies as well.</p>
</section>
<section id="metrics" class="level3">
<h3 class="anchored" data-anchor-id="metrics"><strong>Metrics</strong></h3>
<p>For this policy we have identified what makes a city worthy of YIMBY status: decreasing rent burden, positive housing growth rate, high population growth, and high initial rent. Our policy is based on these factors. A NIMBY city would be one that has little housing growth and high rent cost.</p>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion"><strong>Conclusion</strong></h3>
<p>While Burlington, NC is considered a WIMBY city, NYC has a long way to go in terms of affordable housing and housing growth. Considering that the population of NYC is growing, the city needs to act soon in order to keep up with housing demand.</p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/<madisonbrinson>\.github\.io\/STA9750-2025-FALL\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Mini Project 2</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: right</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3 </span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true  </span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true </span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="al">![](housing.png)</span>{width = 30%}</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>We are examining the relationship between housing growth and rent burden. Throughout this analysis we will look at the effect of income on  rent cost, income by state and industry, the effects of COVID 19 on employment in the healthcare industry, and population growth. In this analysis we will conduct a search for YIMBYs, or Yes In My Backyard cities. These cities allow for housing growth, account for population growth, and have lowered rent cost over our study period.</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Acquisition</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>))){</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>), <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>library <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Mask base::library() to automatically install packages if needed</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Masking is important here so downlit picks up packages and links</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>  <span class="do">## to documentation</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>, <span class="at">quietly=</span><span class="cn">TRUE</span>))</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>get_acs_all_years <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, <span class="at">geography=</span><span class="st">"cbsa"</span>,</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>                              <span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"{variable}_{geography}_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>    YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop 2020 - No survey (covid)</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>      tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(geography, variable, <span class="at">year=</span>yy, <span class="at">survey=</span><span class="st">"acs1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year=</span>yy) <span class="sc">|&gt;</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span>moe, <span class="sc">-</span>variable) <span class="sc">|&gt;</span></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="sc">!!</span><span class="at">variable :=</span> estimate)</span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income (12 month)</span></span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>INCOME <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B19013_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">household_income =</span> B19013_001)</span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly rent</span></span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a>RENT <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B25064_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">monthly_rent =</span> B25064_001)</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Total population</span></span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a>POPULATION <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B01003_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">population =</span> B01003_001)</span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Total number of households</span></span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a>HOUSEHOLDS <span class="ot">&lt;-</span> <span class="fu">get_acs_all_years</span>(<span class="st">"B11001_001"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">households =</span> B11001_001)</span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb36-96"><a href="#cb36-96" aria-hidden="true" tabindex="-1"></a>      historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true" tabindex="-1"></a>      LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true" tabindex="-1"></a>      CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb36-101"><a href="#cb36-101" aria-hidden="true" tabindex="-1"></a>      CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb36-102"><a href="#cb36-102" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-103"><a href="#cb36-103" aria-hidden="true" tabindex="-1"></a>      PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb36-104"><a href="#cb36-104" aria-hidden="true" tabindex="-1"></a>      PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb36-105"><a href="#cb36-105" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-106"><a href="#cb36-106" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb36-107"><a href="#cb36-107" aria-hidden="true" tabindex="-1"></a>                 <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb36-108"><a href="#cb36-108" aria-hidden="true" tabindex="-1"></a>                 <span class="at">year =</span> yy)</span>
<span id="cb36-109"><a href="#cb36-109" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb36-110"><a href="#cb36-110" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-111"><a href="#cb36-111" aria-hidden="true" tabindex="-1"></a>    CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb36-112"><a href="#cb36-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-113"><a href="#cb36-113" aria-hidden="true" tabindex="-1"></a>    CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb36-114"><a href="#cb36-114" aria-hidden="true" tabindex="-1"></a>      current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb36-115"><a href="#cb36-115" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-116"><a href="#cb36-116" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb36-117"><a href="#cb36-117" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-118"><a href="#cb36-118" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb36-119"><a href="#cb36-119" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-120"><a href="#cb36-120" aria-hidden="true" tabindex="-1"></a>      fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb36-121"><a href="#cb36-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(...){</span>
<span id="cb36-122"><a href="#cb36-122" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb36-123"><a href="#cb36-123" aria-hidden="true" tabindex="-1"></a>                   <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb36-124"><a href="#cb36-124" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-125"><a href="#cb36-125" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-126"><a href="#cb36-126" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-127"><a href="#cb36-127" aria-hidden="true" tabindex="-1"></a>      reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb36-128"><a href="#cb36-128" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-129"><a href="#cb36-129" aria-hidden="true" tabindex="-1"></a>      <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-130"><a href="#cb36-130" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb36-131"><a href="#cb36-131" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb36-132"><a href="#cb36-132" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb36-133"><a href="#cb36-133" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb36-134"><a href="#cb36-134" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb36-135"><a href="#cb36-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-136"><a href="#cb36-136" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb36-137"><a href="#cb36-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-138"><a href="#cb36-138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb36-139"><a href="#cb36-139" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-140"><a href="#cb36-140" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-141"><a href="#cb36-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-142"><a href="#cb36-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb36-143"><a href="#cb36-143" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-144"><a href="#cb36-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-145"><a href="#cb36-145" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span>
<span id="cb36-146"><a href="#cb36-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-147"><a href="#cb36-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-150"><a href="#cb36-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-151"><a href="#cb36-151" aria-hidden="true" tabindex="-1"></a>get_building_permits <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year =</span> <span class="dv">2009</span>, <span class="at">end_year =</span> <span class="dv">2023</span>){</span>
<span id="cb36-152"><a href="#cb36-152" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"housing_units_{start_year}_{end_year}.csv"</span>)</span>
<span id="cb36-153"><a href="#cb36-153" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb36-154"><a href="#cb36-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-155"><a href="#cb36-155" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb36-156"><a href="#cb36-156" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, <span class="dv">2018</span>)</span>
<span id="cb36-157"><a href="#cb36-157" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-158"><a href="#cb36-158" aria-hidden="true" tabindex="-1"></a>    HISTORICAL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(HISTORICAL_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb36-159"><a href="#cb36-159" aria-hidden="true" tabindex="-1"></a>      historical_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/txt/tb3u{yy}.txt"</span>)</span>
<span id="cb36-160"><a href="#cb36-160" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-161"><a href="#cb36-161" aria-hidden="true" tabindex="-1"></a>      LINES <span class="ot">&lt;-</span> <span class="fu">readLines</span>(historical_url)[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb36-162"><a href="#cb36-162" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-163"><a href="#cb36-163" aria-hidden="true" tabindex="-1"></a>      CBSA_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(LINES, <span class="st">"^[[:digit:]]"</span>)</span>
<span id="cb36-164"><a href="#cb36-164" aria-hidden="true" tabindex="-1"></a>      CBSA <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[CBSA_LINES], <span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb36-165"><a href="#cb36-165" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-166"><a href="#cb36-166" aria-hidden="true" tabindex="-1"></a>      PERMIT_LINES <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(<span class="fu">str_sub</span>(LINES, <span class="dv">48</span>, <span class="dv">53</span>), <span class="st">"[[:digit:]]"</span>)</span>
<span id="cb36-167"><a href="#cb36-167" aria-hidden="true" tabindex="-1"></a>      PERMITS <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">str_sub</span>(LINES[PERMIT_LINES], <span class="dv">48</span>, <span class="dv">53</span>))</span>
<span id="cb36-168"><a href="#cb36-168" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-169"><a href="#cb36-169" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data_frame</span>(<span class="at">CBSA =</span> CBSA,</span>
<span id="cb36-170"><a href="#cb36-170" aria-hidden="true" tabindex="-1"></a>                 <span class="at">new_housing_units_permitted =</span> PERMITS, </span>
<span id="cb36-171"><a href="#cb36-171" aria-hidden="true" tabindex="-1"></a>                 <span class="at">year =</span> yy)</span>
<span id="cb36-172"><a href="#cb36-172" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb36-173"><a href="#cb36-173" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-174"><a href="#cb36-174" aria-hidden="true" tabindex="-1"></a>    CURRENT_YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">2019</span>, end_year)</span>
<span id="cb36-175"><a href="#cb36-175" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-176"><a href="#cb36-176" aria-hidden="true" tabindex="-1"></a>    CURRENT_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(CURRENT_YEARS, <span class="cf">function</span>(yy){</span>
<span id="cb36-177"><a href="#cb36-177" aria-hidden="true" tabindex="-1"></a>      current_url <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"https://www.census.gov/construction/bps/xls/msaannual_{yy}99.xls"</span>)</span>
<span id="cb36-178"><a href="#cb36-178" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-179"><a href="#cb36-179" aria-hidden="true" tabindex="-1"></a>      temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb36-180"><a href="#cb36-180" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-181"><a href="#cb36-181" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(current_url, <span class="at">destfile =</span> temp, <span class="at">mode=</span><span class="st">"wb"</span>)</span>
<span id="cb36-182"><a href="#cb36-182" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-183"><a href="#cb36-183" aria-hidden="true" tabindex="-1"></a>      fallback <span class="ot">&lt;-</span> <span class="cf">function</span>(.f1, .f2){</span>
<span id="cb36-184"><a href="#cb36-184" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(...){</span>
<span id="cb36-185"><a href="#cb36-185" aria-hidden="true" tabindex="-1"></a>          <span class="fu">tryCatch</span>(<span class="fu">.f1</span>(...), </span>
<span id="cb36-186"><a href="#cb36-186" aria-hidden="true" tabindex="-1"></a>                   <span class="at">error=</span><span class="cf">function</span>(e) <span class="fu">.f2</span>(...))</span>
<span id="cb36-187"><a href="#cb36-187" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb36-188"><a href="#cb36-188" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-189"><a href="#cb36-189" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-190"><a href="#cb36-190" aria-hidden="true" tabindex="-1"></a>      reader <span class="ot">&lt;-</span> <span class="fu">fallback</span>(read_xlsx, read_xls)</span>
<span id="cb36-191"><a href="#cb36-191" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-192"><a href="#cb36-192" aria-hidden="true" tabindex="-1"></a>      <span class="fu">reader</span>(temp, <span class="at">skip=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-193"><a href="#cb36-193" aria-hidden="true" tabindex="-1"></a>        <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb36-194"><a href="#cb36-194" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(CBSA, Total) <span class="sc">|&gt;</span></span>
<span id="cb36-195"><a href="#cb36-195" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb36-196"><a href="#cb36-196" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">new_housing_units_permitted =</span> Total)</span>
<span id="cb36-197"><a href="#cb36-197" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb36-198"><a href="#cb36-198" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-199"><a href="#cb36-199" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">rbind</span>(HISTORICAL_DATA, CURRENT_DATA)</span>
<span id="cb36-200"><a href="#cb36-200" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-201"><a href="#cb36-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb36-202"><a href="#cb36-202" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-203"><a href="#cb36-203" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-204"><a href="#cb36-204" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-205"><a href="#cb36-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb36-206"><a href="#cb36-206" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-207"><a href="#cb36-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-208"><a href="#cb36-208" aria-hidden="true" tabindex="-1"></a>PERMITS <span class="ot">&lt;-</span> <span class="fu">get_building_permits</span>()</span>
<span id="cb36-209"><a href="#cb36-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-210"><a href="#cb36-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-213"><a href="#cb36-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-214"><a href="#cb36-214" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb36-215"><a href="#cb36-215" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb36-216"><a href="#cb36-216" aria-hidden="true" tabindex="-1"></a>get_bls_industry_codes <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb36-217"><a href="#cb36-217" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="st">"bls_industry_codes.csv"</span>)</span>
<span id="cb36-218"><a href="#cb36-218" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-219"><a href="#cb36-219" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb36-220"><a href="#cb36-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-221"><a href="#cb36-221" aria-hidden="true" tabindex="-1"></a>    resp <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-222"><a href="#cb36-222" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"classifications"</span>, <span class="st">"industry"</span>, <span class="st">"industry-titles.htm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-223"><a href="#cb36-223" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-224"><a href="#cb36-224" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_error</span>(<span class="at">is_error =</span> \(resp) <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-225"><a href="#cb36-225" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_perform</span>()</span>
<span id="cb36-226"><a href="#cb36-226" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-227"><a href="#cb36-227" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_check_status</span>(resp)</span>
<span id="cb36-228"><a href="#cb36-228" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-229"><a href="#cb36-229" aria-hidden="true" tabindex="-1"></a>    naics_table <span class="ot">&lt;-</span> <span class="fu">resp_body_html</span>(resp) <span class="sc">|&gt;</span></span>
<span id="cb36-230"><a href="#cb36-230" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_element</span>(<span class="st">"#naics_titles"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-231"><a href="#cb36-231" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb36-232"><a href="#cb36-232" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">str_trim</span>(<span class="fu">str_remove</span>(<span class="fu">str_remove</span>(<span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>, Code), <span class="st">"NAICS"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb36-233"><a href="#cb36-233" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Industry Title</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-234"><a href="#cb36-234" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">depth =</span> <span class="fu">if_else</span>(<span class="fu">nchar</span>(Code) <span class="sc">&lt;=</span> <span class="dv">5</span>, <span class="fu">nchar</span>(Code) <span class="sc">-</span> <span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-235"><a href="#cb36-235" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(depth))</span>
<span id="cb36-236"><a href="#cb36-236" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-237"><a href="#cb36-237" aria-hidden="true" tabindex="-1"></a>    naics_table <span class="ot">&lt;-</span> naics_table <span class="sc">|&gt;</span> </span>
<span id="cb36-238"><a href="#cb36-238" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(depth <span class="sc">==</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-239"><a href="#cb36-239" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level4_title=</span>title) <span class="sc">|&gt;</span> </span>
<span id="cb36-240"><a href="#cb36-240" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">level1_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">2</span>), </span>
<span id="cb36-241"><a href="#cb36-241" aria-hidden="true" tabindex="-1"></a>             <span class="at">level2_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">3</span>), </span>
<span id="cb36-242"><a href="#cb36-242" aria-hidden="true" tabindex="-1"></a>             <span class="at">level3_code =</span> <span class="fu">str_sub</span>(Code, <span class="at">end=</span><span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-243"><a href="#cb36-243" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level1_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb36-244"><a href="#cb36-244" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level1_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb36-245"><a href="#cb36-245" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level2_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb36-246"><a href="#cb36-246" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level2_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb36-247"><a href="#cb36-247" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(naics_table, <span class="fu">join_by</span>(level3_code <span class="sc">==</span> Code)) <span class="sc">|&gt;</span></span>
<span id="cb36-248"><a href="#cb36-248" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level3_title=</span>title) <span class="sc">|&gt;</span></span>
<span id="cb36-249"><a href="#cb36-249" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"depth"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-250"><a href="#cb36-250" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">level4_code =</span> Code) <span class="sc">|&gt;</span></span>
<span id="cb36-251"><a href="#cb36-251" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(level1_title, level2_title, level3_title, level4_title, </span>
<span id="cb36-252"><a href="#cb36-252" aria-hidden="true" tabindex="-1"></a>             level1_code,  level2_code,  level3_code,  level4_code)</span>
<span id="cb36-253"><a href="#cb36-253" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-254"><a href="#cb36-254" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(naics_table, fname)</span>
<span id="cb36-255"><a href="#cb36-255" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-256"><a href="#cb36-256" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-257"><a href="#cb36-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb36-258"><a href="#cb36-258" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-259"><a href="#cb36-259" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-260"><a href="#cb36-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-261"><a href="#cb36-261" aria-hidden="true" tabindex="-1"></a>INDUSTRY_CODES <span class="ot">&lt;-</span> <span class="fu">get_bls_industry_codes</span>()</span>
<span id="cb36-262"><a href="#cb36-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-263"><a href="#cb36-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-264"><a href="#cb36-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-267"><a href="#cb36-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-268"><a href="#cb36-268" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb36-269"><a href="#cb36-269" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb36-270"><a href="#cb36-270" aria-hidden="true" tabindex="-1"></a>get_bls_qcew_annual_averages <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">start_year=</span><span class="dv">2009</span>, <span class="at">end_year=</span><span class="dv">2023</span>){</span>
<span id="cb36-271"><a href="#cb36-271" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">glue</span>(<span class="st">"bls_qcew_{start_year}_{end_year}.csv.gz"</span>)</span>
<span id="cb36-272"><a href="#cb36-272" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, fname)</span>
<span id="cb36-273"><a href="#cb36-273" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-274"><a href="#cb36-274" aria-hidden="true" tabindex="-1"></a>  YEARS <span class="ot">&lt;-</span> <span class="fu">seq</span>(start_year, end_year)</span>
<span id="cb36-275"><a href="#cb36-275" aria-hidden="true" tabindex="-1"></a>  YEARS <span class="ot">&lt;-</span> YEARS[YEARS <span class="sc">!=</span> <span class="dv">2020</span>] <span class="co"># Drop Covid year </span></span>
<span id="cb36-276"><a href="#cb36-276" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-277"><a href="#cb36-277" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname)){</span>
<span id="cb36-278"><a href="#cb36-278" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">map</span>(YEARS, <span class="at">.progress=</span><span class="cn">TRUE</span>, <span class="fu">possibly</span>(<span class="cf">function</span>(yy){</span>
<span id="cb36-279"><a href="#cb36-279" aria-hidden="true" tabindex="-1"></a>      fname_inner <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>, <span class="fu">glue</span>(<span class="st">"{yy}_qcew_annual_singlefile.zip"</span>))</span>
<span id="cb36-280"><a href="#cb36-280" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-281"><a href="#cb36-281" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(fname_inner)){</span>
<span id="cb36-282"><a href="#cb36-282" aria-hidden="true" tabindex="-1"></a>        <span class="fu">request</span>(<span class="st">"https://www.bls.gov"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-283"><a href="#cb36-283" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_url_path</span>(<span class="st">"cew"</span>, <span class="st">"data"</span>, <span class="st">"files"</span>, yy, <span class="st">"csv"</span>,</span>
<span id="cb36-284"><a href="#cb36-284" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">glue</span>(<span class="st">"{yy}_annual_singlefile.zip"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-285"><a href="#cb36-285" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_headers</span>(<span class="st">`</span><span class="at">User-Agent</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:143.0) Gecko/20100101 Firefox/143.0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-286"><a href="#cb36-286" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_retry</span>(<span class="at">max_tries=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-287"><a href="#cb36-287" aria-hidden="true" tabindex="-1"></a>          <span class="fu">req_perform</span>(fname_inner)</span>
<span id="cb36-288"><a href="#cb36-288" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-289"><a href="#cb36-289" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-290"><a href="#cb36-290" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">file.info</span>(fname_inner)<span class="sc">$</span>size <span class="sc">&lt;</span> <span class="fl">755e5</span>){</span>
<span id="cb36-291"><a href="#cb36-291" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">sQuote</span>(fname_inner), <span class="st">"appears corrupted. Please delete and retry this step."</span>)</span>
<span id="cb36-292"><a href="#cb36-292" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-293"><a href="#cb36-293" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-294"><a href="#cb36-294" aria-hidden="true" tabindex="-1"></a>      <span class="fu">read_csv</span>(fname_inner, </span>
<span id="cb36-295"><a href="#cb36-295" aria-hidden="true" tabindex="-1"></a>               <span class="at">show_col_types=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-296"><a href="#cb36-296" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">YEAR =</span> yy) <span class="sc">|&gt;</span></span>
<span id="cb36-297"><a href="#cb36-297" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(area_fips, </span>
<span id="cb36-298"><a href="#cb36-298" aria-hidden="true" tabindex="-1"></a>               industry_code, </span>
<span id="cb36-299"><a href="#cb36-299" aria-hidden="true" tabindex="-1"></a>               annual_avg_emplvl, </span>
<span id="cb36-300"><a href="#cb36-300" aria-hidden="true" tabindex="-1"></a>               total_annual_wages, </span>
<span id="cb36-301"><a href="#cb36-301" aria-hidden="true" tabindex="-1"></a>               YEAR) <span class="sc">|&gt;</span></span>
<span id="cb36-302"><a href="#cb36-302" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="fu">nchar</span>(industry_code) <span class="sc">&lt;=</span> <span class="dv">5</span>, </span>
<span id="cb36-303"><a href="#cb36-303" aria-hidden="true" tabindex="-1"></a>               <span class="fu">str_starts</span>(area_fips, <span class="st">"C"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-304"><a href="#cb36-304" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="fu">str_detect</span>(industry_code, <span class="st">"-"</span>, <span class="at">negate=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-305"><a href="#cb36-305" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">FIPS =</span> area_fips, </span>
<span id="cb36-306"><a href="#cb36-306" aria-hidden="true" tabindex="-1"></a>               <span class="at">INDUSTRY =</span> <span class="fu">as.integer</span>(industry_code), </span>
<span id="cb36-307"><a href="#cb36-307" aria-hidden="true" tabindex="-1"></a>               <span class="at">EMPLOYMENT =</span> <span class="fu">as.integer</span>(annual_avg_emplvl), </span>
<span id="cb36-308"><a href="#cb36-308" aria-hidden="true" tabindex="-1"></a>               <span class="at">TOTAL_WAGES =</span> total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb36-309"><a href="#cb36-309" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="sc">-</span>area_fips, </span>
<span id="cb36-310"><a href="#cb36-310" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>industry_code, </span>
<span id="cb36-311"><a href="#cb36-311" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>annual_avg_emplvl, </span>
<span id="cb36-312"><a href="#cb36-312" aria-hidden="true" tabindex="-1"></a>               <span class="sc">-</span>total_annual_wages) <span class="sc">|&gt;</span></span>
<span id="cb36-313"><a href="#cb36-313" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(INDUSTRY <span class="sc">!=</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-314"><a href="#cb36-314" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">AVG_WAGE =</span> TOTAL_WAGES <span class="sc">/</span> EMPLOYMENT)</span>
<span id="cb36-315"><a href="#cb36-315" aria-hidden="true" tabindex="-1"></a>    })) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb36-316"><a href="#cb36-316" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-317"><a href="#cb36-317" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(ALL_DATA, fname)</span>
<span id="cb36-318"><a href="#cb36-318" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-319"><a href="#cb36-319" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-320"><a href="#cb36-320" aria-hidden="true" tabindex="-1"></a>  ALL_DATA <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(fname, <span class="at">show_col_types=</span><span class="cn">FALSE</span>)</span>
<span id="cb36-321"><a href="#cb36-321" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-322"><a href="#cb36-322" aria-hidden="true" tabindex="-1"></a>  ALL_DATA_YEARS <span class="ot">&lt;-</span> <span class="fu">unique</span>(ALL_DATA<span class="sc">$</span>YEAR)</span>
<span id="cb36-323"><a href="#cb36-323" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-324"><a href="#cb36-324" aria-hidden="true" tabindex="-1"></a>  YEARS_DIFF <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(YEARS, ALL_DATA_YEARS)</span>
<span id="cb36-325"><a href="#cb36-325" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-326"><a href="#cb36-326" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(YEARS_DIFF) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb36-327"><a href="#cb36-327" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Download failed for the following years: "</span>, YEARS_DIFF, </span>
<span id="cb36-328"><a href="#cb36-328" aria-hidden="true" tabindex="-1"></a>         <span class="st">". Please delete intermediate files and try again."</span>)</span>
<span id="cb36-329"><a href="#cb36-329" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-330"><a href="#cb36-330" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-331"><a href="#cb36-331" aria-hidden="true" tabindex="-1"></a>  ALL_DATA</span>
<span id="cb36-332"><a href="#cb36-332" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-333"><a href="#cb36-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-334"><a href="#cb36-334" aria-hidden="true" tabindex="-1"></a>WAGES <span class="ot">&lt;-</span> <span class="fu">get_bls_qcew_annual_averages</span>()</span>
<span id="cb36-335"><a href="#cb36-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-336"><a href="#cb36-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-337"><a href="#cb36-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-338"><a href="#cb36-338" aria-hidden="true" tabindex="-1"></a><span class="fu"># Entity Relationship Diagram</span></span>
<span id="cb36-339"><a href="#cb36-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-340"><a href="#cb36-340" aria-hidden="true" tabindex="-1"></a><span class="al">![](ERD.png)</span> </span>
<span id="cb36-341"><a href="#cb36-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-342"><a href="#cb36-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-343"><a href="#cb36-343" aria-hidden="true" tabindex="-1"></a><span class="fu"># Task 1 </span></span>
<span id="cb36-344"><a href="#cb36-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-345"><a href="#cb36-345" aria-hidden="true" tabindex="-1"></a><span class="fu">## Which CBSA (by name) permitted the largest number of new housing units in the decade from 2010 to 2019 (inclusive)?</span></span>
<span id="cb36-348"><a href="#cb36-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-349"><a href="#cb36-349" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb36-350"><a href="#cb36-350" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-351"><a href="#cb36-351" aria-hidden="true" tabindex="-1"></a><span class="co">#finding CSBA name in income data</span></span>
<span id="cb36-352"><a href="#cb36-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-353"><a href="#cb36-353" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-354"><a href="#cb36-354" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT) </span>
<span id="cb36-355"><a href="#cb36-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-356"><a href="#cb36-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-357"><a href="#cb36-357" aria-hidden="true" tabindex="-1"></a>CBSA_NAME_CANONICAL <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb36-358"><a href="#cb36-358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">|&gt;</span></span>
<span id="cb36-359"><a href="#cb36-359" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-360"><a href="#cb36-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">NAME =</span> <span class="fu">first</span>(NAME), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-361"><a href="#cb36-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(GEOID))</span>
<span id="cb36-362"><a href="#cb36-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-363"><a href="#cb36-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-364"><a href="#cb36-364" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb36-365"><a href="#cb36-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA =</span> <span class="fu">as.character</span>(CBSA)) <span class="sc">|&gt;</span></span>
<span id="cb36-366"><a href="#cb36-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(CBSA_NAME_CANONICAL <span class="sc">|&gt;</span> <span class="fu">select</span>(CBSA, NAME), <span class="at">by =</span> <span class="st">"CBSA"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-367"><a href="#cb36-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2010</span>, year <span class="sc">&lt;=</span> <span class="dv">2019</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-368"><a href="#cb36-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME, CBSA) <span class="sc">|&gt;</span></span>
<span id="cb36-369"><a href="#cb36-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_units =</span> <span class="fu">sum</span>(new_housing_units_permitted), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-370"><a href="#cb36-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_units))</span>
<span id="cb36-371"><a href="#cb36-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-372"><a href="#cb36-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-373"><a href="#cb36-373" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb36-374"><a href="#cb36-374" aria-hidden="true" tabindex="-1"></a>  result <span class="sc">|&gt;</span></span>
<span id="cb36-375"><a href="#cb36-375" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Location =</span> NAME,</span>
<span id="cb36-376"><a href="#cb36-376" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">New permits</span><span class="st">`</span> <span class="ot">=</span> total_units) <span class="sc">|&gt;</span></span>
<span id="cb36-377"><a href="#cb36-377" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Location, CBSA, <span class="st">`</span><span class="at">New permits</span><span class="st">`</span>),</span>
<span id="cb36-378"><a href="#cb36-378" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Largest Number of New Units"</span>,</span>
<span id="cb36-379"><a href="#cb36-379" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-380"><a href="#cb36-380" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">10</span>, <span class="at">autoWidth =</span> <span class="cn">TRUE</span>, <span class="at">dom =</span> <span class="st">"tip"</span>)</span>
<span id="cb36-381"><a href="#cb36-381" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-382"><a href="#cb36-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-383"><a href="#cb36-383" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb36-384"><a href="#cb36-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-385"><a href="#cb36-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-386"><a href="#cb36-386" aria-hidden="true" tabindex="-1"></a>**Houston, TX** permitted the largest number of new housing units from 2010 to 2019 with **482,075** new units permitted.</span>
<span id="cb36-387"><a href="#cb36-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-388"><a href="#cb36-388" aria-hidden="true" tabindex="-1"></a><span class="fu">## In what year did Albuquerque, NM (CBSA Number 10740) permit the most new housing units?</span></span>
<span id="cb36-391"><a href="#cb36-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-392"><a href="#cb36-392" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-393"><a href="#cb36-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-394"><a href="#cb36-394" aria-hidden="true" tabindex="-1"></a>albuquerque_permits <span class="ot">&lt;-</span> PERMITS <span class="sc">|&gt;</span></span>
<span id="cb36-395"><a href="#cb36-395" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CBSA <span class="sc">==</span> <span class="st">"10740"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-396"><a href="#cb36-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CBSA, year) <span class="sc">|&gt;</span></span>
<span id="cb36-397"><a href="#cb36-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb36-398"><a href="#cb36-398" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_units =</span> <span class="fu">sum</span>(new_housing_units_permitted, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-399"><a href="#cb36-399" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb36-400"><a href="#cb36-400" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-401"><a href="#cb36-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(new_units))</span>
<span id="cb36-402"><a href="#cb36-402" aria-hidden="true" tabindex="-1"></a> <span class="fu">datatable</span>(</span>
<span id="cb36-403"><a href="#cb36-403" aria-hidden="true" tabindex="-1"></a>  albuquerque_permits <span class="sc">|&gt;</span></span>
<span id="cb36-404"><a href="#cb36-404" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb36-405"><a href="#cb36-405" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CBSA ID</span><span class="st">`</span> <span class="ot">=</span> CBSA,</span>
<span id="cb36-406"><a href="#cb36-406" aria-hidden="true" tabindex="-1"></a>      <span class="at">Year =</span> year,</span>
<span id="cb36-407"><a href="#cb36-407" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">New Units Permitted</span><span class="st">`</span> <span class="ot">=</span> new_units</span>
<span id="cb36-408"><a href="#cb36-408" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb36-409"><a href="#cb36-409" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-410"><a href="#cb36-410" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Year, <span class="st">`</span><span class="at">CBSA ID</span><span class="st">`</span>, <span class="st">`</span><span class="at">New Units Permitted</span><span class="st">`</span>),</span>
<span id="cb36-411"><a href="#cb36-411" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-412"><a href="#cb36-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-413"><a href="#cb36-413" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"New Housing Units in Albuquerque, NM"</span>,</span>
<span id="cb36-414"><a href="#cb36-414" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-415"><a href="#cb36-415" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb36-416"><a href="#cb36-416" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb36-417"><a href="#cb36-417" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'tip'</span>, </span>
<span id="cb36-418"><a href="#cb36-418" aria-hidden="true" tabindex="-1"></a>    <span class="at">autoWidth =</span> <span class="cn">TRUE</span></span>
<span id="cb36-419"><a href="#cb36-419" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-420"><a href="#cb36-420" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-421"><a href="#cb36-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-422"><a href="#cb36-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-423"><a href="#cb36-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-424"><a href="#cb36-424" aria-hidden="true" tabindex="-1"></a>Albuquerque, NM permitted the most new units in **2021**.</span>
<span id="cb36-425"><a href="#cb36-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-426"><a href="#cb36-426" aria-hidden="true" tabindex="-1"></a><span class="fu">## Which state (not CBSA) had the highest average individual income in 2015? </span></span>
<span id="cb36-429"><a href="#cb36-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-430"><a href="#cb36-430" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-431"><a href="#cb36-431" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb36-432"><a href="#cb36-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-433"><a href="#cb36-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-434"><a href="#cb36-434" aria-hidden="true" tabindex="-1"></a>cbsa_2015 <span class="ot">&lt;-</span></span>
<span id="cb36-435"><a href="#cb36-435" aria-hidden="true" tabindex="-1"></a>  INCOME <span class="sc">|&gt;</span></span>
<span id="cb36-436"><a href="#cb36-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-437"><a href="#cb36-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb36-438"><a href="#cb36-438" aria-hidden="true" tabindex="-1"></a>    HOUSEHOLDS <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, NAME, year, households),</span>
<span id="cb36-439"><a href="#cb36-439" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)</span>
<span id="cb36-440"><a href="#cb36-440" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-441"><a href="#cb36-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb36-442"><a href="#cb36-442" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2015</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, NAME, year, population),</span>
<span id="cb36-443"><a href="#cb36-443" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)</span>
<span id="cb36-444"><a href="#cb36-444" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-445"><a href="#cb36-445" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">str_extract</span>(NAME, <span class="st">", (.{2})"</span>, <span class="at">group=</span><span class="dv">1</span>))<span class="sc">|&gt;</span>     </span>
<span id="cb36-446"><a href="#cb36-446" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">total_income_cbsa =</span> household_income <span class="sc">*</span> households</span>
<span id="cb36-447"><a href="#cb36-447" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-448"><a href="#cb36-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-449"><a href="#cb36-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-450"><a href="#cb36-450" aria-hidden="true" tabindex="-1"></a>top_state_2015 <span class="ot">&lt;-</span></span>
<span id="cb36-451"><a href="#cb36-451" aria-hidden="true" tabindex="-1"></a>  cbsa_2015 <span class="sc">|&gt;</span></span>
<span id="cb36-452"><a href="#cb36-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb36-453"><a href="#cb36-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb36-454"><a href="#cb36-454" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_income =</span> <span class="fu">sum</span>(total_income_cbsa, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-455"><a href="#cb36-455" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_pop    =</span> <span class="fu">sum</span>(population,       <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-456"><a href="#cb36-456" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_individual_income =</span> total_income <span class="sc">/</span> total_pop,</span>
<span id="cb36-457"><a href="#cb36-457" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb36-458"><a href="#cb36-458" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-459"><a href="#cb36-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_individual_income))</span>
<span id="cb36-460"><a href="#cb36-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-461"><a href="#cb36-461" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb36-462"><a href="#cb36-462" aria-hidden="true" tabindex="-1"></a>  top_state_2015 <span class="sc">|&gt;</span></span>
<span id="cb36-463"><a href="#cb36-463" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb36-464"><a href="#cb36-464" aria-hidden="true" tabindex="-1"></a>      <span class="at">State =</span> state,</span>
<span id="cb36-465"><a href="#cb36-465" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Avg Individual Income</span><span class="st">`</span> <span class="ot">=</span> avg_individual_income,</span>
<span id="cb36-466"><a href="#cb36-466" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Total State Income</span><span class="st">`</span> <span class="ot">=</span> total_income,</span>
<span id="cb36-467"><a href="#cb36-467" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Total Population</span><span class="st">`</span> <span class="ot">=</span> total_pop</span>
<span id="cb36-468"><a href="#cb36-468" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb36-469"><a href="#cb36-469" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Highest Individual Income by State"</span>,</span>
<span id="cb36-470"><a href="#cb36-470" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-471"><a href="#cb36-471" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb36-472"><a href="#cb36-472" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">10</span>,</span>
<span id="cb36-473"><a href="#cb36-473" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'tip'</span>,</span>
<span id="cb36-474"><a href="#cb36-474" aria-hidden="true" tabindex="-1"></a>    <span class="at">autoWidth =</span> <span class="cn">TRUE</span></span>
<span id="cb36-475"><a href="#cb36-475" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-476"><a href="#cb36-476" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb36-477"><a href="#cb36-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(</span>
<span id="cb36-478"><a href="#cb36-478" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Avg Individual Income"</span>, <span class="st">"Total State Income"</span>),</span>
<span id="cb36-479"><a href="#cb36-479" aria-hidden="true" tabindex="-1"></a>    <span class="at">currency =</span> <span class="st">"$"</span>,</span>
<span id="cb36-480"><a href="#cb36-480" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">0</span></span>
<span id="cb36-481"><a href="#cb36-481" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-482"><a href="#cb36-482" aria-hidden="true" tabindex="-1"></a><span class="fu">formatRound</span>(</span>
<span id="cb36-483"><a href="#cb36-483" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="st">"Total Population"</span>,</span>
<span id="cb36-484"><a href="#cb36-484" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">0</span></span>
<span id="cb36-485"><a href="#cb36-485" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-486"><a href="#cb36-486" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-487"><a href="#cb36-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-488"><a href="#cb36-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-489"><a href="#cb36-489" aria-hidden="true" tabindex="-1"></a>Washington DC had the highest individual income by state in 2015 at **$33,233**.</span>
<span id="cb36-490"><a href="#cb36-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-491"><a href="#cb36-491" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data scientists and business analysts are recorded under NAICS code 5182. What is the last year in which the NYC CBSA had the most data scientists in the country? In recent years, the San Francisco CBSA has had the most data scientists.</span></span>
<span id="cb36-494"><a href="#cb36-494" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-495"><a href="#cb36-495" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-496"><a href="#cb36-496" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb36-497"><a href="#cb36-497" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb36-498"><a href="#cb36-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-499"><a href="#cb36-499" aria-hidden="true" tabindex="-1"></a>bls_5182 <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb36-500"><a href="#cb36-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">5182</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-501"><a href="#cb36-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cbsa_num =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>, <span class="st">""</span>, FIPS), <span class="st">"0"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb36-502"><a href="#cb36-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cbsa_num, YEAR, EMPLOYMENT)</span>
<span id="cb36-503"><a href="#cb36-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-504"><a href="#cb36-504" aria-hidden="true" tabindex="-1"></a>cbsa_lookup <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb36-505"><a href="#cb36-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">|&gt;</span></span>
<span id="cb36-506"><a href="#cb36-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">NAME =</span> <span class="fu">first</span>(NAME), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-507"><a href="#cb36-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CBSA_num =</span> <span class="fu">as.integer</span>(GEOID)) <span class="sc">|&gt;</span></span>
<span id="cb36-508"><a href="#cb36-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CBSA_num, NAME)</span>
<span id="cb36-509"><a href="#cb36-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-510"><a href="#cb36-510" aria-hidden="true" tabindex="-1"></a>ds_named <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(bls_5182, cbsa_lookup, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cbsa_num"</span> <span class="ot">=</span> <span class="st">"CBSA_num"</span>))</span>
<span id="cb36-511"><a href="#cb36-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-512"><a href="#cb36-512" aria-hidden="true" tabindex="-1"></a>most_by_year <span class="ot">&lt;-</span> ds_named <span class="sc">|&gt;</span></span>
<span id="cb36-513"><a href="#cb36-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb36-514"><a href="#cb36-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(EMPLOYMENT, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-515"><a href="#cb36-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb36-516"><a href="#cb36-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-517"><a href="#cb36-517" aria-hidden="true" tabindex="-1"></a>nyc_cbsa <span class="ot">&lt;-</span> cbsa_lookup <span class="sc">|&gt;</span></span>
<span id="cb36-518"><a href="#cb36-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(NAME, <span class="st">"^New York"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-519"><a href="#cb36-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-520"><a href="#cb36-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(CBSA_num)</span>
<span id="cb36-521"><a href="#cb36-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-522"><a href="#cb36-522" aria-hidden="true" tabindex="-1"></a>nyc_last_most <span class="ot">&lt;-</span> most_by_year <span class="sc">|&gt;</span></span>
<span id="cb36-523"><a href="#cb36-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cbsa_num <span class="sc">==</span> nyc_cbsa) <span class="sc">|&gt;</span></span>
<span id="cb36-524"><a href="#cb36-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(YEAR, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-525"><a href="#cb36-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-526"><a href="#cb36-526" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> nyc_last_most <span class="sc">|&gt;</span></span>
<span id="cb36-527"><a href="#cb36-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">year =</span> YEAR, <span class="at">employment =</span> EMPLOYMENT)</span>
<span id="cb36-528"><a href="#cb36-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-529"><a href="#cb36-529" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb36-530"><a href="#cb36-530" aria-hidden="true" tabindex="-1"></a>  result <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">Year =</span> year, <span class="st">`</span><span class="at">Data Scientists</span><span class="st">`</span> <span class="ot">=</span> employment),</span>
<span id="cb36-531"><a href="#cb36-531" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">5</span>, <span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>),</span>
<span id="cb36-532"><a href="#cb36-532" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-533"><a href="#cb36-533" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"NYC Data Scientists"</span></span>
<span id="cb36-534"><a href="#cb36-534" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-535"><a href="#cb36-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-536"><a href="#cb36-536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-537"><a href="#cb36-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-538"><a href="#cb36-538" aria-hidden="true" tabindex="-1"></a>Nyc had the most data scientists in **2015** with **18,922** data scientists.</span>
<span id="cb36-539"><a href="#cb36-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-540"><a href="#cb36-540" aria-hidden="true" tabindex="-1"></a><span class="fu">## What fraction of total wages in the NYC CBSA was earned by people employed in the finance and insurance industries (NAICS code 52)? In what year did this fraction peak?</span></span>
<span id="cb36-543"><a href="#cb36-543" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-544"><a href="#cb36-544" aria-hidden="true" tabindex="-1"></a>wages_now <span class="ot">&lt;-</span></span>
<span id="cb36-545"><a href="#cb36-545" aria-hidden="true" tabindex="-1"></a>  WAGES <span class="sc">|&gt;</span></span>
<span id="cb36-546"><a href="#cb36-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cbsa =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>,<span class="st">""</span>, FIPS), <span class="st">"0"</span>)))</span>
<span id="cb36-547"><a href="#cb36-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-548"><a href="#cb36-548" aria-hidden="true" tabindex="-1"></a>nyc_wages <span class="ot">&lt;-</span></span>
<span id="cb36-549"><a href="#cb36-549" aria-hidden="true" tabindex="-1"></a>  wages_now <span class="sc">|&gt;</span></span>
<span id="cb36-550"><a href="#cb36-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cbsa <span class="sc">==</span> <span class="dv">35620</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-551"><a href="#cb36-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(YEAR) <span class="sc">|&gt;</span></span>
<span id="cb36-552"><a href="#cb36-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb36-553"><a href="#cb36-553" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_wages_all =</span> <span class="fu">sum</span>(TOTAL_WAGES, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-554"><a href="#cb36-554" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_wages_fin =</span> <span class="fu">sum</span>(TOTAL_WAGES[INDUSTRY <span class="sc">==</span> <span class="dv">52</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-555"><a href="#cb36-555" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb36-556"><a href="#cb36-556" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-557"><a href="#cb36-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">finance_fraction =</span> total_wages_fin <span class="sc">/</span> total_wages_all) <span class="sc">|&gt;</span></span>
<span id="cb36-558"><a href="#cb36-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(finance_fraction))</span>
<span id="cb36-559"><a href="#cb36-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-560"><a href="#cb36-560" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb36-561"><a href="#cb36-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-562"><a href="#cb36-562" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> nyc_wages <span class="sc">|&gt;</span></span>
<span id="cb36-563"><a href="#cb36-563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb36-564"><a href="#cb36-564" aria-hidden="true" tabindex="-1"></a>    <span class="at">Year =</span> YEAR,</span>
<span id="cb36-565"><a href="#cb36-565" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Wages</span><span class="st">`</span> <span class="ot">=</span> total_wages_all,</span>
<span id="cb36-566"><a href="#cb36-566" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Total Wages for Finance</span><span class="st">`</span> <span class="ot">=</span> total_wages_fin,</span>
<span id="cb36-567"><a href="#cb36-567" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Finance Percent</span><span class="st">`</span> <span class="ot">=</span> finance_fraction</span>
<span id="cb36-568"><a href="#cb36-568" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-569"><a href="#cb36-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-570"><a href="#cb36-570" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb36-571"><a href="#cb36-571" aria-hidden="true" tabindex="-1"></a>  tbl,</span>
<span id="cb36-572"><a href="#cb36-572" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">25</span>, <span class="at">autoWidth =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-573"><a href="#cb36-573" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-574"><a href="#cb36-574" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"NYC CBSA: finance wage share by year"</span></span>
<span id="cb36-575"><a href="#cb36-575" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb36-576"><a href="#cb36-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatCurrency</span>(<span class="fu">c</span>(<span class="st">"Total Wages"</span>,<span class="st">"Total Wages for Finance"</span>), <span class="at">currency =</span> <span class="st">"$"</span>, <span class="at">digits =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-577"><a href="#cb36-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatPercentage</span>(<span class="st">"Finance Percent"</span>, <span class="dv">1</span>)</span>
<span id="cb36-578"><a href="#cb36-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-579"><a href="#cb36-579" aria-hidden="true" tabindex="-1"></a>result  </span>
<span id="cb36-580"><a href="#cb36-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-581"><a href="#cb36-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-582"><a href="#cb36-582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-583"><a href="#cb36-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-584"><a href="#cb36-584" aria-hidden="true" tabindex="-1"></a>**4.6%** of total wages in the NYC CBSA was earned by people in the finance and insurance industry at its peak in **2014**.</span>
<span id="cb36-585"><a href="#cb36-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-586"><a href="#cb36-586" aria-hidden="true" tabindex="-1"></a><span class="fu"># Task 3</span></span>
<span id="cb36-587"><a href="#cb36-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-588"><a href="#cb36-588" aria-hidden="true" tabindex="-1"></a><span class="fu">## The relationship between monthly rent and average household income per CBSA in 2009.</span></span>
<span id="cb36-589"><a href="#cb36-589" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, warning=FALSE}</span></span>
<span id="cb36-590"><a href="#cb36-590" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb36-591"><a href="#cb36-591" aria-hidden="true" tabindex="-1"></a>cbsa_2009 <span class="ot">&lt;-</span></span>
<span id="cb36-592"><a href="#cb36-592" aria-hidden="true" tabindex="-1"></a>  RENT <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-593"><a href="#cb36-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, monthly_rent) <span class="sc">|&gt;</span></span>
<span id="cb36-594"><a href="#cb36-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb36-595"><a href="#cb36-595" aria-hidden="true" tabindex="-1"></a>    INCOME <span class="sc">|&gt;</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2009</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, NAME, year, household_income),</span>
<span id="cb36-596"><a href="#cb36-596" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>,<span class="st">"year"</span>)</span>
<span id="cb36-597"><a href="#cb36-597" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-598"><a href="#cb36-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-599"><a href="#cb36-599" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cbsa_2009, <span class="fu">aes</span>(<span class="at">x =</span> household_income, <span class="at">y =</span> monthly_rent)) <span class="sc">+</span></span>
<span id="cb36-600"><a href="#cb36-600" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb36-601"><a href="#cb36-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb36-602"><a href="#cb36-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb36-603"><a href="#cb36-603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb36-604"><a href="#cb36-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb36-605"><a href="#cb36-605" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Rent vs Household Income by CBSA (2009)"</span>,</span>
<span id="cb36-606"><a href="#cb36-606" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Average household income"</span>,</span>
<span id="cb36-607"><a href="#cb36-607" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average monthly rent"</span></span>
<span id="cb36-608"><a href="#cb36-608" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-609"><a href="#cb36-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb36-610"><a href="#cb36-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-611"><a href="#cb36-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-612"><a href="#cb36-612" aria-hidden="true" tabindex="-1"></a>The data for **monthly rent** and **average household** income seem to have a positive correlation. This positive correlation makes sense because with more income, families are able to afford a higher rent cost, and provide a better quality of life. This correlation could also be attributed to inflation of rent price based on the increase in household income.</span>
<span id="cb36-613"><a href="#cb36-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-614"><a href="#cb36-614" aria-hidden="true" tabindex="-1"></a><span class="fu">## The relationship between total employment and total employment in the health care and social services sector (NAICS 62) across different CBSAs. Design your visualization so that it is possible to see the evolution of this relationship over time.</span></span>
<span id="cb36-617"><a href="#cb36-617" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-618"><a href="#cb36-618" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-619"><a href="#cb36-619" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-620"><a href="#cb36-620" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb36-621"><a href="#cb36-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-622"><a href="#cb36-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-623"><a href="#cb36-623" aria-hidden="true" tabindex="-1"></a>total_emp <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb36-624"><a href="#cb36-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cbsa =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>, <span class="st">""</span>, FIPS), <span class="st">"0"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb36-625"><a href="#cb36-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cbsa, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb36-626"><a href="#cb36-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_emp =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb36-627"><a href="#cb36-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-628"><a href="#cb36-628" aria-hidden="true" tabindex="-1"></a><span class="co">#Health care </span></span>
<span id="cb36-629"><a href="#cb36-629" aria-hidden="true" tabindex="-1"></a>health_emp <span class="ot">&lt;-</span> WAGES <span class="sc">|&gt;</span></span>
<span id="cb36-630"><a href="#cb36-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(INDUSTRY <span class="sc">==</span> <span class="dv">62</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-631"><a href="#cb36-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cbsa =</span> <span class="fu">as.integer</span>(<span class="fu">paste0</span>(<span class="fu">sub</span>(<span class="st">"^C"</span>, <span class="st">""</span>, FIPS), <span class="st">"0"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb36-632"><a href="#cb36-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cbsa, YEAR) <span class="sc">|&gt;</span></span>
<span id="cb36-633"><a href="#cb36-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">health_emp =</span> <span class="fu">sum</span>(EMPLOYMENT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb36-634"><a href="#cb36-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-635"><a href="#cb36-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-636"><a href="#cb36-636" aria-hidden="true" tabindex="-1"></a>emp_df <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(total_emp, health_emp, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cbsa"</span>, <span class="st">"YEAR"</span>))</span>
<span id="cb36-637"><a href="#cb36-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-638"><a href="#cb36-638" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb36-639"><a href="#cb36-639" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emp_df, <span class="fu">aes</span>(<span class="at">x =</span> total_emp <span class="sc">/</span> <span class="fl">1e6</span>, <span class="at">y =</span> health_emp <span class="sc">/</span> <span class="fl">1e6</span>, <span class="at">color =</span> <span class="fu">factor</span>(cbsa))) <span class="sc">+</span></span>
<span id="cb36-640"><a href="#cb36-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">1.6</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb36-641"><a href="#cb36-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">linewidth =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span></span>
<span id="cb36-642"><a href="#cb36-642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> comma, <span class="at">name =</span> <span class="st">"Total employment (millions)"</span>) <span class="sc">+</span></span>
<span id="cb36-643"><a href="#cb36-643" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma, <span class="at">name =</span> <span class="st">"Health care (millions)"</span>) <span class="sc">+</span></span>
<span id="cb36-644"><a href="#cb36-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> YEAR, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb36-645"><a href="#cb36-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Health Care vs Total Employment"</span>) <span class="sc">+</span></span>
<span id="cb36-646"><a href="#cb36-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">13</span>)</span>
<span id="cb36-647"><a href="#cb36-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-648"><a href="#cb36-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-649"><a href="#cb36-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-650"><a href="#cb36-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-651"><a href="#cb36-651" aria-hidden="true" tabindex="-1"></a>We can see from these plots that as total employment increases, employment within the healthcare sector increases steadily as well, which is intuitive. But we can infer from this data that total employment also increases as the population increases, because the population has increased since 2013. If more people exist, more people will become employed and be employed in the healthcare sector. However, if we take a look at the graphs from 2019 and 2021, we can see that after the pandemic in 2020 the total employment in 2021 actually goes down significantly, while healthcare employment remains relatively the same. This highlights the need for healthcare workers after a global health crisis.</span>
<span id="cb36-652"><a href="#cb36-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-653"><a href="#cb36-653" aria-hidden="true" tabindex="-1"></a><span class="fu">## The evolution of average household size over time. Use different lines to represent different CBSAs.</span></span>
<span id="cb36-656"><a href="#cb36-656" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-657"><a href="#cb36-657" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-658"><a href="#cb36-658" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-659"><a href="#cb36-659" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gghighlight)</span>
<span id="cb36-660"><a href="#cb36-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-661"><a href="#cb36-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-662"><a href="#cb36-662" aria-hidden="true" tabindex="-1"></a>hh_pop <span class="ot">&lt;-</span> HOUSEHOLDS <span class="sc">|&gt;</span></span>
<span id="cb36-663"><a href="#cb36-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, households, year) <span class="sc">|&gt;</span></span>
<span id="cb36-664"><a href="#cb36-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb36-665"><a href="#cb36-665" aria-hidden="true" tabindex="-1"></a>    POPULATION <span class="sc">|&gt;</span> <span class="fu">select</span>(GEOID, population, year),</span>
<span id="cb36-666"><a href="#cb36-666" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"year"</span>)</span>
<span id="cb36-667"><a href="#cb36-667" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-668"><a href="#cb36-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-669"><a href="#cb36-669" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_household_size =</span> population <span class="sc">/</span> households,</span>
<span id="cb36-670"><a href="#cb36-670" aria-hidden="true" tabindex="-1"></a>    <span class="at">metro_area =</span> <span class="fu">case_when</span>(</span>
<span id="cb36-671"><a href="#cb36-671" aria-hidden="true" tabindex="-1"></a>      GEOID <span class="sc">==</span> <span class="dv">35620</span> <span class="sc">~</span> <span class="st">"NYC"</span>,                 </span>
<span id="cb36-672"><a href="#cb36-672" aria-hidden="true" tabindex="-1"></a>      GEOID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">31080</span>, <span class="dv">31100</span>) <span class="sc">~</span> <span class="st">"LA"</span>,      </span>
<span id="cb36-673"><a href="#cb36-673" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other CBSAs"</span></span>
<span id="cb36-674"><a href="#cb36-674" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb36-675"><a href="#cb36-675" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-676"><a href="#cb36-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-677"><a href="#cb36-677" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hh_pop, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> avg_household_size, <span class="at">group =</span> GEOID)) <span class="sc">+</span></span>
<span id="cb36-678"><a href="#cb36-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> metro_area), <span class="at">linewidth =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb36-679"><a href="#cb36-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> metro_area), <span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb36-680"><a href="#cb36-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gghighlight</span>(</span>
<span id="cb36-681"><a href="#cb36-681" aria-hidden="true" tabindex="-1"></a>    metro_area <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"NYC"</span>, <span class="st">"LA"</span>),</span>
<span id="cb36-682"><a href="#cb36-682" aria-hidden="true" tabindex="-1"></a>    <span class="at">label_key =</span> metro_area,</span>
<span id="cb36-683"><a href="#cb36-683" aria-hidden="true" tabindex="-1"></a>    <span class="at">unhighlighted_params =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"gray80"</span>, <span class="at">alpha =</span> <span class="fl">0.25</span>),</span>
<span id="cb36-684"><a href="#cb36-684" aria-hidden="true" tabindex="-1"></a>    <span class="at">use_group_by =</span> <span class="cn">FALSE</span></span>
<span id="cb36-685"><a href="#cb36-685" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-686"><a href="#cb36-686" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-687"><a href="#cb36-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"NYC"</span> <span class="ot">=</span> <span class="st">"#377eb8"</span>, <span class="st">"LA"</span> <span class="ot">=</span> <span class="st">"#e41a1c"</span>, <span class="st">"Other CBSAs"</span> <span class="ot">=</span> <span class="st">"gray80"</span>)) <span class="sc">+</span></span>
<span id="cb36-688"><a href="#cb36-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb36-689"><a href="#cb36-689" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Evolution of Household Size by CBSA"</span>,</span>
<span id="cb36-690"><a href="#cb36-690" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"NYC and LA highlighted"</span>,</span>
<span id="cb36-691"><a href="#cb36-691" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb36-692"><a href="#cb36-692" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average household size"</span></span>
<span id="cb36-693"><a href="#cb36-693" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-694"><a href="#cb36-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb36-695"><a href="#cb36-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb36-696"><a href="#cb36-696" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb36-697"><a href="#cb36-697" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb36-698"><a href="#cb36-698" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-699"><a href="#cb36-699" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-700"><a href="#cb36-700" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb36-701"><a href="#cb36-701" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-702"><a href="#cb36-702" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-703"><a href="#cb36-703" aria-hidden="true" tabindex="-1"></a>Overall, and for out two highlighted CBSAs, it seems that housing size has decreased.</span>
<span id="cb36-704"><a href="#cb36-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-705"><a href="#cb36-705" aria-hidden="true" tabindex="-1"></a><span class="fu"># Task 5 Housing Growth</span></span>
<span id="cb36-706"><a href="#cb36-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-707"><a href="#cb36-707" aria-hidden="true" tabindex="-1"></a><span class="fu">## Finding our Baseline for Rent Burden</span></span>
<span id="cb36-708"><a href="#cb36-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-711"><a href="#cb36-711" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-712"><a href="#cb36-712" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-713"><a href="#cb36-713" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb36-714"><a href="#cb36-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-715"><a href="#cb36-715" aria-hidden="true" tabindex="-1"></a>RENT_BURDEN <span class="ot">&lt;-</span> INCOME <span class="sc">|&gt;</span></span>
<span id="cb36-716"><a href="#cb36-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(RENT, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"year"</span>,<span class="st">"NAME"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-717"><a href="#cb36-717" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RENT_BURDEN =</span> (monthly_rent <span class="sc">*</span> <span class="dv">12</span>) <span class="sc">/</span> household_income) <span class="sc">|&gt;</span></span>
<span id="cb36-718"><a href="#cb36-718" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(RENT_BURDEN))</span>
<span id="cb36-719"><a href="#cb36-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-720"><a href="#cb36-720" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">|&gt;</span></span>
<span id="cb36-721"><a href="#cb36-721" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">|&gt;</span></span>
<span id="cb36-722"><a href="#cb36-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-723"><a href="#cb36-723" aria-hidden="true" tabindex="-1"></a>    <span class="at">BASE_2009 =</span> RENT_BURDEN[year <span class="sc">==</span> <span class="dv">2009</span>][<span class="dv">1</span>],</span>
<span id="cb36-724"><a href="#cb36-724" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_IDX =</span> <span class="dv">100</span> <span class="sc">*</span> RENT_BURDEN <span class="sc">/</span> BASE_2009</span>
<span id="cb36-725"><a href="#cb36-725" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-726"><a href="#cb36-726" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb36-727"><a href="#cb36-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-728"><a href="#cb36-728" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the summary (no stray prints)</span></span>
<span id="cb36-729"><a href="#cb36-729" aria-hidden="true" tabindex="-1"></a>summary_tbl <span class="ot">&lt;-</span> baseline <span class="sc">%&gt;%</span></span>
<span id="cb36-730"><a href="#cb36-730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb36-731"><a href="#cb36-731" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean Rent Burden</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-732"><a href="#cb36-732" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean Index</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(RENT_BURDEN_IDX, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-733"><a href="#cb36-733" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-734"><a href="#cb36-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-735"><a href="#cb36-735" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb36-736"><a href="#cb36-736" aria-hidden="true" tabindex="-1"></a>  summary_tbl,</span>
<span id="cb36-737"><a href="#cb36-737" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-738"><a href="#cb36-738" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb36-739"><a href="#cb36-739" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-740"><a href="#cb36-740" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-741"><a href="#cb36-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-742"><a href="#cb36-742" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">formatPercentage</span>(result, <span class="st">"Mean Rent Burden"</span>, <span class="dv">1</span>)</span>
<span id="cb36-743"><a href="#cb36-743" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">formatRound</span>(result, <span class="st">"Mean Index"</span>, <span class="dv">1</span>)</span>
<span id="cb36-744"><a href="#cb36-744" aria-hidden="true" tabindex="-1"></a>result</span>
<span id="cb36-745"><a href="#cb36-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-746"><a href="#cb36-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-747"><a href="#cb36-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-748"><a href="#cb36-748" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rent Burden in Atlanta</span></span>
<span id="cb36-751"><a href="#cb36-751" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-752"><a href="#cb36-752" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-753"><a href="#cb36-753" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb36-754"><a href="#cb36-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-755"><a href="#cb36-755" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> baseline <span class="sc">|&gt;</span></span>
<span id="cb36-756"><a href="#cb36-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb36-757"><a href="#cb36-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-758"><a href="#cb36-758" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_MINMAX =</span></span>
<span id="cb36-759"><a href="#cb36-759" aria-hidden="true" tabindex="-1"></a>      <span class="dv">100</span> <span class="sc">*</span> (RENT_BURDEN <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb36-760"><a href="#cb36-760" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">max</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb36-761"><a href="#cb36-761" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-762"><a href="#cb36-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb36-763"><a href="#cb36-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GEOID <span class="sc">==</span> <span class="dv">12060</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-764"><a href="#cb36-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb36-765"><a href="#cb36-765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RENT_BURDEN, RENT_BURDEN_IDX, RENT_BURDEN_MINMAX)</span>
<span id="cb36-766"><a href="#cb36-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-767"><a href="#cb36-767" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb36-768"><a href="#cb36-768" aria-hidden="true" tabindex="-1"></a>  tbl <span class="sc">|&gt;</span></span>
<span id="cb36-769"><a href="#cb36-769" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb36-770"><a href="#cb36-770" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CBSA Code</span><span class="st">`</span> <span class="ot">=</span> GEOID,</span>
<span id="cb36-771"><a href="#cb36-771" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CBSA Name</span><span class="st">`</span> <span class="ot">=</span> NAME,</span>
<span id="cb36-772"><a href="#cb36-772" aria-hidden="true" tabindex="-1"></a>      <span class="at">Year =</span> year,</span>
<span id="cb36-773"><a href="#cb36-773" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent Burden</span><span class="st">`</span> <span class="ot">=</span> RENT_BURDEN,</span>
<span id="cb36-774"><a href="#cb36-774" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent Burden Index (2009=100)</span><span class="st">`</span> <span class="ot">=</span> RENT_BURDEN_IDX,</span>
<span id="cb36-775"><a href="#cb36-775" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent Burden Min-Max (0-100)</span><span class="st">`</span> <span class="ot">=</span> RENT_BURDEN_MINMAX</span>
<span id="cb36-776"><a href="#cb36-776" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb36-777"><a href="#cb36-777" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-778"><a href="#cb36-778" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb36-779"><a href="#cb36-779" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">"t"</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-780"><a href="#cb36-780" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb36-781"><a href="#cb36-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatPercentage</span>(<span class="st">"Rent Burden"</span>, <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-782"><a href="#cb36-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="fu">c</span>(<span class="st">"Rent Burden Index (2009=100)"</span>, <span class="st">"Rent Burden Min-Max (0-100)"</span>), <span class="dv">1</span>)</span>
<span id="cb36-783"><a href="#cb36-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-784"><a href="#cb36-784" aria-hidden="true" tabindex="-1"></a>result</span>
<span id="cb36-785"><a href="#cb36-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-786"><a href="#cb36-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-787"><a href="#cb36-787" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-788"><a href="#cb36-788" aria-hidden="true" tabindex="-1"></a>Our **rent burden** for Atlanta has increased significantly, especially from 2022 to 2023.  </span>
<span id="cb36-789"><a href="#cb36-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-790"><a href="#cb36-790" aria-hidden="true" tabindex="-1"></a><span class="fu">## Top 5 and Bottom 5 </span></span>
<span id="cb36-793"><a href="#cb36-793" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-794"><a href="#cb36-794" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-795"><a href="#cb36-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-796"><a href="#cb36-796" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute yearly</span></span>
<span id="cb36-797"><a href="#cb36-797" aria-hidden="true" tabindex="-1"></a>extremes <span class="ot">&lt;-</span> baseline <span class="sc">|&gt;</span></span>
<span id="cb36-798"><a href="#cb36-798" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb36-799"><a href="#cb36-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-800"><a href="#cb36-800" aria-hidden="true" tabindex="-1"></a>    <span class="at">RENT_BURDEN_MINMAX =</span></span>
<span id="cb36-801"><a href="#cb36-801" aria-hidden="true" tabindex="-1"></a>      <span class="dv">100</span> <span class="sc">*</span> (RENT_BURDEN <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb36-802"><a href="#cb36-802" aria-hidden="true" tabindex="-1"></a>            (<span class="fu">max</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb36-803"><a href="#cb36-803" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-804"><a href="#cb36-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb36-805"><a href="#cb36-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(NAME) <span class="sc">|&gt;</span></span>
<span id="cb36-806"><a href="#cb36-806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb36-807"><a href="#cb36-807" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_rent_burden =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-808"><a href="#cb36-808" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_scaled      =</span> <span class="fu">mean</span>(RENT_BURDEN_MINMAX, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-809"><a href="#cb36-809" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-810"><a href="#cb36-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_scaled))</span>
<span id="cb36-811"><a href="#cb36-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-812"><a href="#cb36-812" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 5</span></span>
<span id="cb36-813"><a href="#cb36-813" aria-hidden="true" tabindex="-1"></a>top_5 <span class="ot">&lt;-</span> extremes <span class="sc">|&gt;</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb36-814"><a href="#cb36-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-815"><a href="#cb36-815" aria-hidden="true" tabindex="-1"></a><span class="co"># Bottom 5 </span></span>
<span id="cb36-816"><a href="#cb36-816" aria-hidden="true" tabindex="-1"></a>bottom_5 <span class="ot">&lt;-</span> extremes <span class="sc">|&gt;</span> <span class="fu">slice_tail</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb36-817"><a href="#cb36-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-818"><a href="#cb36-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-819"><a href="#cb36-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-820"><a href="#cb36-820" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-821"><a href="#cb36-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-822"><a href="#cb36-822" aria-hidden="true" tabindex="-1"></a><span class="fu">## Top 5</span></span>
<span id="cb36-825"><a href="#cb36-825" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-826"><a href="#cb36-826" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb36-827"><a href="#cb36-827" aria-hidden="true" tabindex="-1"></a>  top_5,</span>
<span id="cb36-828"><a href="#cb36-828" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb36-829"><a href="#cb36-829" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">5</span>,</span>
<span id="cb36-830"><a href="#cb36-830" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'t'</span>,</span>
<span id="cb36-831"><a href="#cb36-831" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordering =</span> <span class="cn">FALSE</span></span>
<span id="cb36-832"><a href="#cb36-832" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb36-833"><a href="#cb36-833" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(</span>
<span id="cb36-834"><a href="#cb36-834" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CBSA Name"</span> <span class="ot">=</span> <span class="st">"NAME"</span>,</span>
<span id="cb36-835"><a href="#cb36-835" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mean Rent Burden"</span> <span class="ot">=</span> <span class="st">"mean_rent_burden"</span>, </span>
<span id="cb36-836"><a href="#cb36-836" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mean Scaled Rent Burden"</span> <span class="ot">=</span> <span class="st">"mean_scaled"</span></span>
<span id="cb36-837"><a href="#cb36-837" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb36-838"><a href="#cb36-838" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Top 5 CBSAs"</span></span>
<span id="cb36-839"><a href="#cb36-839" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-840"><a href="#cb36-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-841"><a href="#cb36-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-842"><a href="#cb36-842" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bottom 5</span></span>
<span id="cb36-845"><a href="#cb36-845" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-846"><a href="#cb36-846" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(</span>
<span id="cb36-847"><a href="#cb36-847" aria-hidden="true" tabindex="-1"></a>  bottom_5,</span>
<span id="cb36-848"><a href="#cb36-848" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb36-849"><a href="#cb36-849" aria-hidden="true" tabindex="-1"></a>    <span class="at">pageLength =</span> <span class="dv">5</span>,</span>
<span id="cb36-850"><a href="#cb36-850" aria-hidden="true" tabindex="-1"></a>    <span class="at">dom =</span> <span class="st">'t'</span>,</span>
<span id="cb36-851"><a href="#cb36-851" aria-hidden="true" tabindex="-1"></a>    <span class="at">ordering =</span> <span class="cn">FALSE</span></span>
<span id="cb36-852"><a href="#cb36-852" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb36-853"><a href="#cb36-853" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(</span>
<span id="cb36-854"><a href="#cb36-854" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CBSA Name"</span> <span class="ot">=</span> <span class="st">"NAME"</span>,</span>
<span id="cb36-855"><a href="#cb36-855" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mean Rent Burden"</span> <span class="ot">=</span> <span class="st">"mean_rent_burden"</span>,</span>
<span id="cb36-856"><a href="#cb36-856" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mean Scaled Rent Burden"</span> <span class="ot">=</span> <span class="st">"mean_scaled"</span></span>
<span id="cb36-857"><a href="#cb36-857" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb36-858"><a href="#cb36-858" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Bottom 5 CBSAs"</span></span>
<span id="cb36-859"><a href="#cb36-859" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-860"><a href="#cb36-860" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-861"><a href="#cb36-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-862"><a href="#cb36-862" aria-hidden="true" tabindex="-1"></a><span class="fu">## Population and Housing Growth</span></span>
<span id="cb36-865"><a href="#cb36-865" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-866"><a href="#cb36-866" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-867"><a href="#cb36-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-868"><a href="#cb36-868" aria-hidden="true" tabindex="-1"></a>pop_growth_5yr <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb36-869"><a href="#cb36-869" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(GEOID, year) <span class="sc">|&gt;</span></span>
<span id="cb36-870"><a href="#cb36-870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">|&gt;</span></span>
<span id="cb36-871"><a href="#cb36-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-872"><a href="#cb36-872" aria-hidden="true" tabindex="-1"></a>    <span class="at">POP_5YR_AGO    =</span> <span class="fu">lag</span>(population, <span class="dv">5</span>),</span>
<span id="cb36-873"><a href="#cb36-873" aria-hidden="true" tabindex="-1"></a>    <span class="at">POP_GROWTH_5YR =</span> (population <span class="sc">-</span> POP_5YR_AGO) <span class="sc">/</span> POP_5YR_AGO</span>
<span id="cb36-874"><a href="#cb36-874" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-875"><a href="#cb36-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2014</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-876"><a href="#cb36-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb36-877"><a href="#cb36-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-878"><a href="#cb36-878" aria-hidden="true" tabindex="-1"></a><span class="co">#Instantaneous housing growth</span></span>
<span id="cb36-879"><a href="#cb36-879" aria-hidden="true" tabindex="-1"></a>instant <span class="ot">&lt;-</span> POPULATION <span class="sc">|&gt;</span></span>
<span id="cb36-880"><a href="#cb36-880" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(PERMITS, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span> <span class="ot">=</span> <span class="st">"CBSA"</span>, <span class="st">"year"</span> <span class="ot">=</span> <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-881"><a href="#cb36-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-882"><a href="#cb36-882" aria-hidden="true" tabindex="-1"></a>    <span class="at">INSTANT_PER_1K =</span> <span class="dv">1000</span> <span class="sc">*</span> new_housing_units_permitted <span class="sc">/</span> population</span>
<span id="cb36-883"><a href="#cb36-883" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-884"><a href="#cb36-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K)</span>
<span id="cb36-885"><a href="#cb36-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-886"><a href="#cb36-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-887"><a href="#cb36-887" aria-hidden="true" tabindex="-1"></a>rate_based <span class="ot">&lt;-</span> pop_growth_5yr <span class="sc">|&gt;</span></span>
<span id="cb36-888"><a href="#cb36-888" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(PERMITS, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span> <span class="ot">=</span> <span class="st">"CBSA"</span>, <span class="st">"year"</span> <span class="ot">=</span> <span class="st">"year"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb36-889"><a href="#cb36-889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-890"><a href="#cb36-890" aria-hidden="true" tabindex="-1"></a>    <span class="at">PERMITS_PER_1K  =</span> <span class="dv">1000</span> <span class="sc">*</span> new_housing_units_permitted <span class="sc">/</span> population,</span>
<span id="cb36-891"><a href="#cb36-891" aria-hidden="true" tabindex="-1"></a>    <span class="at">RATE_VS_POP_5YR =</span> PERMITS_PER_1K <span class="sc">/</span> POP_GROWTH_5YR</span>
<span id="cb36-892"><a href="#cb36-892" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb36-893"><a href="#cb36-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RATE_VS_POP_5YR)</span>
<span id="cb36-894"><a href="#cb36-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-895"><a href="#cb36-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-896"><a href="#cb36-896" aria-hidden="true" tabindex="-1"></a>housing_metrics <span class="ot">&lt;-</span> instant <span class="sc">|&gt;</span></span>
<span id="cb36-897"><a href="#cb36-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(rate_based, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>, <span class="st">"NAME"</span>, <span class="st">"year"</span>))</span>
<span id="cb36-898"><a href="#cb36-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-899"><a href="#cb36-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-900"><a href="#cb36-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-901"><a href="#cb36-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-902"><a href="#cb36-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-903"><a href="#cb36-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-904"><a href="#cb36-904" aria-hidden="true" tabindex="-1"></a>housing_metrics_z <span class="ot">&lt;-</span> housing_metrics <span class="sc">|&gt;</span></span>
<span id="cb36-905"><a href="#cb36-905" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-906"><a href="#cb36-906" aria-hidden="true" tabindex="-1"></a>    <span class="at">INSTANT_Z =</span> (INSTANT_PER_1K  <span class="sc">-</span> <span class="fu">mean</span>(INSTANT_PER_1K,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb36-907"><a href="#cb36-907" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sd</span>(INSTANT_PER_1K,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-908"><a href="#cb36-908" aria-hidden="true" tabindex="-1"></a>    <span class="at">RATE_Z    =</span> (RATE_VS_POP_5YR <span class="sc">-</span> <span class="fu">mean</span>(RATE_VS_POP_5YR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span></span>
<span id="cb36-909"><a href="#cb36-909" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sd</span>(RATE_VS_POP_5YR, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-910"><a href="#cb36-910" aria-hidden="true" tabindex="-1"></a>    <span class="at">COMPOSITE_Z =</span> <span class="fl">0.5</span> <span class="sc">*</span> INSTANT_Z <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> RATE_Z</span>
<span id="cb36-911"><a href="#cb36-911" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-912"><a href="#cb36-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-913"><a href="#cb36-913" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 and bottom 10 instant </span></span>
<span id="cb36-914"><a href="#cb36-914" aria-hidden="true" tabindex="-1"></a>top10_instant <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb36-915"><a href="#cb36-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(INSTANT_Z)) <span class="sc">|&gt;</span></span>
<span id="cb36-916"><a href="#cb36-916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, INSTANT_Z) <span class="sc">|&gt;</span></span>
<span id="cb36-917"><a href="#cb36-917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb36-918"><a href="#cb36-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-919"><a href="#cb36-919" aria-hidden="true" tabindex="-1"></a>bottom10_instant <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb36-920"><a href="#cb36-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(INSTANT_Z) <span class="sc">|&gt;</span></span>
<span id="cb36-921"><a href="#cb36-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, INSTANT_Z) <span class="sc">|&gt;</span></span>
<span id="cb36-922"><a href="#cb36-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb36-923"><a href="#cb36-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-924"><a href="#cb36-924" aria-hidden="true" tabindex="-1"></a><span class="co"># Top 10 and bottom 10 rate-based </span></span>
<span id="cb36-925"><a href="#cb36-925" aria-hidden="true" tabindex="-1"></a>top10_rate <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb36-926"><a href="#cb36-926" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(RATE_Z)) <span class="sc">|&gt;</span></span>
<span id="cb36-927"><a href="#cb36-927" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RATE_VS_POP_5YR, RATE_Z) <span class="sc">|&gt;</span></span>
<span id="cb36-928"><a href="#cb36-928" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb36-929"><a href="#cb36-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-930"><a href="#cb36-930" aria-hidden="true" tabindex="-1"></a>bottom10_rate <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb36-931"><a href="#cb36-931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(RATE_Z) <span class="sc">|&gt;</span></span>
<span id="cb36-932"><a href="#cb36-932" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RATE_VS_POP_5YR, RATE_Z) <span class="sc">|&gt;</span></span>
<span id="cb36-933"><a href="#cb36-933" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb36-934"><a href="#cb36-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-935"><a href="#cb36-935" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-936"><a href="#cb36-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-937"><a href="#cb36-937" aria-hidden="true" tabindex="-1"></a><span class="fu"># Top 10 Instantaneous Housing Growth</span></span>
<span id="cb36-940"><a href="#cb36-940" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-941"><a href="#cb36-941" aria-hidden="true" tabindex="-1"></a>result_top_instant <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb36-942"><a href="#cb36-942" aria-hidden="true" tabindex="-1"></a>  top10_instant,</span>
<span id="cb36-943"><a href="#cb36-943" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-944"><a href="#cb36-944" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb36-945"><a href="#cb36-945" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>),</span>
<span id="cb36-946"><a href="#cb36-946" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"CBSA Code"</span>,<span class="st">"CBSA Name"</span>,<span class="st">"Year"</span>,<span class="st">"Instant per 1k"</span>,<span class="st">"Instant Z"</span>),</span>
<span id="cb36-947"><a href="#cb36-947" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-948"><a href="#cb36-948" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-949"><a href="#cb36-949" aria-hidden="true" tabindex="-1"></a>result_top_instant <span class="ot">&lt;-</span> <span class="fu">formatRound</span>(result_top_instant, <span class="dv">4</span>, <span class="dv">1</span>)</span>
<span id="cb36-950"><a href="#cb36-950" aria-hidden="true" tabindex="-1"></a>result_top_instant <span class="ot">&lt;-</span> <span class="fu">formatRound</span>(result_top_instant, <span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb36-951"><a href="#cb36-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-952"><a href="#cb36-952" aria-hidden="true" tabindex="-1"></a>result_top_instant</span>
<span id="cb36-953"><a href="#cb36-953" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-954"><a href="#cb36-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-955"><a href="#cb36-955" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bottom 10 Instantaneous Housing Growth</span></span>
<span id="cb36-958"><a href="#cb36-958" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-959"><a href="#cb36-959" aria-hidden="true" tabindex="-1"></a> result_bottom_instant <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb36-960"><a href="#cb36-960" aria-hidden="true" tabindex="-1"></a>  bottom10_instant <span class="sc">%&gt;%</span></span>
<span id="cb36-961"><a href="#cb36-961" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">`</span><span class="at">CBSA Code</span><span class="st">`</span> <span class="ot">=</span> GEOID, <span class="st">`</span><span class="at">CBSA Name</span><span class="st">`</span> <span class="ot">=</span> NAME, <span class="at">Year =</span> year,</span>
<span id="cb36-962"><a href="#cb36-962" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Instant per 1k</span><span class="st">`</span> <span class="ot">=</span> INSTANT_PER_1K, <span class="st">`</span><span class="at">Instant Z</span><span class="st">`</span> <span class="ot">=</span> INSTANT_Z),</span>
<span id="cb36-963"><a href="#cb36-963" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>, <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb36-964"><a href="#cb36-964" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>),</span>
<span id="cb36-965"><a href="#cb36-965" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-966"><a href="#cb36-966" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">formatRound</span>(<span class="dv">4</span>, <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">formatRound</span>(<span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb36-967"><a href="#cb36-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-968"><a href="#cb36-968" aria-hidden="true" tabindex="-1"></a>result_bottom_instant</span>
<span id="cb36-969"><a href="#cb36-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-970"><a href="#cb36-970" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-971"><a href="#cb36-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-972"><a href="#cb36-972" aria-hidden="true" tabindex="-1"></a><span class="fu">## Top 10 Housing Growth Rate</span></span>
<span id="cb36-975"><a href="#cb36-975" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-976"><a href="#cb36-976" aria-hidden="true" tabindex="-1"></a>result_top_rate <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb36-977"><a href="#cb36-977" aria-hidden="true" tabindex="-1"></a>  top10_rate <span class="sc">%&gt;%</span></span>
<span id="cb36-978"><a href="#cb36-978" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">`</span><span class="at">CBSA Code</span><span class="st">`</span> <span class="ot">=</span> GEOID, <span class="st">`</span><span class="at">CBSA Name</span><span class="st">`</span> <span class="ot">=</span> NAME, <span class="at">Year =</span> year,</span>
<span id="cb36-979"><a href="#cb36-979" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Rate of Growth</span><span class="st">`</span> <span class="ot">=</span> RATE_VS_POP_5YR, <span class="st">`</span><span class="at">Rate Z</span><span class="st">`</span> <span class="ot">=</span> RATE_Z),</span>
<span id="cb36-980"><a href="#cb36-980" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>, <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb36-981"><a href="#cb36-981" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>),</span>
<span id="cb36-982"><a href="#cb36-982" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-983"><a href="#cb36-983" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">formatRound</span>(<span class="dv">4</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">formatRound</span>(<span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb36-984"><a href="#cb36-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-985"><a href="#cb36-985" aria-hidden="true" tabindex="-1"></a>result_top_rate</span>
<span id="cb36-986"><a href="#cb36-986" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-987"><a href="#cb36-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-988"><a href="#cb36-988" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bottom 10 Housing Growth Rate</span></span>
<span id="cb36-991"><a href="#cb36-991" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-992"><a href="#cb36-992" aria-hidden="true" tabindex="-1"></a>result_bottom_rate <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb36-993"><a href="#cb36-993" aria-hidden="true" tabindex="-1"></a>  bottom10_rate <span class="sc">%&gt;%</span></span>
<span id="cb36-994"><a href="#cb36-994" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">`</span><span class="at">CBSA Code</span><span class="st">`</span> <span class="ot">=</span> GEOID, <span class="st">`</span><span class="at">CBSA Name</span><span class="st">`</span> <span class="ot">=</span> NAME, <span class="at">Year =</span> year,</span>
<span id="cb36-995"><a href="#cb36-995" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Rate of Growth</span><span class="st">`</span> <span class="ot">=</span> RATE_VS_POP_5YR, <span class="st">`</span><span class="at">Rate Z</span><span class="st">`</span> <span class="ot">=</span> RATE_Z),</span>
<span id="cb36-996"><a href="#cb36-996" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>, <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb36-997"><a href="#cb36-997" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>),</span>
<span id="cb36-998"><a href="#cb36-998" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb36-999"><a href="#cb36-999" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">formatRound</span>(<span class="dv">4</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">formatRound</span>(<span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb36-1000"><a href="#cb36-1000" aria-hidden="true" tabindex="-1"></a>result_bottom_rate</span>
<span id="cb36-1001"><a href="#cb36-1001" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-1002"><a href="#cb36-1002" aria-hidden="true" tabindex="-1"></a><span class="fu">## Top and Bottom Composite Z-score</span></span>
<span id="cb36-1005"><a href="#cb36-1005" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-1006"><a href="#cb36-1006" aria-hidden="true" tabindex="-1"></a>top10_composite <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb36-1007"><a href="#cb36-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(COMPOSITE_Z)) <span class="sc">|&gt;</span></span>
<span id="cb36-1008"><a href="#cb36-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, INSTANT_PER_1K, RATE_VS_POP_5YR, COMPOSITE_Z) <span class="sc">|&gt;</span></span>
<span id="cb36-1009"><a href="#cb36-1009" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb36-1010"><a href="#cb36-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1011"><a href="#cb36-1011" aria-hidden="true" tabindex="-1"></a>bottom10_composite <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">|&gt;</span></span>
<span id="cb36-1012"><a href="#cb36-1012" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(COMPOSITE_Z) <span class="sc">|&gt;</span></span>
<span id="cb36-1013"><a href="#cb36-1013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, INSTANT_PER_1K, RATE_VS_POP_5YR, COMPOSITE_Z) <span class="sc">|&gt;</span></span>
<span id="cb36-1014"><a href="#cb36-1014" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb36-1015"><a href="#cb36-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1016"><a href="#cb36-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1017"><a href="#cb36-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1018"><a href="#cb36-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1019"><a href="#cb36-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-1020"><a href="#cb36-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1021"><a href="#cb36-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1022"><a href="#cb36-1022" aria-hidden="true" tabindex="-1"></a><span class="fu">## Top 10 by Composite Z Score</span></span>
<span id="cb36-1025"><a href="#cb36-1025" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-1026"><a href="#cb36-1026" aria-hidden="true" tabindex="-1"></a>dt_top_composite <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb36-1027"><a href="#cb36-1027" aria-hidden="true" tabindex="-1"></a>  top10_composite,</span>
<span id="cb36-1028"><a href="#cb36-1028" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-1029"><a href="#cb36-1029" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb36-1030"><a href="#cb36-1030" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>),</span>
<span id="cb36-1031"><a href="#cb36-1031" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"CBSA Code"</span>,<span class="st">"CBSA Name"</span>,<span class="st">"Instantaneous"</span>,<span class="st">"Rate"</span>,<span class="st">"Composite Z"</span>),</span>
<span id="cb36-1032"><a href="#cb36-1032" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1033"><a href="#cb36-1033" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb36-1034"><a href="#cb36-1034" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="dv">3</span>, <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-1035"><a href="#cb36-1035" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="dv">4</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-1036"><a href="#cb36-1036" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="dv">5</span>, <span class="dv">2</span>)</span>
<span id="cb36-1037"><a href="#cb36-1037" aria-hidden="true" tabindex="-1"></a>dt_top_composite</span>
<span id="cb36-1038"><a href="#cb36-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1039"><a href="#cb36-1039" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-1040"><a href="#cb36-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1041"><a href="#cb36-1041" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bottom 10 by Composite z-score</span></span>
<span id="cb36-1044"><a href="#cb36-1044" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-1045"><a href="#cb36-1045" aria-hidden="true" tabindex="-1"></a>dt_bottom_composite <span class="ot">&lt;-</span> <span class="fu">datatable</span>(</span>
<span id="cb36-1046"><a href="#cb36-1046" aria-hidden="true" tabindex="-1"></a>  bottom10_composite,</span>
<span id="cb36-1047"><a href="#cb36-1047" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-1048"><a href="#cb36-1048" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">"compact"</span>,</span>
<span id="cb36-1049"><a href="#cb36-1049" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">dom =</span> <span class="st">'t'</span>, <span class="at">paging =</span> <span class="cn">FALSE</span>, <span class="at">ordering =</span> <span class="cn">FALSE</span>, <span class="at">info =</span> <span class="cn">FALSE</span>),</span>
<span id="cb36-1050"><a href="#cb36-1050" aria-hidden="true" tabindex="-1"></a>  <span class="at">colnames =</span> <span class="fu">c</span>(<span class="st">"CBSA Code"</span>,<span class="st">"CBSA Name"</span>,<span class="st">"Year"</span>,<span class="st">"Instantaneous"</span>,<span class="st">"Rate"</span>,<span class="st">"Composite Z"</span>),</span>
<span id="cb36-1051"><a href="#cb36-1051" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-1052"><a href="#cb36-1052" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb36-1053"><a href="#cb36-1053" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="dv">4</span>, <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-1054"><a href="#cb36-1054" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="dv">5</span>, <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-1055"><a href="#cb36-1055" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatRound</span>(<span class="dv">6</span>, <span class="dv">2</span>)</span>
<span id="cb36-1056"><a href="#cb36-1056" aria-hidden="true" tabindex="-1"></a>dt_bottom_composite</span>
<span id="cb36-1057"><a href="#cb36-1057" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-1058"><a href="#cb36-1058" aria-hidden="true" tabindex="-1"></a><span class="fu"># Task 6 Visualization of Yimbys</span></span>
<span id="cb36-1059"><a href="#cb36-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1060"><a href="#cb36-1060" aria-hidden="true" tabindex="-1"></a><span class="fu">## Defining a YIMBY </span></span>
<span id="cb36-1063"><a href="#cb36-1063" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-1064"><a href="#cb36-1064" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-1065"><a href="#cb36-1065" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb36-1066"><a href="#cb36-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1067"><a href="#cb36-1067" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> <span class="dv">2014</span></span>
<span id="cb36-1068"><a href="#cb36-1068" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">max</span>(RENT_BURDEN<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-1069"><a href="#cb36-1069" aria-hidden="true" tabindex="-1"></a>N  <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb36-1070"><a href="#cb36-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1071"><a href="#cb36-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1072"><a href="#cb36-1072" aria-hidden="true" tabindex="-1"></a>rb_2014 <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">%&gt;%</span></span>
<span id="cb36-1073"><a href="#cb36-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> y0) <span class="sc">%&gt;%</span></span>
<span id="cb36-1074"><a href="#cb36-1074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb36-1075"><a href="#cb36-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">rb_2014 =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb36-1076"><a href="#cb36-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1077"><a href="#cb36-1077" aria-hidden="true" tabindex="-1"></a>rb_latest <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">%&gt;%</span></span>
<span id="cb36-1078"><a href="#cb36-1078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> y1) <span class="sc">%&gt;%</span></span>
<span id="cb36-1079"><a href="#cb36-1079" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb36-1080"><a href="#cb36-1080" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">rb_latest =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb36-1081"><a href="#cb36-1081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1082"><a href="#cb36-1082" aria-hidden="true" tabindex="-1"></a>rb_change <span class="ot">&lt;-</span> rb_2014 <span class="sc">%&gt;%</span></span>
<span id="cb36-1083"><a href="#cb36-1083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(rb_latest, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-1084"><a href="#cb36-1084" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delta_rb =</span> rb_latest <span class="sc">-</span> rb_2014) <span class="sc">%&gt;%</span></span>
<span id="cb36-1085"><a href="#cb36-1085" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(delta_rb))</span>
<span id="cb36-1086"><a href="#cb36-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1087"><a href="#cb36-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1088"><a href="#cb36-1088" aria-hidden="true" tabindex="-1"></a>growth_z <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">%&gt;%</span></span>
<span id="cb36-1089"><a href="#cb36-1089" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> y0 <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> y1) <span class="sc">%&gt;%</span></span>
<span id="cb36-1090"><a href="#cb36-1090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb36-1091"><a href="#cb36-1091" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_comp_z =</span> <span class="fu">mean</span>(COMPOSITE_Z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb36-1092"><a href="#cb36-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1093"><a href="#cb36-1093" aria-hidden="true" tabindex="-1"></a>pop_flags <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb36-1094"><a href="#cb36-1094" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(y0, y1)) <span class="sc">%&gt;%</span></span>
<span id="cb36-1095"><a href="#cb36-1095" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb36-1096"><a href="#cb36-1096" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb36-1097"><a href="#cb36-1097" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_2014   =</span> population[year <span class="sc">==</span> y0][<span class="dv">1</span>],</span>
<span id="cb36-1098"><a href="#cb36-1098" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_latest =</span> population[year <span class="sc">==</span> y1][<span class="dv">1</span>],</span>
<span id="cb36-1099"><a href="#cb36-1099" aria-hidden="true" tabindex="-1"></a>    <span class="at">growing_population =</span> pop_latest <span class="sc">&gt;</span> pop_2014,</span>
<span id="cb36-1100"><a href="#cb36-1100" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb36-1101"><a href="#cb36-1101" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb36-1102"><a href="#cb36-1102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, growing_population)</span>
<span id="cb36-1103"><a href="#cb36-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1104"><a href="#cb36-1104" aria-hidden="true" tabindex="-1"></a><span class="co"># High initial burden cutoff (2014 median)</span></span>
<span id="cb36-1105"><a href="#cb36-1105" aria-hidden="true" tabindex="-1"></a>rb_med <span class="ot">&lt;-</span> <span class="fu">median</span>(rb_2014<span class="sc">$</span>rb_2014, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-1106"><a href="#cb36-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1107"><a href="#cb36-1107" aria-hidden="true" tabindex="-1"></a><span class="co"># YIMBYs = high initial 2014 burden, rent decrease, pop growth, above-avg housing growth</span></span>
<span id="cb36-1108"><a href="#cb36-1108" aria-hidden="true" tabindex="-1"></a>topN <span class="ot">&lt;-</span> rb_change <span class="sc">%&gt;%</span></span>
<span id="cb36-1109"><a href="#cb36-1109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(growth_z, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-1110"><a href="#cb36-1110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pop_flags, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-1111"><a href="#cb36-1111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-1112"><a href="#cb36-1112" aria-hidden="true" tabindex="-1"></a>    <span class="at">high_initial_burden      =</span> rb_2014 <span class="sc">&gt;</span> rb_med,</span>
<span id="cb36-1113"><a href="#cb36-1113" aria-hidden="true" tabindex="-1"></a>    <span class="at">decreasing_burden        =</span> delta_rb <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb36-1114"><a href="#cb36-1114" aria-hidden="true" tabindex="-1"></a>    <span class="at">above_avg_housing_growth =</span> avg_comp_z <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb36-1115"><a href="#cb36-1115" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb36-1116"><a href="#cb36-1116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(high_initial_burden,</span>
<span id="cb36-1117"><a href="#cb36-1117" aria-hidden="true" tabindex="-1"></a>         decreasing_burden,</span>
<span id="cb36-1118"><a href="#cb36-1118" aria-hidden="true" tabindex="-1"></a>         growing_population,</span>
<span id="cb36-1119"><a href="#cb36-1119" aria-hidden="true" tabindex="-1"></a>         above_avg_housing_growth) <span class="sc">%&gt;%</span></span>
<span id="cb36-1120"><a href="#cb36-1120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_comp_z), delta_rb, NAME, GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb36-1121"><a href="#cb36-1121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> N) <span class="sc">%&gt;%</span></span>
<span id="cb36-1122"><a href="#cb36-1122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, rb_2014, rb_latest, delta_rb, avg_comp_z)</span>
<span id="cb36-1123"><a href="#cb36-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1124"><a href="#cb36-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1125"><a href="#cb36-1125" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb36-1126"><a href="#cb36-1126" aria-hidden="true" tabindex="-1"></a>  topN <span class="sc">%&gt;%</span></span>
<span id="cb36-1127"><a href="#cb36-1127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb36-1128"><a href="#cb36-1128" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CBSA Code</span><span class="st">`</span> <span class="ot">=</span> GEOID,</span>
<span id="cb36-1129"><a href="#cb36-1129" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">CBSA Name</span><span class="st">`</span> <span class="ot">=</span> NAME,</span>
<span id="cb36-1130"><a href="#cb36-1130" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent Burden 2014</span><span class="st">`</span> <span class="ot">=</span> rb_2014,</span>
<span id="cb36-1131"><a href="#cb36-1131" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Rent Burden Latest</span><span class="st">`</span> <span class="ot">=</span> rb_latest,</span>
<span id="cb36-1132"><a href="#cb36-1132" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Δ Rent Burden</span><span class="st">`</span> <span class="ot">=</span> delta_rb,</span>
<span id="cb36-1133"><a href="#cb36-1133" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Avg Composite Z (≥2014)</span><span class="st">`</span> <span class="ot">=</span> avg_comp_z</span>
<span id="cb36-1134"><a href="#cb36-1134" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb36-1135"><a href="#cb36-1135" aria-hidden="true" tabindex="-1"></a>  <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-1136"><a href="#cb36-1136" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">pageLength =</span> <span class="dv">25</span>)</span>
<span id="cb36-1137"><a href="#cb36-1137" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-1138"><a href="#cb36-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1139"><a href="#cb36-1139" aria-hidden="true" tabindex="-1"></a>result</span>
<span id="cb36-1140"><a href="#cb36-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1141"><a href="#cb36-1141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-1142"><a href="#cb36-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1143"><a href="#cb36-1143" aria-hidden="true" tabindex="-1"></a>The table provides a list of locations performing well in terms of housing growth and decreasing rent burden.YIMBYs are defined by CBSAs with population growth, rent decrease, housing growth, and high initial rent burden.</span>
<span id="cb36-1144"><a href="#cb36-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1145"><a href="#cb36-1145" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bubble plot of possible YIMBYS</span></span>
<span id="cb36-1148"><a href="#cb36-1148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-1149"><a href="#cb36-1149" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-1150"><a href="#cb36-1150" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-1151"><a href="#cb36-1151" aria-hidden="true" tabindex="-1"></a>baseline_us <span class="ot">&lt;-</span> baseline <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">substr</span>(GEOID, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">!=</span> <span class="st">"72"</span>)</span>
<span id="cb36-1152"><a href="#cb36-1152" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> <span class="dv">2014</span></span>
<span id="cb36-1153"><a href="#cb36-1153" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">max</span>(baseline_us<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-1154"><a href="#cb36-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1155"><a href="#cb36-1155" aria-hidden="true" tabindex="-1"></a>rb_change <span class="ot">&lt;-</span> baseline_us <span class="sc">%&gt;%</span></span>
<span id="cb36-1156"><a href="#cb36-1156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(y0, y1)) <span class="sc">%&gt;%</span></span>
<span id="cb36-1157"><a href="#cb36-1157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, year, RENT_BURDEN) <span class="sc">%&gt;%</span></span>
<span id="cb36-1158"><a href="#cb36-1158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> RENT_BURDEN, <span class="at">names_prefix =</span> <span class="st">"rb_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-1159"><a href="#cb36-1159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb36-1160"><a href="#cb36-1160" aria-hidden="true" tabindex="-1"></a>    GEOID, NAME,</span>
<span id="cb36-1161"><a href="#cb36-1161" aria-hidden="true" tabindex="-1"></a>    <span class="at">initial_rent_burden =</span> rb_2014,</span>
<span id="cb36-1162"><a href="#cb36-1162" aria-hidden="true" tabindex="-1"></a>    <span class="at">latest_rent_burden  =</span> .data[[<span class="fu">paste0</span>(<span class="st">"rb_"</span>, y1)]],</span>
<span id="cb36-1163"><a href="#cb36-1163" aria-hidden="true" tabindex="-1"></a>    <span class="at">rent_burden_change  =</span> latest_rent_burden <span class="sc">-</span> initial_rent_burden</span>
<span id="cb36-1164"><a href="#cb36-1164" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb36-1165"><a href="#cb36-1165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(initial_rent_burden), <span class="sc">!</span><span class="fu">is.na</span>(latest_rent_burden))</span>
<span id="cb36-1166"><a href="#cb36-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1167"><a href="#cb36-1167" aria-hidden="true" tabindex="-1"></a>avg_z <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">%&gt;%</span></span>
<span id="cb36-1168"><a href="#cb36-1168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> y0 <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> y1) <span class="sc">%&gt;%</span></span>
<span id="cb36-1169"><a href="#cb36-1169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb36-1170"><a href="#cb36-1170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_comp_z =</span> <span class="fu">mean</span>(COMPOSITE_Z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb36-1171"><a href="#cb36-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1172"><a href="#cb36-1172" aria-hidden="true" tabindex="-1"></a>cbsa_metrics <span class="ot">&lt;-</span> rb_change <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(avg_z, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>))</span>
<span id="cb36-1173"><a href="#cb36-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1174"><a href="#cb36-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1175"><a href="#cb36-1175" aria-hidden="true" tabindex="-1"></a>rb2014_tbl <span class="ot">&lt;-</span> baseline_us <span class="sc">%&gt;%</span></span>
<span id="cb36-1176"><a href="#cb36-1176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> y0) <span class="sc">%&gt;%</span></span>
<span id="cb36-1177"><a href="#cb36-1177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, <span class="at">rb2014 =</span> RENT_BURDEN)</span>
<span id="cb36-1178"><a href="#cb36-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1179"><a href="#cb36-1179" aria-hidden="true" tabindex="-1"></a>rb2014_med <span class="ot">&lt;-</span> <span class="fu">median</span>(rb2014_tbl<span class="sc">$</span>rb2014, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-1180"><a href="#cb36-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1181"><a href="#cb36-1181" aria-hidden="true" tabindex="-1"></a>pop_flags <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb36-1182"><a href="#cb36-1182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(y0, y1)) <span class="sc">%&gt;%</span></span>
<span id="cb36-1183"><a href="#cb36-1183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb36-1184"><a href="#cb36-1184" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> population, <span class="at">names_prefix =</span> <span class="st">"pop_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-1185"><a href="#cb36-1185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(GEOID, <span class="at">growing_population =</span> .data[[<span class="fu">paste0</span>(<span class="st">"pop_"</span>, y1)]] <span class="sc">&gt;</span> pop_2014)</span>
<span id="cb36-1186"><a href="#cb36-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1187"><a href="#cb36-1187" aria-hidden="true" tabindex="-1"></a>cbsa_metrics <span class="ot">&lt;-</span> cbsa_metrics <span class="sc">%&gt;%</span></span>
<span id="cb36-1188"><a href="#cb36-1188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME, avg_comp_z, rent_burden_change) <span class="sc">%&gt;%</span></span>
<span id="cb36-1189"><a href="#cb36-1189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(rb2014_tbl, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-1190"><a href="#cb36-1190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pop_flags, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-1191"><a href="#cb36-1191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-1192"><a href="#cb36-1192" aria-hidden="true" tabindex="-1"></a>    <span class="at">cbsa_type =</span> <span class="fu">ifelse</span>(rb2014 <span class="sc">&gt;</span> rb2014_med <span class="sc">&amp;</span></span>
<span id="cb36-1193"><a href="#cb36-1193" aria-hidden="true" tabindex="-1"></a>                         rent_burden_change <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span></span>
<span id="cb36-1194"><a href="#cb36-1194" aria-hidden="true" tabindex="-1"></a>                         growing_population <span class="sc">&amp;</span></span>
<span id="cb36-1195"><a href="#cb36-1195" aria-hidden="true" tabindex="-1"></a>                         avg_comp_z <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"YIMBY"</span>, <span class="st">"Other"</span>),</span>
<span id="cb36-1196"><a href="#cb36-1196" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha_val =</span> <span class="fu">ifelse</span>(cbsa_type <span class="sc">==</span> <span class="st">"YIMBY"</span>, <span class="dv">1</span>, <span class="fl">0.6</span>)</span>
<span id="cb36-1197"><a href="#cb36-1197" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-1198"><a href="#cb36-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1199"><a href="#cb36-1199" aria-hidden="true" tabindex="-1"></a>housing_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(cbsa_metrics<span class="sc">$</span>avg_comp_z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-1200"><a href="#cb36-1200" aria-hidden="true" tabindex="-1"></a>rent_change_zero <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb36-1201"><a href="#cb36-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1202"><a href="#cb36-1202" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cbsa_metrics, <span class="fu">aes</span>(<span class="at">x =</span> avg_comp_z, <span class="at">y =</span> rent_burden_change)) <span class="sc">+</span></span>
<span id="cb36-1203"><a href="#cb36-1203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>,</span>
<span id="cb36-1204"><a href="#cb36-1204" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> housing_mean, <span class="at">xmax =</span> <span class="cn">Inf</span>,</span>
<span id="cb36-1205"><a href="#cb36-1205" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> rent_change_zero,</span>
<span id="cb36-1206"><a href="#cb36-1206" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"green"</span>, <span class="at">alpha =</span> <span class="fl">0.08</span>) <span class="sc">+</span></span>
<span id="cb36-1207"><a href="#cb36-1207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> rent_change_zero, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb36-1208"><a href="#cb36-1208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> housing_mean, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb36-1209"><a href="#cb36-1209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(</span>
<span id="cb36-1210"><a href="#cb36-1210" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> cbsa_type,</span>
<span id="cb36-1211"><a href="#cb36-1211" aria-hidden="true" tabindex="-1"></a>    <span class="at">size  =</span> avg_comp_z,</span>
<span id="cb36-1212"><a href="#cb36-1212" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> alpha_val</span>
<span id="cb36-1213"><a href="#cb36-1213" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb36-1214"><a href="#cb36-1214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"YIMBY"</span> <span class="ot">=</span> <span class="st">"#8073ac"</span>, <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"gray70"</span>)) <span class="sc">+</span></span>
<span id="cb36-1215"><a href="#cb36-1215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_identity</span>() <span class="sc">+</span></span>
<span id="cb36-1216"><a href="#cb36-1216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb36-1217"><a href="#cb36-1217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb36-1218"><a href="#cb36-1218" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Rent Burden Change vs Housing Growth"</span>,</span>
<span id="cb36-1219"><a href="#cb36-1219" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Housing Growth"</span>,</span>
<span id="cb36-1220"><a href="#cb36-1220" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Change in Rent Burden"</span>,</span>
<span id="cb36-1221"><a href="#cb36-1221" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"CBSA Type"</span>,</span>
<span id="cb36-1222"><a href="#cb36-1222" aria-hidden="true" tabindex="-1"></a>    <span class="at">size  =</span> <span class="st">"Avg Composite Z"</span></span>
<span id="cb36-1223"><a href="#cb36-1223" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-1224"><a href="#cb36-1224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb36-1225"><a href="#cb36-1225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb36-1226"><a href="#cb36-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1227"><a href="#cb36-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-1228"><a href="#cb36-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1229"><a href="#cb36-1229" aria-hidden="true" tabindex="-1"></a>We can see from the plot that the YIMBYs lie in the lower right quadrant. Meaning the values in this area have positive housing growth and a decreasing rent burden.</span>
<span id="cb36-1230"><a href="#cb36-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1231"><a href="#cb36-1231" aria-hidden="true" tabindex="-1"></a><span class="fu">## Time Plot for possible YIMBYs </span></span>
<span id="cb36-1234"><a href="#cb36-1234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb36-1235"><a href="#cb36-1235" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-1236"><a href="#cb36-1236" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb36-1237"><a href="#cb36-1237" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-1238"><a href="#cb36-1238" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gghighlight)</span>
<span id="cb36-1239"><a href="#cb36-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1240"><a href="#cb36-1240" aria-hidden="true" tabindex="-1"></a>y0 <span class="ot">&lt;-</span> <span class="dv">2014</span></span>
<span id="cb36-1241"><a href="#cb36-1241" aria-hidden="true" tabindex="-1"></a>y1 <span class="ot">&lt;-</span> <span class="fu">max</span>(RENT_BURDEN<span class="sc">$</span>year, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-1242"><a href="#cb36-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1243"><a href="#cb36-1243" aria-hidden="true" tabindex="-1"></a>rb_2014_tbl <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">%&gt;%</span></span>
<span id="cb36-1244"><a href="#cb36-1244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> y0) <span class="sc">%&gt;%</span></span>
<span id="cb36-1245"><a href="#cb36-1245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb36-1246"><a href="#cb36-1246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">rb2014 =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb36-1247"><a href="#cb36-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1248"><a href="#cb36-1248" aria-hidden="true" tabindex="-1"></a>rb_latest_tbl <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">%&gt;%</span></span>
<span id="cb36-1249"><a href="#cb36-1249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> y1) <span class="sc">%&gt;%</span></span>
<span id="cb36-1250"><a href="#cb36-1250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb36-1251"><a href="#cb36-1251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">rb_latest =</span> <span class="fu">mean</span>(RENT_BURDEN, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb36-1252"><a href="#cb36-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1253"><a href="#cb36-1253" aria-hidden="true" tabindex="-1"></a>rb_change <span class="ot">&lt;-</span> rb_2014_tbl <span class="sc">%&gt;%</span></span>
<span id="cb36-1254"><a href="#cb36-1254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(rb_latest_tbl, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-1255"><a href="#cb36-1255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delta_rb =</span> rb_latest <span class="sc">-</span> rb2014) <span class="sc">%&gt;%</span></span>
<span id="cb36-1256"><a href="#cb36-1256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(delta_rb))</span>
<span id="cb36-1257"><a href="#cb36-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1258"><a href="#cb36-1258" aria-hidden="true" tabindex="-1"></a>growth_z <span class="ot">&lt;-</span> housing_metrics_z <span class="sc">%&gt;%</span></span>
<span id="cb36-1259"><a href="#cb36-1259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> y0 <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> y1) <span class="sc">%&gt;%</span></span>
<span id="cb36-1260"><a href="#cb36-1260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID, NAME) <span class="sc">%&gt;%</span></span>
<span id="cb36-1261"><a href="#cb36-1261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_comp_z =</span> <span class="fu">mean</span>(COMPOSITE_Z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb36-1262"><a href="#cb36-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1263"><a href="#cb36-1263" aria-hidden="true" tabindex="-1"></a>pop_flags <span class="ot">&lt;-</span> POPULATION <span class="sc">%&gt;%</span></span>
<span id="cb36-1264"><a href="#cb36-1264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(y0, y1)) <span class="sc">%&gt;%</span></span>
<span id="cb36-1265"><a href="#cb36-1265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, year, population) <span class="sc">%&gt;%</span></span>
<span id="cb36-1266"><a href="#cb36-1266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> population, <span class="at">names_prefix =</span> <span class="st">"pop_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-1267"><a href="#cb36-1267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(GEOID, <span class="at">growing_population =</span> .data[[<span class="fu">paste0</span>(<span class="st">"pop_"</span>, y1)]] <span class="sc">&gt;</span> pop_2014)</span>
<span id="cb36-1268"><a href="#cb36-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1269"><a href="#cb36-1269" aria-hidden="true" tabindex="-1"></a>rb2014_cutoff <span class="ot">&lt;-</span> <span class="fu">median</span>(rb_2014_tbl<span class="sc">$</span>rb2014, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-1270"><a href="#cb36-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1271"><a href="#cb36-1271" aria-hidden="true" tabindex="-1"></a>pool <span class="ot">&lt;-</span> rb_change <span class="sc">%&gt;%</span></span>
<span id="cb36-1272"><a href="#cb36-1272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(growth_z, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GEOID"</span>,<span class="st">"NAME"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-1273"><a href="#cb36-1273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pop_flags, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-1274"><a href="#cb36-1274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-1275"><a href="#cb36-1275" aria-hidden="true" tabindex="-1"></a>    <span class="at">high_initial_burden      =</span> rb2014 <span class="sc">&gt;</span> rb2014_cutoff,</span>
<span id="cb36-1276"><a href="#cb36-1276" aria-hidden="true" tabindex="-1"></a>    <span class="at">decreasing_burden        =</span> delta_rb <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb36-1277"><a href="#cb36-1277" aria-hidden="true" tabindex="-1"></a>    <span class="at">above_avg_housing_growth =</span> avg_comp_z <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb36-1278"><a href="#cb36-1278" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb36-1279"><a href="#cb36-1279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(high_initial_burden, decreasing_burden, growing_population, above_avg_housing_growth)</span>
<span id="cb36-1280"><a href="#cb36-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1281"><a href="#cb36-1281" aria-hidden="true" tabindex="-1"></a>topN <span class="ot">&lt;-</span> pool <span class="sc">%&gt;%</span></span>
<span id="cb36-1282"><a href="#cb36-1282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_comp_z), delta_rb, NAME, GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb36-1283"><a href="#cb36-1283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb36-1284"><a href="#cb36-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1285"><a href="#cb36-1285" aria-hidden="true" tabindex="-1"></a>top5 <span class="ot">&lt;-</span> topN <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb36-1286"><a href="#cb36-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1287"><a href="#cb36-1287" aria-hidden="true" tabindex="-1"></a>name_map <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">%&gt;%</span></span>
<span id="cb36-1288"><a href="#cb36-1288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(GEOID) <span class="sc">%&gt;%</span></span>
<span id="cb36-1289"><a href="#cb36-1289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(year, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-1290"><a href="#cb36-1290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-1291"><a href="#cb36-1291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, NAME)</span>
<span id="cb36-1292"><a href="#cb36-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1293"><a href="#cb36-1293" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> RENT_BURDEN <span class="sc">%&gt;%</span></span>
<span id="cb36-1294"><a href="#cb36-1294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(GEOID <span class="sc">%in%</span> pool<span class="sc">$</span>GEOID, <span class="sc">!</span><span class="fu">is.na</span>(RENT_BURDEN)) <span class="sc">%&gt;%</span></span>
<span id="cb36-1295"><a href="#cb36-1295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GEOID, year, RENT_BURDEN) <span class="sc">%&gt;%</span></span>
<span id="cb36-1296"><a href="#cb36-1296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(name_map, <span class="at">by =</span> <span class="st">"GEOID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-1297"><a href="#cb36-1297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-1298"><a href="#cb36-1298" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlight_flag =</span> GEOID <span class="sc">%in%</span> top5<span class="sc">$</span>GEOID,</span>
<span id="cb36-1299"><a href="#cb36-1299" aria-hidden="true" tabindex="-1"></a>    <span class="at">color_group =</span> <span class="fu">ifelse</span>(NAME <span class="sc">%in%</span> top5<span class="sc">$</span>NAME, NAME, <span class="st">"Other"</span>)</span>
<span id="cb36-1300"><a href="#cb36-1300" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-1301"><a href="#cb36-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1302"><a href="#cb36-1302" aria-hidden="true" tabindex="-1"></a>palette_pp <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">"#7B2CBF"</span>,<span class="st">"#9D4EDD"</span>,<span class="st">"#C77DFF"</span>,<span class="st">"#F72585"</span>,<span class="st">"#FF4D6D"</span>,<span class="st">"grey75"</span>),</span>
<span id="cb36-1303"><a href="#cb36-1303" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">c</span>(top5<span class="sc">$</span>NAME, <span class="st">"Other"</span>))</span>
<span id="cb36-1304"><a href="#cb36-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1305"><a href="#cb36-1305" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(year, RENT_BURDEN, <span class="at">color =</span> color_group, <span class="at">group =</span> GEOID)) <span class="sc">+</span></span>
<span id="cb36-1306"><a href="#cb36-1306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb36-1307"><a href="#cb36-1307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gghighlight</span>(highlight_flag, <span class="at">use_direct_label =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-1308"><a href="#cb36-1308" aria-hidden="true" tabindex="-1"></a>              <span class="at">use_group_by =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-1309"><a href="#cb36-1309" aria-hidden="true" tabindex="-1"></a>              <span class="at">unhighlighted_params =</span> <span class="fu">list</span>(<span class="at">colour =</span> <span class="st">"grey75"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)) <span class="sc">+</span></span>
<span id="cb36-1310"><a href="#cb36-1310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> palette_pp, <span class="at">name =</span> <span class="st">"CBSA"</span>) <span class="sc">+</span></span>
<span id="cb36-1311"><a href="#cb36-1311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"YIMBY Top 5"</span>, <span class="at">x =</span> <span class="st">"Year"</span>, <span class="at">y =</span> <span class="st">"Rent Burden"</span>) <span class="sc">+</span></span>
<span id="cb36-1312"><a href="#cb36-1312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb36-1313"><a href="#cb36-1313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb36-1314"><a href="#cb36-1314" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb36-1315"><a href="#cb36-1315" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box =</span> <span class="st">"horizontal"</span>,</span>
<span id="cb36-1316"><a href="#cb36-1316" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb36-1317"><a href="#cb36-1317" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.width  =</span> <span class="fu">unit</span>(<span class="dv">10</span>, <span class="st">"pt"</span>),</span>
<span id="cb36-1318"><a href="#cb36-1318" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="dv">10</span>, <span class="st">"pt"</span>),</span>
<span id="cb36-1319"><a href="#cb36-1319" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">4</span>, <span class="at">r =</span> <span class="dv">8</span>, <span class="at">b =</span> <span class="dv">4</span>, <span class="at">l =</span> <span class="dv">8</span>),</span>
<span id="cb36-1320"><a href="#cb36-1320" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">6</span>, <span class="at">b =</span> <span class="dv">12</span>),</span>
<span id="cb36-1321"><a href="#cb36-1321" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">10</span>, <span class="at">r =</span> <span class="dv">10</span>, <span class="at">b =</span> <span class="dv">30</span>, <span class="at">l =</span> <span class="dv">10</span>)  <span class="co"># extra bottom room</span></span>
<span id="cb36-1322"><a href="#cb36-1322" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb36-1323"><a href="#cb36-1323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)) </span>
<span id="cb36-1324"><a href="#cb36-1324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb36-1325"><a href="#cb36-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1326"><a href="#cb36-1326" aria-hidden="true" tabindex="-1"></a>The plot shows the decrease in rent for our top 5 YIMBYs since 2014. Our top 5 YIMBY candidates do behave like YIMBYS as we defined earlier in terms of rent decrease over our period of time since 2014.</span>
<span id="cb36-1327"><a href="#cb36-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1328"><a href="#cb36-1328" aria-hidden="true" tabindex="-1"></a><span class="fu"># Task 7 Policy Brief</span></span>
<span id="cb36-1329"><a href="#cb36-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1330"><a href="#cb36-1330" aria-hidden="true" tabindex="-1"></a><span class="fu">### **Introduction**</span></span>
<span id="cb36-1331"><a href="#cb36-1331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1332"><a href="#cb36-1332" aria-hidden="true" tabindex="-1"></a>Across the country, especially in highly populated areas like NYC, rental costs are sky high. The rental market today is extremely competitive, driving prices higher. This limits families across the nation from affordable, high quality homes. While rental prices have climbed in NIMBY cities like NYC, increases in individual income have not been sufficient to cover these costs. Students, or recent graduates, are particularly burdened when it comes to high rental costs. Our study looked at cities starting in 2014 and determined which cities are considered YIMBYs and which cities are considered NIMBYs.</span>
<span id="cb36-1333"><a href="#cb36-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1334"><a href="#cb36-1334" aria-hidden="true" tabindex="-1"></a><span class="fu">### **Sponsors**</span></span>
<span id="cb36-1335"><a href="#cb36-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1336"><a href="#cb36-1336" aria-hidden="true" tabindex="-1"></a>We will have one representative from our YIMBY city Burlington, North Carolina, and one representative from NYC as sponsors for this bill. </span>
<span id="cb36-1337"><a href="#cb36-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1338"><a href="#cb36-1338" aria-hidden="true" tabindex="-1"></a><span class="fu">### **Potential Benefits from our Policy**</span></span>
<span id="cb36-1339"><a href="#cb36-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1340"><a href="#cb36-1340" aria-hidden="true" tabindex="-1"></a>NYC is a major hub for the arts, education, and city jobs. Modeling NYC's policies to rival one of a NIMBY city may be difficult purely because of the geography of Manhattan, however these policies would benefit local artists, students, and city workers such as MTA employees. Giving these groups access to more affordable, nice housing would allow them to flourish and, in turn, give them a suitable foundation to boost the economy. MTA workers would especially benefit and, since NYC relies on MTA workers to keep the city functioning, this benefit would lead to the running optimally. The residents of Burlington, North Carolina also have countless city jobs and many residents rely on these city jobs for income. Burlington, North Carolina is located near several universities - conveniently located approximately 30 minutes from Duke - so students and recent graduates would also benefit from more available housing and a lower rent cost. NYC is home to many colleges and universities, so students in NYC would benefit from these policies as well. </span>
<span id="cb36-1341"><a href="#cb36-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1342"><a href="#cb36-1342" aria-hidden="true" tabindex="-1"></a><span class="fu">### **Metrics**</span></span>
<span id="cb36-1343"><a href="#cb36-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1344"><a href="#cb36-1344" aria-hidden="true" tabindex="-1"></a>For this policy we have identified what makes a city worthy of YIMBY status: decreasing rent burden, positive housing growth rate, high population growth, and high initial rent. Our policy is based on these factors.</span>
<span id="cb36-1345"><a href="#cb36-1345" aria-hidden="true" tabindex="-1"></a>A NIMBY city would be one that has little housing growth and high rent cost.</span>
<span id="cb36-1346"><a href="#cb36-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1347"><a href="#cb36-1347" aria-hidden="true" tabindex="-1"></a><span class="fu">### **Conclusion** </span></span>
<span id="cb36-1348"><a href="#cb36-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1349"><a href="#cb36-1349" aria-hidden="true" tabindex="-1"></a>While Burlington, NC is considered a WIMBY city, NYC has a long way to go in terms of affordable housing and housing growth. Considering that the population of NYC is growing, the city needs to act soon in order to keep up with housing demand.</span>
<span id="cb36-1350"><a href="#cb36-1350" aria-hidden="true" tabindex="-1"></a></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>